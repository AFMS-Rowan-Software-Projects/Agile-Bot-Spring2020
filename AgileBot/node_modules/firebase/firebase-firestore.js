!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(Yd){"use strict";try{(function(){Yd=Yd&&Yd.hasOwnProperty("default")?Yd.default:Yd;var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function t(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,e,f=function(){return(f=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function p(o,s,a,u){return new(a=a||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,s||[])).next())})}function y(n,r){var i,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function a(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(e=o=o||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function n(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,a(["["+i+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,a(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var i=o.INFO,u=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,a([this,o.ERROR],t))},h);function h(t){this.name=t,this._logLevel=i,this._logHandler=n}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var c,d=(t(v,c=Error),v);function v(t,e){var n=c.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(g.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?function(t,r){return t.replace(w,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new d(i,a),h=0,c=Object.keys(r);h<c.length;h++){var f=c[h];"_"!==f.slice(-1)&&(f in u&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),u[f]=r[f])}return u},g);function g(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w=/\{\$([^}]+)}/g,b=(E.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},E.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},E.prototype.setServiceProps=function(t){return this.serviceProps=t,this},E);function E(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var I,T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=N||{},A=T;function S(t){return"string"==typeof t}function k(t){return"number"==typeof t}function D(t,e){t=t.split("."),e=e||A;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function R(){}function _(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function O(t){return"array"==_(t)}function C(t){var e=_(t);return"array"==e||"object"==e&&"number"==typeof t.length}function x(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),P=0;function U(t,e,n){return t.call.apply(t.bind,arguments)}function M(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function q(t,e,n){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?U:M).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var G=Date.now||function(){return+new Date};function F(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).xb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function j(){this.j=this.j,this.i=this.i}j.prototype.j=!1,j.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[L]||(this[L]=++P)},j.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(S(t))return S(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=S(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function z(t){return Array.prototype.concat.apply([],arguments)}function Y(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var K,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var $=A.navigator;if($){var Z=$.userAgent;if(Z){K=Z;break t}}K=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e,n={};for(e in t)n[e]=t[e];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=R;var ot,st,at=J(K,"Opera"),ut=J(K,"Trident")||J(K,"MSIE"),ht=J(K,"Edge"),ct=ht||ut,ft=J(K,"Gecko")&&!(J(K.toLowerCase(),"webkit")&&!J(K,"Edge"))&&!(J(K,"Trident")||J(K,"MSIE"))&&!J(K,"Edge"),lt=J(K.toLowerCase(),"webkit")&&!J(K,"Edge");function pt(){var t=A.document;return t?t.documentMode:void 0}t:{var dt="",yt=(st=K,ft?/rv:([^\);]+)(\)|;)/.exec(st):ht?/Edge\/([\d\.]+)/.exec(st):ut?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):at?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(yt&&(dt=yt?yt[1]:""),ut){var vt=pt();if(null!=vt&&vt>parseFloat(dt)){ot=String(vt);break t}}ot=dt}var mt,gt={};function wt(a){return function(t,e){var n=gt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(a,function(){for(var t=0,e=Q(String(ot)).split("."),n=Q(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t})}var bt=A.document;mt=bt&&ut?pt()||("CSS1Compat"==bt.compatMode?parseInt(ot,10):5):void 0;var Et=!ut||9<=Number(mt),It=ut&&!wt("9"),Tt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",R,e),A.removeEventListener("test",R,e)}catch(t){}return t}();function Nt(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function At(t,e){if(Nt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=S(t.pointerType)?t.pointerType:St[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Nt.prototype.b=function(){this.Ia=!1},F(At,Nt);var St={2:"touch",3:"pen",4:"mouse"};At.prototype.b=function(){At.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var kt="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function Rt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Dt,this.X=this.Z=!1}function _t(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Ot(t){this.src=t,this.a={},this.b=0}function Ct(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=B(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function xt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Ot.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=xt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Rt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Pt={};function Ut(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(O(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Ht(r);return e&&e[kt]?e.Aa(n,r,x(i)?!!i.capture:!!i,o):Mt(e,n,r,!0,i,o)}(t,e,n,r,i);if(O(e)){for(var o=0;o<e.length;o++)Ut(t,e[o],n,r,i);return null}return n=Ht(n),t&&t[kt]?t.za(e,n,x(r)?!!r.capture:!!r,i):Mt(t,e,n,!1,r,i)}function Mt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=x(i)?!!i.capture:!!i;if(s&&!Et)return null;var a=jt(t);if(a||(t[Lt]=a=new Ot(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var e=Ft,n=Et?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function qt(t){if(!k(t)&&t&&!t.X){var e=t.src;if(e&&e[kt])Ct(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(Ct(n,t),0==n.b&&(n.src=null,e[Lt]=null)):_t(t)}}}function Vt(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function Gt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&qt(t),n.call(r,e)}function Ft(t,e){return!!t.X||(Et?Gt(t,new At(e,this)):Gt(t,e=new At(e||D("window.event"),this)))}function jt(t){return(t=t[Lt])instanceof Ot?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ht(e){return"function"==_(e)?e:(e[Bt]||(e[Bt]=function(t){return e.handleEvent(t)}),e[Bt])}function zt(){j.call(this),this.c=new Ot(this),(this.J=this).B=null}function Yt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Ct(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Ia}F(zt,j),zt.prototype[kt]=!0,(I=zt.prototype).addEventListener=function(t,e,n,r){Ut(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(O(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=x(i)?!!i.capture:!!i,r=Ht(r),e&&e[kt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=xt(s=e.a[n],r,i,o))&&(_t(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=xt(n,r,i,o)),(r=-1<e?n[e]:null)&&qt(r))}(this,t,e,n,r)},I.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(S(t))t=new Nt(t,n);else if(t instanceof Nt)t.target=t.target||n;else{var i=t;rt(t=new Nt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Yt(s,r,!0,t)&&i}if(i=Yt(s=t.a=n,r,!0,t)&&i,i=Yt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Yt(s=t.a=e[o],r,!1,t)&&i;return i},I.G=function(){if(zt.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.B=null},I.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Wt=A.JSON.stringify;function Kt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Qt(){this.b=this.a=null}Kt.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Jt,Xt=new Kt(function(){return new $t},function(t){t.reset()});function $t(){this.next=this.b=this.a=null}function Zt(t){A.setTimeout(function(){throw t},0)}function te(t,e){Jt||function(){var t=A.Promise.resolve(void 0);Jt=function(){t.then(re)}}(),ee||(Jt(),ee=!0),ne.add(t,e)}Qt.prototype.add=function(t,e){var n=Xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var ee=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ne=new Qt;function re(){for(var t;r=n=void 0,r=null,(n=ne).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Zt(t)}var e=Xt;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;ee=!1}function ie(t,e){zt.call(this),this.b=t||1,this.a=e||A,this.f=q(this.fb,this),this.g=G()}function oe(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function se(t,e,n){if("function"==_(t))n&&(t=q(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=q(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}function ae(t,e,n){j.call(this),this.f=null!=n?q(t,n):t,this.c=e,this.b=q(this.$a,this),this.a=[]}function ue(t){t.U=se(t.b,t.c),t.f.apply(null,t.a)}function he(t){j.call(this),this.b=t,this.a={}}F(ie,zt),(I=ie.prototype).ba=!1,I.L=null,I.fb=function(){if(this.ba){var t=G()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(oe(this),this.start()))}},I.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=G())},I.G=function(){ie.N.G.call(this),oe(this),delete this.a},F(ae,j),(I=ae.prototype).ea=!1,I.U=null,I.Ta=function(t){this.a=arguments,this.U?this.ea=!0:ue(this)},I.G=function(){ae.N.G.call(this),this.U&&(A.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},I.$a=function(){this.U=null,this.ea&&(this.ea=!1,ue(this))},F(he,j);var ce=[];function fe(t,e,n,r){O(n)||(n&&(ce[0]=n.toString()),n=ce);for(var i=0;i<n.length;i++){var o=Ut(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function le(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&qt(t)},t),t.a={}}function pe(){}he.prototype.G=function(){he.N.G.call(this),le(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=new zt;function ye(t){Nt.call(this,"serverreachability",t)}function ve(t){de.dispatchEvent(new ye(de,t))}function me(t){Nt.call(this,"statevent",t)}function ge(t){de.dispatchEvent(new me(de,t))}function we(t){Nt.call(this,"timingevent",t)}function be(t,e){if("function"!=_(t))throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}F(ye,Nt),F(me,Nt),F(we,Nt);var Ee={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},Ie={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function Te(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function Ae(){}Te.prototype.a=null;var Se,ke={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function De(){Nt.call(this,"d")}function Re(){Nt.call(this,"c")}function _e(){}function Oe(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new he(this),this.O=Ce,t=ct?125:void 0,this.P=new ie(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}F(De,Nt),F(Re,Nt),F(_e,Te),Se=new _e;var Ce=45e3,xe={},Le={};function Pe(t,e,n){t.F=1,t.f=an(Ze(e)),t.l=n,t.H=!0,Me(t,null)}function Ue(t,e,n,r){t.F=1,t.f=an(Ze(e)),t.l=null,t.H=n,Me(t,r)}function Me(t,e){t.v=G(),Ge(t),t.D=Ze(t.f),sn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ae(q(t.Ja,t,t.a),t.J)),fe(t.I,t.a,"readystatechange",t.cb),e=t.h?et(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),ve(1)}function qe(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Ve(t,n);if(i==Le){4==e&&(t.c=4,ge(14),r=!1);break}if(i==xe){t.c=4,ge(15),r=!1;break}ze(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(He(t),Be(t))}function Ve(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Le:(n=Number(e.substring(n,r)),isNaN(n)?xe:(r+=1)+n>e.length?Le:(e=e.substr(r,n),t.A=r+n,e))}function Ge(t){t.R=G()+t.O,Fe(t,t.O)}function Fe(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=be(q(t.ab,t),e)}function je(t){t.i&&(A.clearTimeout(t.i),t.i=null)}function Be(t){t.g.Ca()||t.m||t.g.na(t)}function He(t){je(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,oe(t.P),le(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function ze(t,e){try{t.g.Fa(t,e),ve(4)}catch(t){}}function Ye(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||S(t))H(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(C(t)||S(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(S(t))return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function We(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof We)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ke(t,e){Je(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Qe(t))}function Qe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Je(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Je(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=Oe.prototype).setTimeout=function(t){this.O=t},I.cb=function(t){t=t.target;var e=this.B;e&&3==Zn(t)?e.Ta():this.Ja(t)},I.Ja=function(t){try{if(t==this.a)t:{var e=Zn(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!ct&&!this.a.aa())){this.m||4!=e||7==n||ve(8==n||r<=0?3:2),je(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=tr(this.a,"X-HTTP-Initial-Response");if(s&&!W(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),He(this),Be(this);break t}this.s=!0,ze(this,a)}this.H?(qe(this,e,o),ct&&this.b&&3==e&&(fe(this.I,this.P,"tick",this.bb),this.P.start())):ze(this,o),4==e&&He(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Ge(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),He(this),Be(this)}}}catch(t){}},I.bb=function(){if(this.a){var t=Zn(this.a),e=this.a.aa();this.A<e.length&&(je(this),qe(this,t,e),this.b&&4!=t&&Ge(this))}},I.cancel=function(){this.m=!0,He(this)},I.ab=function(){this.i=null;var t=G();0<=t-this.R?(2!=this.F&&(ve(3),ge(17)),He(this),this.c=2,Be(this)):Fe(this,this.R-t)},(I=We.prototype).C=function(){Qe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.K=function(){return Qe(this),this.a.concat()},I.get=function(t,e){return Je(this.b,t)?this.b[t]:e},I.set=function(t,e){Je(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Xe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $e(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof $e?(this.h=void 0!==e?e:t.h,tn(this,t.f),this.j=t.j,en(this,t.b),nn(this,t.i),this.a=t.a,rn(this,En(t.c)),this.g=t.g):t&&(n=String(t).match(Xe))?(this.h=!!e,tn(this,n[1]||"",!0),this.j=un(n[2]||""),en(this,n[3]||"",!0),nn(this,n[4]),this.a=un(n[5]||"",!0),rn(this,n[6]||"",!0),this.g=un(n[7]||"")):(this.h=!!e,this.c=new vn(null,this.h))}function Ze(t){return new $e(t)}function tn(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function en(t,e,n){t.b=n?un(e,!0):e}function nn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function rn(t,e,n){e instanceof vn?(t.c=e,function(t,e){e&&!t.f&&(mn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(gn(this,e),bn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=hn(e,dn)),t.c=new vn(e,t.h))}function on(t,e,n){t.c.set(e,n)}function sn(t,e,n){O(n)||(n=[String(n)]),bn(t.c,e,n)}function an(t){return on(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^G()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return S(t)?(t=encodeURI(t).replace(e,cn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function cn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$e.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,fn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?pn:ln,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",hn(n,yn)),t.join("")},$e.prototype.resolve=function(t){var e=Ze(this),n=!!t.f;n?tn(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?en(e,t.b):n=null!=t.i;var r=t.a;if(n)nn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(J(i,"./")||J(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?rn(e,En(t.c)):n=!!t.g,n&&(e.g=t.g),e};var fn=/[#\/\?@]/g,ln=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,yn=/#/g;function vn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(n){n.a||(n.a=new We,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function gn(t,e){mn(t),e=In(t,e),Je(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ke(t.a,e))}function wn(t,e){return mn(t),e=In(t,e),Je(t.a.b,e)}function bn(t,e,n){gn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),Y(n)),t.b+=n.length)}function En(t){var e=new vn;return e.c=t.c,t.a&&(e.a=new We(t.a),e.b=t.b),e}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Tn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Nn(t){var e=t.a.F.a;if(null!=e)ge(4),e?(ge(10),lr(t.a,t,!1)):(ge(11),lr(t.a,t,!0));else{t.b=new Oe(t,void 0,void 0),t.b.h=t.h,e=mr(e=t.a,e.Y()?t.f:null,t.i),ge(4),sn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&on(e,n,r),Ue(t.b,e,!1,t.f)}}function An(){this.a=this.b=null}function Sn(){this.a=new We}function kn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[L]||(t[L]=++P)):e.charAt(0)+t}function Dn(t,e){this.b=t,this.a=e}function Rn(t){this.g=t||_n,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ka&&A.ka.Da&&A.ka.Da()&&A.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Sn),this.b=null,this.c=[]}(I=vn.prototype).add=function(t,e){mn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){H(t,function(t){n.call(r,t,e,this)},this)},this)},I.K=function(){mn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.C=function(t){mn(this);var e=[];if(S(t))wn(this,t)&&(e=z(e,this.a.get(In(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},I.set=function(t,e){return mn(this),this.c=null,wn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},F(function(){},function(){}),(I=Tn.prototype).M=null,I.$=function(t){return this.a.$(t)},I.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},I.Ca=function(){return!1},I.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=tr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=tr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void yr(e,2)}this.f=r[0]}else(e=this.a).m=this.c,yr(e,2)}else 1==this.M&&(this.g?ge(6):"11111"==e?(ge(5),this.g=!0,(!ut||10<=Number(mt))&&(this.c=200,this.b.cancel(),ge(11),lr(this.a,this,!0))):(ge(7),this.g=!1))},I.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Nn(this)):1==this.M&&(this.g?(ge(11),lr(this.a,this,!0)):(ge(10),lr(this.a,this,!1)));else{0==this.M?ge(8):1==this.M&&ge(9);var t=this.a;t.m=this.c,yr(t,2)}},I.Y=function(){return this.a.Y()},I.ma=function(){return this.a.ma()},Sn.prototype.add=function(t){this.a.set(kn(t),t)},Sn.prototype.C=function(){return this.a.C()};var _n=10;function On(t,e){!t.a&&(J(e,"spdy")||J(e,"quic")||J(e,"h2"))&&(t.f=t.g,t.a=new Sn,t.b&&(Pn(t,t.b),t.b=null))}function Cn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function xn(t){return t.b?1:t.a?t.a.a.c:0}function Ln(t,e){return t=t.b?t.b==e:!!t.a&&(e=kn(e),Je(t.a.a.b,e))}function Pn(t,e){t.a?t.a.add(e):t.b=e}function Un(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=kn(e),n=Je(t.a.a.b,n)),n&&Ke(t.a.a,kn(e)))}function Mn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return Y(t.c);var e=t.c;return H(t.a.C(),function(t){e=e.concat(t.j)}),e}function qn(){}function Vn(){this.a=new qn}function Gn(t,r,e){var i=e||"";try{Ye(t,function(t,e){var n=t;x(t)&&(n=Wt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Fn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Rn.prototype.cancel=function(){this.c=Mn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(H(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},qn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},qn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var jn=A.JSON.parse;function Bn(t){zt.call(this),this.headers=new We,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Hn,this.D=this.F=!1}F(Bn,zt);var Hn="",zn=/^https?$/i,Yn=["POST","PUT"];function Wn(t){return"content-type"==t.toLowerCase()}function Kn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Qn(t),Xn(t)}function Qn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Jn(t){if(t.b&&void 0!==N&&(!t.s[1]||4!=Zn(t)||2!=t.T()))if(t.l&&4==Zn(t))se(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Zn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Xe)[1]||null;if(!o&&A.self&&A.self.location){var s=A.self.location.protocol;o=s.substr(0,s.length-1)}i=!zn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Zn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.T()+"]",Qn(t)}}finally{Xn(t)}}}function Xn(t,e){if(t.a){$n(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function $n(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Zn(t){return t.a?t.a.readyState:0}function tr(t,e){return t.a?t.a.getResponseHeader(e):null}function er(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return tt(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),S(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return on(t,e,n),t}function nr(t){this.f=[],this.F=new An,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!D("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=D("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=D("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=D("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=D("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Rn(t&&t.concurrentRequestLimit),this.ja=new Vn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function rr(t){if(ir(t),3==t.u){var e=t.P++,n=Ze(t.B);on(n,"SID",t.H),on(n,"RID",e),on(n,"TYPE","terminate"),ur(t,n),(e=new Oe(t,e,void 0)).F=2,e.f=an(Ze(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.f.toString(),"")),!n&&A.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=G(),Ge(e)}vr(t)}function ir(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(A.clearTimeout(t.l),t.l=null),pr(t),t.b.cancel(),t.h&&(k(t.h)&&A.clearTimeout(t.h),t.h=null)}function or(t,e){t.f.push(new Dn(t.Qa++,e)),3==t.u&&sr(t)}function sr(t){Cn(t.b)||t.h||(t.h=!0,te(t.Ha,t),t.A=0)}function ar(t,e){var n;n=e?e.W:t.P++;var r=Ze(t.B);on(r,"SID",t.H),on(r,"RID",n),on(r,"AID",t.O),ur(t,r),t.g&&t.i&&er(r,t.g,t.i),n=new Oe(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=hr(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Pn(t.b,n),Pe(n,r,e)}function ur(t,n){t.c&&Ye({},function(t,e){on(n,e,t)})}function hr(t,e,n){n=Math.min(t.f.length,n);var r=t.c?q(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var h=i[u].b,c=i[u].a;if((h-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{Gn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function cr(t){t.a||t.l||(t.S=1,te(t.Ga,t),t.v=0)}function fr(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=be(q(t.Ga,t),dr(t,t.v)),t.v++,!0)}function lr(t,e,n){var r=e.l;r&&On(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=mr(t,null,t.ha),sr(t)}function pr(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function dr(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function yr(t,e){if(2==e){var n=null;t.c&&(n=null);var r=q(t.eb,t);n||(n=new $e("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||tn(n,"https"),an(n)),function(t,e){var n=new pe;if(A.Image){var r=new Image;r.onload=V(Fn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=V(Fn,n,r,"TestLoadImage: error",!1,e),r.onabort=V(Fn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=V(Fn,n,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.ta(e),vr(t),ir(t)}function vr(t){t.u=0,t.m=-1,t.c&&(0==Mn(t.b).length&&0==t.f.length||(t.b.c.length=0,Y(t.f),t.f.length=0),t.c.sa())}function mr(t,e,n){var r=function(t){return t instanceof $e?Ze(t):new $e(t,void 0)}(n);if(""!=r.b)e&&en(r,e+"."+r.b),nn(r,r.i);else{var i,o=A.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new $e(null,void 0);return t&&tn(i,t),e&&en(i,e),n&&nn(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&tt(t.V,function(t,e){on(r,e,t)}),e=t.j,n=t.I,e&&n&&on(r,e,n),on(r,"VER",t.wa),ur(t,r),r}function gr(){}function wr(){if(ut&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function br(t,e){zt.call(this),this.a=new nr(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Tr(this)}function Er(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Ir(){Re.call(this),this.status=1}function Tr(t){this.a=t}(I=Bn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ne(this.H):Ne(Se),this.a.onreadystatechange=q(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Kn(this,t)}t=n||"";var i=new We(this.headers);r&&Ye(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Wn,n=t.length,r=S(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:S(t)?t.charAt(e):t[e]}(i.K()),n=A.FormData&&t instanceof A.FormData,0<=B(Yn,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{$n(this),0<this.o&&((this.D=function(t){return ut&&wt(9)&&k(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=q(this.Ba,this)):this.m=se(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Kn(this,t)}},I.Ba=function(){void 0!==N&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Xn(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Xn(this,!0)),Bn.N.G.call(this)},I.Ea=function(){this.j||(this.w||this.l||this.g?Jn(this):this.Za())},I.Za=function(){Jn(this)},I.T=function(){try{return 2<Zn(this)?this.a.status:-1}catch(t){return-1}},I.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),jn(e)}},I.ya=function(){return this.h},I.Xa=function(){return S(this.f)?this.f:String(this.f)},(I=nr.prototype).wa=8,I.u=1,I.Ca=function(){return 0==this.u},I.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Oe(this,t,void 0),r=this.i;if(this.J&&(r?rt(r=et(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&S(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=hr(this,n,e),on(i=Ze(this.B),"RID",t),on(i,"CVER",22),this.o&&this.j&&on(i,"X-HTTP-Session-Id",this.j),ur(this,i),this.g&&r&&er(i,this.g,r),Pn(this.b,n),this.W?(on(i,"$req",e),on(i,"SID","null"),n.S=!0,Pe(n,i,null)):Pe(n,i,e),this.u=2}}else 3==this.u&&(t?ar(this,t):0==this.f.length||Cn(this.b)||ar(this))},I.Ga=function(){this.l=null,this.a=new Oe(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ze(this.pa);on(t,"RID","rpc"),on(t,"SID",this.H),on(t,"CI",this.ia?"0":"1"),on(t,"AID",this.O),ur(this,t),on(t,"TYPE","xmlhttp"),this.g&&this.i&&er(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Ue(this.a,t,!0,this.ga)},I.Fa=function(t,e){if(0!=this.u&&(this.a==t||Ln(this.b,t)))if(this.m=t.o,!t.s&&Ln(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(O(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;pr(this),this.a.cancel(),this.a=null}fr(this),ge(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=be(q(this.Ya,this),6e3));if(xn(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else yr(this,11)}else if(!t.s&&this.a!=t||pr(this),!W(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&k(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=tr(r,"X-Client-Wire-Protocol"))&&On(this.b,i),this.j&&(r=tr(r,"X-HTTP-Session-Id")))&&(this.I=r,on(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=mr(this,this.Y()?this.ga:null,this.ha),r.s?(Un(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(je(r),Ge(r)),this.a=r):cr(this),0<this.f.length&&sr(this)}else"stop"!=r[0]&&"close"!=r[0]||yr(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?yr(this,7):rr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},I.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,fr(this),ge(19))},I.na=function(t){var e=null;if(this.a==t){pr(this),this.a=null;var n=2}else{if(!Ln(this.b,t))return;e=t.j,Un(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=G()-t.v,de.dispatchEvent(new we(de,t.l?t.l.length:0,e,this.A)),sr(this)):cr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(xn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=be(q(t.Ha,t,e),dr(t,t.A)),t.A++,!0))}(this,t)||2==n&&fr(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:yr(this,5);break;case 4:yr(this,10);break;case 3:yr(this,6);break;default:yr(this,2)}}},I.eb=function(t){ge(t?2:1)},I.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Bn(this.Ka)).F=this.R,t},I.ma=function(){return!!this.c&&!0},I.Y=function(){return this.R},(I=gr.prototype).va=function(){},I.ua=function(){},I.ta=function(){},I.sa=function(){},I.Sa=function(){},wr.prototype.a=function(t,e){return new br(t,e)},F(br,zt),(I=br.prototype).addEventListener=function(t,e,n,r){br.N.addEventListener.call(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){br.N.removeEventListener.call(this,t,e,n,r)},I.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;ge(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Tn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=er(e,t.g,t.i)),(t=t.w).i=n,e=mr(t.a,null,t.i),ge(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Nn(t)):(sn(e,"MODE","init"),!t.a.o&&t.a.j&&sn(e,"X-HTTP-Session-Id",t.a.j),t.b=new Oe(t,void 0,void 0),t.b.h=t.h,Ue(t.b,e,!1,null),t.M=0)},I.close=function(){rr(this.a)},I.Wa=function(t){if(S(t)){var e={};e.__data__=t,or(this.a,e)}else this.h?((e={}).__data__=Wt(t),or(this.a,e)):or(this.a,t)},I.G=function(){this.a.c=null,delete this.f,rr(this.a),delete this.a,br.N.G.call(this)},F(Er,De),F(Ir,Re),F(Tr,gr),Tr.prototype.va=function(){this.a.dispatchEvent("a")},Tr.prototype.ua=function(t){this.a.dispatchEvent(new Er(t))},Tr.prototype.ta=function(t){this.a.dispatchEvent(new Ir(t))},Tr.prototype.sa=function(){this.a.dispatchEvent("b")};var Nr=V(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},wr);wr.prototype.createWebChannel=wr.prototype.a,br.prototype.send=br.prototype.Wa,br.prototype.open=br.prototype.Va,br.prototype.close=br.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Ie.COMPLETE="complete",(Ae.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",zt.prototype.listen=zt.prototype.za,Bn.prototype.listenOnce=Bn.prototype.Aa,Bn.prototype.getLastError=Bn.prototype.Xa,Bn.prototype.getLastErrorCode=Bn.prototype.ya,Bn.prototype.getStatus=Bn.prototype.T,Bn.prototype.getResponseJson=Bn.prototype.Ua,Bn.prototype.getResponseText=Bn.prototype.aa,Bn.prototype.send=Bn.prototype.ca;var Ar,Sr,kr={createWebChannelTransport:Nr,ErrorCode:Ee,EventType:Ie,WebChannel:Ae,XhrIo:Bn},Dr=kr.createWebChannelTransport,Rr=kr.ErrorCode,_r=kr.EventType,Or=kr.WebChannel,Cr=kr.XhrIo,xr=Yd.SDK_VERSION,Lr=new u("@firebase/firestore");function Pr(){return Lr.logLevel===o.DEBUG?Ar.DEBUG:Lr.logLevel===o.SILENT?Ar.SILENT:Ar.ERROR}function Ur(t){switch(t){case Ar.DEBUG:Lr.logLevel=o.DEBUG;break;case Ar.ERROR:Lr.logLevel=o.ERROR;break;case Ar.SILENT:Lr.logLevel=o.SILENT;break;default:Lr.error("Firestore ("+xr+"): Invalid value passed to `setLogLevel`")}}function Mr(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Lr.logLevel<=o.DEBUG){var i=n.map(Vr);Lr.debug.apply(Lr,s(["Firestore ("+xr+") ["+t+"]: "+e],i))}}function qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Lr.logLevel<=o.ERROR){var r=e.map(Vr);Lr.error.apply(Lr,s(["Firestore ("+xr+"): "+t],r))}}function Vr(t){if("string"==typeof t)return t;var e=zu.t();try{return e.i(t)}catch(e){return t}}function Gr(t){var e="FIRESTORE ("+xr+") INTERNAL ASSERTION FAILED: "+t;throw qr(e),new Error(e)}function Fr(t,e){t||Gr(e)}(Sr=Ar=Ar||{})[Sr.DEBUG=0]="DEBUG",Sr[Sr.ERROR=1]="ERROR",Sr[Sr.SILENT=2]="SILENT";var jr=(Br.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Fr(20===e.length,"Invalid auto ID: "+e),e},Br);function Br(){}function Hr(t,e){return t<e?-1:e<t?1:0}function zr(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Yr(t){return t+"\0"}function Wr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}function Kr(t,e){this.user=e,this.type="OAuth",this.g={},this.g.Authorization="Bearer "+t}var Qr,Jr="(default)",Xr=(Object.defineProperty(fi.prototype,"o",{get:function(){return this.database===Jr},enumerable:!0,configurable:!0}),fi.prototype.isEqual=function(t){return t instanceof fi&&t.projectId===this.projectId&&t.database===this.database},fi.prototype.h=function(t){return Hr(this.projectId,t.projectId)||Hr(this.database,t.database)},fi),$r=(ci.prototype.l=function(){return null!=this.uid},ci.prototype.v=function(){return this.l()?"uid:"+this.uid:"anonymous-user"},ci.prototype.isEqual=function(t){return t.uid===this.uid},ci.UNAUTHENTICATED=new ci(null),ci.m=new ci("google-credentials-uid"),ci.p=new ci("first-party-uid"),ci),Zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ti=(t(hi,Qr=Error),hi),ei=(ui.prototype.getToken=function(){return Promise.resolve(null)},ui.prototype.I=function(){},ui.prototype.T=function(t){Fr(!this._,"Can only call setChangeListener() once."),(this._=t)($r.UNAUTHENTICATED)},ui.prototype.R=function(){Fr(null!==this._,"removeChangeListener() when no listener registered"),this._=null},ui),ni=(ai.prototype.getToken=function(){var e=this;Fr(null!=this.A,"getToken cannot be called after listener removed.");var n=this.P,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.P!==n)throw new ti(Zr.ABORTED,"getToken aborted due to token change.");return t?(Fr("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new Kr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},ai.prototype.I=function(){this.forceRefresh=!0},ai.prototype.T=function(t){Fr(!this._,"Can only call setChangeListener() once."),this._=t,this.D&&t(this.currentUser)},ai.prototype.R=function(){Fr(null!=this.A,"removeChangeListener() called twice"),Fr(null!==this._,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.A),this.A=null,this._=null},ai.prototype.S=function(){var t=this.auth&&this.auth.getUid();return Fr(null===t||"string"==typeof t,"Received invalid UID: "+t),new $r(t)},ai),ri=(Object.defineProperty(si.prototype,"g",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.C.auth.N([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),si),ii=(oi.prototype.getToken=function(){return Promise.resolve(new ri(this.C,this.V))},oi.prototype.T=function(t){t($r.p)},oi.prototype.R=function(){},oi.prototype.I=function(){},oi);function oi(t,e){this.C=t,this.V=e}function si(t,e){this.C=t,this.V=e,this.type="FirstParty",this.user=$r.p}function ai(t){var e=this;this.A=null,this.currentUser=$r.UNAUTHENTICATED,this.D=!1,this.P=0,this._=null,this.forceRefresh=!1,this.A=function(){e.P++,e.currentUser=e.S(),e.D=!0,e._&&e._(e.currentUser)},this.P=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.A):(this.A(null),t.get().then(function(t){e.auth=t,e.A&&e.auth.addAuthTokenListener(e.A)},function(){}))}function ui(){this._=null}function hi(t,e){var n=Qr.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function ci(t){this.uid=t}function fi(t,e){this.projectId=t,this.database=e||Jr}function li(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function pi(t,e){return void 0!==t?t:e}function di(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function yi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function vi(t){for(var e in Fr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function mi(t,e){if(0!==e.length)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Li(e.length,"argument")+".")}function gi(t,e,n){if(e.length!==n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires "+Li(n,"argument")+", but was called with "+Li(e.length,"argument")+".")}function wi(t,e,n){if(e.length<n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Li(n,"argument")+", but was called with "+Li(e.length,"argument")+".")}function bi(t,e,n,r){if(e.length<n||e.length>r)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Li(e.length,"argument")+".")}function Ei(t,e,n,r){Si(t,e,xi(n)+" argument",r)}function Ii(t,e,n,r){void 0!==r&&Ei(t,e,n,r)}function Ti(t,e,n,r){Si(t,e,n+" option",r)}function Ni(t,e,n,r){void 0!==r&&Ti(t,e,n,r)}function Ai(t,e,n,r,h){void 0!==r&&function(t,e,n,r){for(var i=[],o=0,s=h;o<s.length;o++){var a=s[o];if(a===r)return;i.push(Di(a))}var u=Di(r);throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+i.join(", "))}(t,0,n,r)}function Si(t,e,n,r){if(!("object"===e?ki(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Di(r);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function ki(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Di(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Gr("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Ri(t,e,n){if(void 0===n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+xi(e)+" argument, but it was undefined.")}function _i(n,t,r){yi(t,function(t,e){if(r.indexOf(t)<0)throw new ti(Zr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Oi(t,e,n,r){var i=Di(r);return new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+xi(n)+" argument to be a "+e+", but it was: "+i)}function Ci(t,e,n){if(n<=0)throw new ti(Zr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+xi(e)+" argument to be a positive number, but it was: "+n+".")}function xi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Li(t,e){return t+" "+e+(1===t?"":"s")}var Pi,Ui,Mi=(Object.defineProperty(oo.prototype,"latitude",{get:function(){return this.O},enumerable:!0,configurable:!0}),Object.defineProperty(oo.prototype,"longitude",{get:function(){return this.F},enumerable:!0,configurable:!0}),oo.prototype.isEqual=function(t){return this.O===t.O&&this.F===t.F},oo.prototype.j=function(t){return Hr(this.O,t.O)||Hr(this.F,t.F)},oo),qi=(io.now=function(){return io.fromMillis(Date.now())},io.fromDate=function(t){return io.fromMillis(t.getTime())},io.fromMillis=function(t){var e=Math.floor(t/1e3);return new io(e,1e6*(t-1e3*e))},io.prototype.toDate=function(){return new Date(this.toMillis())},io.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},io.prototype.j=function(t){return this.seconds===t.seconds?Hr(this.nanoseconds,t.nanoseconds):Hr(this.seconds,t.seconds)},io.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},io.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},io),Vi=(ro.U=function(t){var e=Math.floor(t/1e6);return new ro(new qi(e,t%1e6*1e3))},ro.L=function(t){return new ro(t)},ro.B=function(){return ro.MIN},ro.prototype.h=function(t){return this.timestamp.j(t.timestamp)},ro.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ro.prototype.M=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ro.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ro.prototype.q=function(){return this.timestamp},ro.MIN=new ro(new qi(0,0)),ro),Gi=(Object.defineProperty(no.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),no.prototype.isEqual=function(t){return 0===no.G(this,t)},no.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof no?t.forEach(function(t){e.push(t)}):e.push(t),this.W(e)},no.prototype.limit=function(){return this.offset+this.length},no.prototype.K=function(t){return t=void 0===t?1:t,Fr(this.length>=t,"Can't call popFirst() with less segments"),this.W(this.segments,this.offset+t,this.length-t)},no.prototype.H=function(){return Fr(!this.J(),"Can't call popLast() on empty path"),this.W(this.segments,this.offset,this.length-1)},no.prototype.Y=function(){return Fr(!this.J(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},no.prototype.X=function(){return this.get(this.length-1)},no.prototype.get=function(t){return Fr(t<this.length,"Index out of range"),this.segments[this.offset+t]},no.prototype.J=function(){return 0===this.length},no.prototype.$=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},no.prototype.Z=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},no.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},no.prototype.tt=function(){return this.segments.slice(this.offset,this.limit())},no.G=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},no),Fi=(t(eo,Ui=Gi),eo.prototype.W=function(t,e,n){return new eo(t,e,n)},eo.prototype.nt=function(){return this.tt().join("/")},eo.prototype.toString=function(){return this.nt()},eo.it=function(t){if(0<=t.indexOf("//"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new eo(t.split("/").filter(function(t){return 0<t.length}))},eo.et=new eo([]),eo),ji=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Bi=(t(to,Pi=Gi),to.prototype.W=function(t,e,n){return new to(t,e,n)},to.rt=function(t){return ji.test(t)},to.prototype.nt=function(){return this.tt().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),to.rt(t)||(t="`"+t+"`"),t}).join(".")},to.prototype.toString=function(){return this.nt()},to.prototype.ut=function(){return 1===this.length&&"__name__"===this.get(0)},to.st=function(){return new to(["__name__"])},to.ot=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new ti(Zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new ti(Zr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new to(e)},to.et=new to([]),to),Hi=(Zi.prototype.ct=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Zi.prototype.isEqual=function(t){return null!==t&&0===Fi.G(this.path,t.path)},Zi.prototype.toString=function(){return this.path.toString()},Zi.G=function(t,e){return Fi.G(t.path,e.path)},Zi.ht=function(t){return t.length%2==0},Zi.at=function(t){return new Zi(new Fi(t.slice()))},Zi.ft=function(t){return new Zi(Fi.it(t))},Zi.EMPTY=new Zi(new Fi([])),Zi),zi=($i.prototype.lt=function(t,e){return new $i(this.G,this.root.lt(t,e,this.G).copy(null,null,Wi.dt,null,null))},$i.prototype.remove=function(t){return new $i(this.G,this.root.remove(t,this.G).copy(null,null,Wi.dt,null,null))},$i.prototype.get=function(t){for(var e=this.root;!e.J();){var n=this.G(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},$i.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.J();){var r=this.G(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},$i.prototype.J=function(){return this.root.J()},Object.defineProperty($i.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),$i.prototype.vt=function(){return this.root.vt()},$i.prototype.wt=function(){return this.root.wt()},$i.prototype.pt=function(t){return this.root.pt(t)},$i.prototype.forEach=function(n){this.pt(function(t,e){return n(t,e),!1})},$i.prototype.toString=function(){var n=[];return this.pt(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},$i.prototype.gt=function(t){return this.root.gt(t)},$i.prototype.bt=function(){return new Yi(this.root,null,this.G,!1)},$i.prototype.yt=function(t){return new Yi(this.root,t,this.G,!1)},$i.prototype._t=function(){return new Yi(this.root,null,this.G,!0)},$i.prototype.It=function(t){return new Yi(this.root,t,this.G,!0)},$i),Yi=(Xi.prototype.Rt=function(){Fr(0<this.Et.length,"getNext() called on iterator when hasNext() is false.");var t=this.Et.pop(),e={key:t.key,value:t.value};if(this.Tt)for(t=t.left;!t.J();)this.Et.push(t),t=t.right;else for(t=t.right;!t.J();)this.Et.push(t),t=t.left;return e},Xi.prototype.At=function(){return 0<this.Et.length},Xi.prototype.Dt=function(){if(0===this.Et.length)return null;var t=this.Et[this.Et.length-1];return{key:t.key,value:t.value}},Xi),Wi=(Ji.prototype.copy=function(t,e,n,r,i){return new Ji(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ji.prototype.J=function(){return!1},Ji.prototype.pt=function(t){return this.left.pt(t)||t(this.key,this.value)||this.right.pt(t)},Ji.prototype.gt=function(t){return this.right.gt(t)||t(this.key,this.value)||this.left.gt(t)},Ji.prototype.min=function(){return this.left.J()?this:this.left.min()},Ji.prototype.vt=function(){return this.min().key},Ji.prototype.wt=function(){return this.right.J()?this.key:this.right.wt()},Ji.prototype.lt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.lt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.lt(t,e,n))).Pt()},Ji.prototype.St=function(){if(this.left.J())return Ji.EMPTY;var t=this;return t.left.Ct()||t.left.left.Ct()||(t=t.Vt()),(t=t.copy(null,null,null,t.left.St(),null)).Pt()},Ji.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.J()||r.left.Ct()||r.left.left.Ct()||(r=r.Vt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Ct()&&(r=r.Nt()),r.right.J()||r.right.Ct()||r.right.left.Ct()||(r=r.kt()),0===e(t,r.key)){if(r.right.J())return Ji.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.St())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Pt()},Ji.prototype.Ct=function(){return this.color},Ji.prototype.Pt=function(){var t=this;return t.right.Ct()&&!t.left.Ct()&&(t=t.Ot()),t.left.Ct()&&t.left.left.Ct()&&(t=t.Nt()),t.left.Ct()&&t.right.Ct()&&(t=t.Ft()),t},Ji.prototype.Vt=function(){var t=this.Ft();return t.right.left.Ct()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Nt())).Ot()).Ft()),t},Ji.prototype.kt=function(){var t=this.Ft();return t.left.left.Ct()&&(t=(t=t.Nt()).Ft()),t},Ji.prototype.Ot=function(){var t=this.copy(null,null,Ji.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ji.prototype.Nt=function(){var t=this.copy(null,null,Ji.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ji.prototype.Ft=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ji.prototype.xt=function(){var t=this.jt();return Math.pow(2,t)<=this.size+1},Ji.prototype.jt=function(){if(this.Ct()&&this.left.Ct())throw Gr("Red node has red child("+this.key+","+this.value+")");if(this.right.Ct())throw Gr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.jt();if(t!==this.right.jt())throw Gr("Black depths differ");return t+(this.Ct()?0:1)},Ji.EMPTY=null,Ji.RED=!0,Ji.dt=!1,Ji),Ki=(Object.defineProperty(Qi.prototype,"key",{get:function(){throw Gr("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"value",{get:function(){throw Gr("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"color",{get:function(){throw Gr("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"left",{get:function(){throw Gr("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Qi.prototype,"right",{get:function(){throw Gr("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Qi.prototype.copy=function(t,e,n,r,i){return this},Qi.prototype.lt=function(t,e,n){return new Wi(t,e)},Qi.prototype.remove=function(t,e){return this},Qi.prototype.J=function(){return!0},Qi.prototype.pt=function(t){return!1},Qi.prototype.gt=function(t){return!1},Qi.prototype.vt=function(){return null},Qi.prototype.wt=function(){return null},Qi.prototype.Ct=function(){return!1},Qi.prototype.xt=function(){return!0},Qi.prototype.jt=function(){return 0},Qi);function Qi(){this.size=0}function Ji(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ji.RED,this.left=null!=r?r:Ji.EMPTY,this.right=null!=i?i:Ji.EMPTY,this.size=this.left.size+1+this.right.size}function Xi(t,e,n,r){this.Tt=r,this.Et=[];for(var i=1;!t.J();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Tt?t.left:t.right;else{if(0===i){this.Et.push(t);break}this.Et.push(t),t=this.Tt?t.right:t.left}}function $i(t,e){this.G=t,this.root=e||Wi.EMPTY}function Zi(t){this.path=t,Fr(Zi.ht(t),"Invalid DocumentKey with an odd number of segments: "+t.tt().join("/"))}function to(){return null!==Pi&&Pi.apply(this,arguments)||this}function eo(){return null!==Ui&&Ui.apply(this,arguments)||this}function no(t,e,n){void 0===e?e=0:e>t.length&&Gr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Gr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}function ro(t){this.timestamp=t}function io(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function oo(t,e){if(gi("GeoPoint",arguments,2),Ei("GeoPoint","number",1,t),Ei("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new ti(Zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new ti(Zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.O=t,this.F=e}Wi.EMPTY=new Ki;var so=(go.Ut=function(t){var e=new go(t.G);return t.forEach(function(t){e=e.add(t)}),e},go.prototype.has=function(t){return null!==this.data.get(t)},go.prototype.first=function(){return this.data.vt()},go.prototype.last=function(){return this.data.wt()},Object.defineProperty(go.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),go.prototype.indexOf=function(t){return this.data.indexOf(t)},go.prototype.forEach=function(n){this.data.pt(function(t,e){return n(t),!1})},go.prototype.Lt=function(t,e){for(var n=this.data.yt(t[0]);n.At();){var r=n.Rt();if(0<=this.G(r.key,t[1]))return;e(r.key)}},go.prototype.Bt=function(t,e){var n;for(n=void 0!==e?this.data.yt(e):this.data.bt();n.At();)if(!t(n.Rt().key))return},go.prototype.Mt=function(t){var e=this.data.yt(t);return e.At()?e.Rt().key:null},go.prototype.bt=function(){return new ao(this.data.bt())},go.prototype.yt=function(t){return new ao(this.data.yt(t))},go.prototype.add=function(t){return this.copy(this.data.remove(t).lt(t,!0))},go.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},go.prototype.J=function(){return this.data.J()},go.prototype.qt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},go.prototype.isEqual=function(t){if(!(t instanceof go))return!1;if(this.size!==t.size)return!1;for(var e=this.data.bt(),n=t.data.bt();e.At();){var r=e.Rt().key,i=n.Rt().key;if(0!==this.G(r,i))return!1}return!0},go.prototype.tt=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},go.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},go.prototype.copy=function(t){var e=new go(this.G);return e.data=t,e},go),ao=(mo.prototype.Rt=function(){return this.Qt.Rt().key},mo.prototype.At=function(){return this.Qt.At()},mo),uo=(vo.prototype.Gt=function(t,e){return new ks(e,t)},vo.prototype.Wt=function(t,e){return e},vo.prototype.zt=function(t){return null},vo.prototype.isEqual=function(t){return t instanceof vo},vo.instance=new vo,vo),ho=(yo.prototype.Gt=function(t,e){return this.apply(t)},yo.prototype.Wt=function(t,e){return this.apply(t)},yo.prototype.apply=function(t){for(var n=wo(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Cs(n)},yo.prototype.zt=function(t){return null},yo.prototype.isEqual=function(t){return t instanceof yo&&zr(t.elements,this.elements)},yo),co=(po.prototype.Gt=function(t,e){return this.apply(t)},po.prototype.Wt=function(t,e){return this.apply(t)},po.prototype.apply=function(t){for(var n=wo(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Cs(n)},po.prototype.zt=function(t){return null},po.prototype.isEqual=function(t){return t instanceof po&&zr(t.elements,this.elements)},po),fo=(lo.prototype.Gt=function(t,e){var n=this.zt(t);if(n instanceof Ts&&this.Kt instanceof Ts){var r=n.Ht+this.Kt.Ht;return new Ts(r)}return r=n.Ht+this.Kt.Ht,new Ns(r)},lo.prototype.Wt=function(t,e){return Fr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},lo.prototype.zt=function(t){return t instanceof rs?t:new Ts(0)},lo.prototype.isEqual=function(t){return t instanceof lo&&this.Kt.isEqual(t.Kt)},lo);function lo(t){this.Kt=t}function po(t){this.elements=t}function yo(t){this.elements=t}function vo(){}function mo(t){this.Qt=t}function go(t){this.G=t,this.data=new zi(this.G)}function wo(t){return t instanceof Cs?t.Ht.slice():[]}function bo(t,e){this.version=t,this.transformResults=e}var Eo,Io,To=(So.Jt=function(t){return new So(t)},So.Yt=function(t){var e=new so(Bi.G);return t.forEach(function(t){return e=e.add(t)}),new So(e)},So.prototype.Xt=function(e){var n=!1;return this.fields.forEach(function(t){t.$(e)&&(n=!0)}),n},So.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},So),No=(Ao.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Ao);function Ao(t,e){this.field=t,this.transform=e}function So(t){this.fields=t}(Io=Eo=Eo||{})[Io.Set=0]="Set",Io[Io.$t=1]="__PRIVATE_Patch",Io[Io.Transform=2]="Transform",Io[Io.Zt=3]="__PRIVATE_Delete",Io[Io.Verify=4]="Verify";var ko,Do,Ro,_o,Oo,Co,xo,Lo,Po,Uo=(Qo.exists=function(t){return new Qo(void 0,t)},Qo.updateTime=function(t){return new Qo(t)},Object.defineProperty(Qo.prototype,"tn",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Qo.prototype.nn=function(t){return void 0!==this.updateTime?t instanceof Ls&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Ls:(Fr(this.tn,"Precondition should be empty"),!0)},Qo.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},Qo.NONE=new Qo,Qo),Mo=(Ko.prototype.in=function(t){null!=t&&Fr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Ko.en=function(t){return t instanceof Ls?t.version:Vi.MIN},Ko),qo=(t(Wo,Po=Mo),Wo.prototype.Wt=function(t,e){this.in(t),Fr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Ls(this.key,n,{hasCommittedMutations:!0},this.value)},Wo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=Mo.en(t);return new Ls(this.key,r,{un:!0},this.value)},Wo.prototype.sn=function(t){return null},Wo.prototype.isEqual=function(t){return t instanceof Wo&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.rn.isEqual(t.rn)},Wo),Vo=(t(Yo,Lo=Mo),Yo.prototype.Wt=function(t,e){if(this.in(t),Fr(null==e.transformResults,"Transform results received by PatchMutation."),!this.rn.nn(t))return new Us(this.key,e.version);var n=this.hn(t);return new Ls(this.key,e.version,{hasCommittedMutations:!0},n)},Yo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=Mo.en(t),i=this.hn(t);return new Ls(this.key,r,{un:!0},i)},Yo.prototype.sn=function(t){return null},Yo.prototype.isEqual=function(t){return t instanceof Yo&&this.key.isEqual(t.key)&&this.on.isEqual(t.on)&&this.rn.isEqual(t.rn)},Yo.prototype.hn=function(t){var e;return e=t instanceof Ls?t.data():Os.EMPTY,this.cn(e)},Yo.prototype.cn=function(n){var r=this;return this.on.fields.forEach(function(t){if(!t.J()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},Yo),Go=(t(zo,xo=Mo),zo.prototype.Wt=function(t,e){if(this.in(t),Fr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.rn.nn(t))return new Us(this.key,e.version);var n=this.an(t),r=this.fn(t,e.transformResults),i=e.version,o=this.ln(n.data(),r);return new Ls(this.key,i,{hasCommittedMutations:!0},o)},zo.prototype.Gt=function(t,e,n){if(this.in(t),!this.rn.nn(t))return t;var r=this.an(t),i=this.dn(n,t,e),o=this.ln(r.data(),i);return new Ls(this.key,r.version,{un:!0},o)},zo.prototype.sn=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Ls?t.field(i.field):void 0,s=i.transform.zt(o||null);null!=s&&(e=null==e?Os.EMPTY.set(i.field,s):e.set(i.field,s))}return e},zo.prototype.isEqual=function(t){return t instanceof zo&&this.key.isEqual(t.key)&&zr(this.fieldTransforms,t.fieldTransforms)&&this.rn.isEqual(t.rn)},zo.prototype.an=function(t){return Fr(t instanceof Ls,"Unknown MaybeDocument type "+t),Fr(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},zo.prototype.fn=function(t,e){var n=[];Fr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof Ls&&(s=t.field(i.field)),n.push(o.Wt(s,e[r]))}return n},zo.prototype.dn=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],a=s.transform,u=null;e instanceof Ls&&(u=e.field(s.field)),null===u&&n instanceof Ls&&(u=n.field(s.field)),r.push(a.Gt(u,t))}return r},zo.prototype.ln=function(t,e){Fr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},zo),Fo=(t(Ho,Co=Mo),Ho.prototype.Wt=function(t,e){return this.in(t),Fr(null==e.transformResults,"Transform results received by DeleteMutation."),new Ps(this.key,e.version,{hasCommittedMutations:!0})},Ho.prototype.Gt=function(t,e,n){return this.in(t),this.rn.nn(t)?(t&&Fr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Ps(this.key,Vi.B())):t},Ho.prototype.sn=function(t){return null},Ho.prototype.isEqual=function(t){return t instanceof Ho&&this.key.isEqual(t.key)&&this.rn.isEqual(t.rn)},Ho),jo=(t(Bo,Oo=Mo),Bo.prototype.Wt=function(t,e){Gr("VerifyMutation should only be used in Transactions.")},Bo.prototype.Gt=function(t,e,n){Gr("VerifyMutation should only be used in Transactions.")},Bo.prototype.sn=function(t){Gr("VerifyMutation should only be used in Transactions.")},Bo.prototype.isEqual=function(t){return t instanceof Bo&&this.key.isEqual(t.key)&&this.rn.isEqual(t.rn)},Bo);function Bo(t,e){var n=Oo.call(this)||this;return n.key=t,n.rn=e,n.type=Eo.Verify,n}function Ho(t,e){var n=Co.call(this)||this;return n.key=t,n.rn=e,n.type=Eo.Zt,n}function zo(t,e){var n=xo.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Eo.Transform,n.rn=Uo.exists(!0),n}function Yo(t,e,n,r){var i=Lo.call(this)||this;return i.key=t,i.data=e,i.on=n,i.rn=r,i.type=Eo.$t,i}function Wo(t,e,n){var r=Po.call(this)||this;return r.key=t,r.value=e,r.rn=n,r.type=Eo.Set,r}function Ko(){}function Qo(t,e){this.updateTime=t,this.exists=e,Fr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}(Do=ko=ko||{})[Do.vn=0]="__PRIVATE_NullValue",Do[Do.wn=1]="__PRIVATE_BooleanValue",Do[Do.mn=2]="__PRIVATE_NumberValue",Do[Do.pn=3]="__PRIVATE_TimestampValue",Do[Do.gn=4]="__PRIVATE_StringValue",Do[Do.bn=5]="__PRIVATE_BlobValue",Do[Do.yn=6]="__PRIVATE_RefValue",Do[Do._n=7]="__PRIVATE_GeoPointValue",Do[Do.ArrayValue=8]="ArrayValue",Do[Do.In=9]="__PRIVATE_ObjectValue",(_o=Ro=Ro||{})[_o.Tn=0]="__PRIVATE_Default",_o[_o.En=1]="__PRIVATE_Estimate",_o[_o.Rn=2]="__PRIVATE_Previous";var Jo,Xo,$o,Zo=(us.Dn=function(t,e){switch(t.serverTimestamps){case"estimate":return new us(Ro.En,e);case"previous":return new us(Ro.Rn,e);case"none":case void 0:return new us(Ro.Tn,e);default:return Gr("fromSnapshotOptions() called with invalid options.")}},us),ts=(as.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},as.prototype.Pn=function(t){return Fr(this.Sn!==t.Sn,"Default compareTo should not be used for values of same type."),Hr(this.Sn,t.Sn)},as),es=(t(ss,$o=ts),ss.prototype.value=function(t){return null},ss.prototype.isEqual=function(t){return t instanceof ss},ss.prototype.h=function(t){return t instanceof ss?0:this.Pn(t)},ss.prototype.Cn=function(){return 4},ss.Vn=new ss,ss),ns=(t(os,Xo=ts),os.prototype.value=function(t){return this.Ht},os.prototype.isEqual=function(t){return t instanceof os&&this.Ht===t.Ht},os.prototype.h=function(t){return t instanceof os?Hr(this,t):this.Pn(t)},os.prototype.Cn=function(){return 4},os.of=function(t){return t?os.Nn:os.kn},os.Nn=new os(!0),os.kn=new os(!1),os),rs=(t(is,Jo=ts),is.prototype.value=function(t){return this.Ht},is.prototype.h=function(t){return t instanceof is?(e=this.Ht)<(n=t.Ht)?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1:this.Pn(t);var e,n},is.prototype.Cn=function(){return 8},is);function is(t){var e=Jo.call(this)||this;return e.Ht=t,e.Sn=ko.mn,e}function os(t){var e=Xo.call(this)||this;return e.Ht=t,e.Sn=ko.wn,e}function ss(){var t=$o.call(this)||this;return t.Sn=ko.vn,t.Ht=null,t}function as(){}function us(t,e){this.An=t,this.timestampsInSnapshots=e}function hs(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var cs,fs,ls,ps,ds,ys,vs,ms,gs,ws,bs,Es,Is,Ts=(t(ta,Is=rs),ta.prototype.isEqual=function(t){return t instanceof ta&&hs(this.Ht,t.Ht)},ta),Ns=(t(Zs,Es=rs),Zs.prototype.isEqual=function(t){return t instanceof Zs&&hs(this.Ht,t.Ht)},Zs.On=new Zs(NaN),Zs.POSITIVE_INFINITY=new Zs(1/0),Zs.NEGATIVE_INFINITY=new Zs(-1/0),Zs),As=(t($s,bs=ts),$s.prototype.value=function(t){return this.Ht},$s.prototype.isEqual=function(t){return t instanceof $s&&this.Ht===t.Ht},$s.prototype.h=function(t){return t instanceof $s?Hr(this.Ht,t.Ht):this.Pn(t)},$s.prototype.Cn=function(){return 2*this.Ht.length},$s),Ss=(t(Xs,ws=ts),Xs.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.Ht:this.Ht.toDate()},Xs.prototype.isEqual=function(t){return t instanceof Xs&&this.Ht.isEqual(t.Ht)},Xs.prototype.h=function(t){return t instanceof Xs?this.Ht.j(t.Ht):t instanceof ks?-1:this.Pn(t)},Xs.prototype.Cn=function(){return 16},Xs),ks=(t(Js,gs=ts),Js.prototype.value=function(t){return t&&t.An===Ro.En?new Ss(this.Fn).value(t):t&&t.An===Ro.Rn&&this.previousValue?this.previousValue.value(t):null},Js.prototype.isEqual=function(t){return t instanceof Js&&this.Fn.isEqual(t.Fn)},Js.prototype.h=function(t){return t instanceof Js?this.Fn.j(t.Fn):t instanceof Ss?1:this.Pn(t)},Js.prototype.toString=function(){return"<ServerTimestamp localTime="+this.Fn.toString()+">"},Js.prototype.Cn=function(){return 16+(this.previousValue?this.previousValue.Cn():0)},Js),Ds=(t(Qs,ms=ts),Qs.prototype.value=function(t){return this.Ht},Qs.prototype.isEqual=function(t){return t instanceof Qs&&this.Ht.isEqual(t.Ht)},Qs.prototype.h=function(t){return t instanceof Qs?this.Ht.j(t.Ht):this.Pn(t)},Qs.prototype.Cn=function(){return this.Ht.xn()},Qs),Rs=(t(Ks,vs=ts),Ks.prototype.value=function(t){return this.key},Ks.prototype.isEqual=function(t){return t instanceof Ks&&this.key.isEqual(t.key)&&this.s.isEqual(t.s)},Ks.prototype.h=function(t){if(t instanceof Ks){var e=this.s.h(t.s);return 0!==e?e:Hi.G(this.key,t.key)}return this.Pn(t)},Ks.prototype.Cn=function(){return this.s.projectId.length+this.s.database.length+this.key.toString().length},Ks),_s=(t(Ws,ys=ts),Ws.prototype.value=function(t){return this.Ht},Ws.prototype.isEqual=function(t){return t instanceof Ws&&this.Ht.isEqual(t.Ht)},Ws.prototype.h=function(t){return t instanceof Ws?this.Ht.j(t.Ht):this.Pn(t)},Ws.prototype.Cn=function(){return 16},Ws),Os=(t(Ys,ds=ts),Ys.prototype.value=function(n){var r={};return this.Ht.pt(function(t,e){r[t]=e.value(n)}),r},Ys.prototype.forEach=function(t){this.Ht.pt(t)},Ys.prototype.isEqual=function(t){if(t instanceof Ys){for(var e=this.Ht.bt(),n=t.Ht.bt();e.At()&&n.At();){var r=e.Rt(),i=n.Rt();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.At()&&!n.At()}return!1},Ys.prototype.h=function(t){if(t instanceof Ys){for(var e=this.Ht.bt(),n=t.Ht.bt();e.At()&&n.At();){var r=e.Rt(),i=n.Rt(),o=Hr(r.key,i.key)||r.value.h(i.value);if(o)return o}return Hr(e.At(),n.At())}return this.Pn(t)},Ys.prototype.set=function(t,e){if(Fr(!t.J(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.jn(t.Y(),e);var n=this.child(t.Y());n instanceof Ys||(n=Ys.EMPTY);var r=n.set(t.K(),e);return this.jn(t.Y(),r)},Ys.prototype.delete=function(t){if(Fr(!t.J(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new Ys(this.Ht.remove(t.Y()));var e=this.child(t.Y());if(e instanceof Ys){var n=e.delete(t.K());return new Ys(this.Ht.lt(t.Y(),n))}return this},Ys.prototype.contains=function(t){return null!==this.field(t)},Ys.prototype.field=function(t){Fr(!t.J(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof Ys?e.Ht.get(t):null}),e},Ys.prototype.on=function(){var i=new so(Bi.G);return this.Ht.forEach(function(t,e){var n=new Bi([t]);if(e instanceof Ys){var r=e.on().fields;r.J()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),To.Jt(i)},Ys.prototype.Cn=function(){var n=0;return this.Ht.pt(function(t,e){n+=t.length+e.Cn()}),n},Ys.prototype.toString=function(){return this.Ht.toString()},Ys.prototype.child=function(t){return this.Ht.get(t)||void 0},Ys.prototype.jn=function(t,e){return new Ys(this.Ht.lt(t,e))},Ys.EMPTY=new Ys(new zi(Hr)),Ys),Cs=(t(zs,ps=ts),zs.prototype.value=function(e){return this.Ht.map(function(t){return t.value(e)})},zs.prototype.contains=function(t){for(var e=0,n=this.Ht;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},zs.prototype.forEach=function(t){this.Ht.forEach(t)},zs.prototype.isEqual=function(t){if(t instanceof zs){if(this.Ht.length!==t.Ht.length)return!1;for(var e=0;e<this.Ht.length;e++)if(!this.Ht[e].isEqual(t.Ht[e]))return!1;return!0}return!1},zs.prototype.h=function(t){if(t instanceof zs){for(var e=Math.min(this.Ht.length,t.Ht.length),n=0;n<e;n++){var r=this.Ht[n].h(t.Ht[n]);if(r)return r}return Hr(this.Ht.length,t.Ht.length)}return this.Pn(t)},zs.prototype.Cn=function(){return this.Ht.reduce(function(t,e){return t+e.Cn()},0)},zs.prototype.toString=function(){return"["+this.Ht.map(function(t){return t.toString()}).join(",")+"]"},zs),xs=(Hs.Un=function(t,e){return Hi.G(t.key,e.key)},Hs),Ls=(t(Bs,ls=xs),Bs.prototype.field=function(t){if(this.Ln)return this.Ln.field(t);this.Bn||(this.Bn=new Map);var e=t.nt(),n=this.Bn.get(e);if(void 0===n){var r=this.Mn(t);n=void 0===r?null:this.converter(r),this.Bn.set(e,n)}return n},Bs.prototype.data=function(){var n=this;if(!this.Ln){var r=Os.EMPTY;yi(this.proto.fields||{},function(t,e){r=r.set(new Bi([t]),n.converter(e))}),this.Ln=r,this.Bn=void 0}return this.Ln},Bs.prototype.value=function(){return this.data().value()},Bs.prototype.isEqual=function(t){return t instanceof Bs&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.un===t.un&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Bs.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.un+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Bs.prototype,"hasPendingWrites",{get:function(){return this.un||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Bs.prototype.Mn=function(t){Fr(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.Y()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Bs.qn=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.h(i):Gr("Trying to compare documents on fields that don't exist")},Bs),Ps=(t(js,fs=xs),js.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(js.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),js.prototype.isEqual=function(t){return t instanceof js&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},js),Us=(t(Fs,cs=xs),Fs.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Fs.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Fs.prototype.isEqual=function(t){return t instanceof Fs&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Fs),Ms=Number,qs=Ms.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Vs=Ms.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Gs=Ms.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Fs(){return null!==cs&&cs.apply(this,arguments)||this}function js(t,e,n){var r=fs.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Bs(t,e,n,r,i,o){var s=ls.call(this,t,e)||this;return s.Ln=r,s.proto=i,s.converter=o,Fr(void 0!==s.Ln||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.un=!!n.un,s.hasCommittedMutations=!!n.hasCommittedMutations,s}function Hs(t,e){this.key=t,this.version=e}function zs(t){var e=ps.call(this)||this;return e.Ht=t,e.Sn=ko.ArrayValue,e}function Ys(t){var e=ds.call(this)||this;return e.Ht=t,e.Sn=ko.In,e}function Ws(t){var e=ys.call(this)||this;return e.Ht=t,e.Sn=ko._n,e}function Ks(t,e){var n=vs.call(this)||this;return n.s=t,n.key=e,n.Sn=ko.yn,n}function Qs(t){var e=ms.call(this)||this;return e.Ht=t,e.Sn=ko.bn,e}function Js(t,e){var n=gs.call(this)||this;return n.Fn=t,n.previousValue=e,n.Sn=ko.pn,n}function Xs(t){var e=ws.call(this)||this;return e.Ht=t,e.Sn=ko.pn,e}function $s(t){var e=bs.call(this)||this;return e.Ht=t,e.Sn=ko.gn,e}function Zs(){return null!==Es&&Es.apply(this,arguments)||this}function ta(){return null!==Is&&Is.apply(this,arguments)||this}function ea(t){return null==t}function na(t){return Gs(t)&&t<=Vs&&qs<=t}var ra,ia,oa=(sa.prototype.canonicalId=function(){if(null===this.Qn){var t=this.path.nt();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";ea(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Qn=t}return this.Qn},sa.prototype.toString=function(){var t=this.path.nt();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ea(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},sa.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},sa.prototype.Gn=function(){return Hi.ht(this.path)&&null===this.collectionGroup&&0===this.filters.length},sa);function sa(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Qn=null}(ia=ra=ra||{}).Wn="F",ia.zn="L";var aa,ua,ha,ca,fa,la,pa,da,ya,va,ma=(Ga.$n=function(t){return new Ga(t)},Object.defineProperty(Ga.prototype,"orderBy",{get:function(){if(null===this.Jn){var t=this.Zn(),e=this.ti();if(null!==t&&null===e)t.ut()?this.Jn=[Da]:this.Jn=[new ka(t),Da];else{Fr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.Jn=[]),r=0,i=this.Kn;r<i.length;r++){var o=i[r];this.Jn.push(o),o.field.ut()&&(n=!0)}if(!n){var s=0<this.Kn.length?this.Kn[this.Kn.length-1].dir:Aa.ASCENDING;this.Jn.push(s===Aa.ASCENDING?Da:Ra)}}}return this.Jn},enumerable:!0,configurable:!0}),Ga.prototype.ni=function(t){Fr(null==this.Zn()||!(t instanceof wa)||!t.ii()||t.field.isEqual(this.Zn()),"Query must only have one inequality field."),Fr(!this.Gn(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new Ga(this.path,this.collectionGroup,this.Kn.slice(),e,this.limit,this.Hn,this.startAt,this.endAt)},Ga.prototype.ei=function(t){Fr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.Kn.concat([t]);return new Ga(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Hn,this.startAt,this.endAt)},Ga.prototype.ri=function(t){return new Ga(this.path,this.collectionGroup,this.Kn.slice(),this.filters.slice(),t,ra.Wn,this.startAt,this.endAt)},Ga.prototype.ui=function(t){return new Ga(this.path,this.collectionGroup,this.Kn.slice(),this.filters.slice(),t,ra.zn,this.startAt,this.endAt)},Ga.prototype.si=function(t){return new Ga(this.path,this.collectionGroup,this.Kn.slice(),this.filters.slice(),this.limit,this.Hn,t,this.endAt)},Ga.prototype.oi=function(t){return new Ga(this.path,this.collectionGroup,this.Kn.slice(),this.filters.slice(),this.limit,this.Hn,this.startAt,t)},Ga.prototype.hi=function(t){return new Ga(t,null,this.Kn.slice(),this.filters.slice(),this.limit,this.Hn,this.startAt,this.endAt)},Ga.prototype.ci=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Kn.length||1===this.Kn.length&&this.Kn[0].field.ut())},Ga.prototype.canonicalId=function(){return this.ai().canonicalId()+"|lt:"+this.Hn},Ga.prototype.toString=function(){return"Query(target="+this.ai().toString()+"; limitType="+this.Hn+")"},Ga.prototype.isEqual=function(t){return this.ai().isEqual(t.ai())&&this.Hn===t.Hn},Ga.prototype.fi=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.ut()}return Fr(n,"orderBy used that doesn't compare on key field"),0},Ga.prototype.matches=function(t){return this.li(t)&&this.di(t)&&this.vi(t)&&this.wi(t)},Ga.prototype.mi=function(){return!ea(this.limit)&&this.Hn===ra.Wn},Ga.prototype.pi=function(){return!ea(this.limit)&&this.Hn===ra.zn},Ga.prototype.ti=function(){return 0<this.Kn.length?this.Kn[0].field:null},Ga.prototype.Zn=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof wa&&n.ii())return n.field}return null},Ga.prototype.gi=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof wa&&0<=t.indexOf(r.op))return r.op}return null},Ga.prototype.Gn=function(){return this.ai().Gn()},Ga.prototype.bi=function(){return null!==this.collectionGroup},Ga.prototype.ai=function(){if(!this.Yn)if(this.Hn===ra.Wn)this.Yn=new oa(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===Aa.DESCENDING?Aa.ASCENDING:Aa.DESCENDING;t.push(new ka(r.field,i))}var o=this.endAt?new Sa(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Sa(this.startAt.position,!this.startAt.before):null;this.Yn=new oa(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Yn},Ga.prototype.li=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.ct(this.collectionGroup)&&this.path.$(e):Hi.ht(this.path)?this.path.isEqual(e):this.path.Z(e)},Ga.prototype.di=function(t){for(var e=0,n=this.Kn;e<n.length;e++){var r=n[e];if(!r.field.ut()&&null===t.field(r.field))return!1}return!0},Ga.prototype.vi=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Ga.prototype.wi=function(t){return!(this.startAt&&!this.startAt.yi(this.orderBy,t)||this.endAt&&this.endAt.yi(this.orderBy,t))},Ga.prototype.Xn=function(t){Fr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},Ga),ga=(Va.it=function(t){switch(t){case"<":return Va.LESS_THAN;case"<=":return Va.LESS_THAN_OR_EQUAL;case"==":return Va.EQUAL;case">=":return Va.GREATER_THAN_OR_EQUAL;case">":return Va.GREATER_THAN;case"array-contains":return Va.ARRAY_CONTAINS;case"in":return Va.IN;case"array-contains-any":return Va.ARRAY_CONTAINS_ANY;default:return Gr("Unknown FieldFilter operator: "+t)}},Va.prototype.toString=function(){return this.name},Va.prototype.isEqual=function(t){return this.name===t.name},Va.LESS_THAN=new Va("<"),Va.LESS_THAN_OR_EQUAL=new Va("<="),Va.EQUAL=new Va("=="),Va.GREATER_THAN=new Va(">"),Va.GREATER_THAN_OR_EQUAL=new Va(">="),Va.ARRAY_CONTAINS=new Va("array-contains"),Va.IN=new Va("in"),Va.ARRAY_CONTAINS_ANY=new Va("array-contains-any"),Va),wa=(t(qa,va=function(){}),qa.create=function(t,e,n){if(t.ut())return e===ga.IN?(Fr(n instanceof Cs,"Comparing on key with IN, but filter value not an ArrayValue"),Fr(n.Ht.every(function(t){return t instanceof Rs}),"Comparing on key with IN, but an array value was not a RefValue"),new Ea(t,n)):(Fr(n instanceof Rs,"Comparing on key, but filter value not a RefValue"),Fr(e!==ga.ARRAY_CONTAINS&&e!==ga.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new ba(t,e,n));if(n.isEqual(es.Vn)){if(e!==ga.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new qa(t,e,n)}if(n.isEqual(Ns.On)){if(e!==ga.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new qa(t,e,n)}return e===ga.ARRAY_CONTAINS?new Ia(t,n):e===ga.IN?(Fr(n instanceof Cs,"IN filter has invalid value: "+n.toString()),new Ta(t,n)):e===ga.ARRAY_CONTAINS_ANY?(Fr(n instanceof Cs,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new Na(t,n)):new qa(t,e,n)},qa.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.Sn===e.Sn&&this._i(e.h(this.value))},qa.prototype._i=function(t){switch(this.op){case ga.LESS_THAN:return t<0;case ga.LESS_THAN_OR_EQUAL:return t<=0;case ga.EQUAL:return 0===t;case ga.GREATER_THAN:return 0<t;case ga.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Gr("Unknown FieldFilter operator: "+this.op)}},qa.prototype.ii=function(){return 0<=[ga.LESS_THAN,ga.LESS_THAN_OR_EQUAL,ga.GREATER_THAN,ga.GREATER_THAN_OR_EQUAL].indexOf(this.op)},qa.prototype.canonicalId=function(){return this.field.nt()+this.op.toString()+this.value.toString()},qa.prototype.isEqual=function(t){return t instanceof qa&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},qa.prototype.toString=function(){return this.field.nt()+" "+this.op+" "+this.value.value()},qa),ba=(t(Ma,ya=wa),Ma.prototype.matches=function(t){var e=this.value,n=Hi.G(t.key,e.key);return this._i(n)},Ma),Ea=(t(Ua,da=wa),Ua.prototype.matches=function(e){return this.value.Ht.some(function(t){return e.key.isEqual(t.key)})},Ua),Ia=(t(Pa,pa=wa),Pa.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Cs&&e.contains(this.value)},Pa),Ta=(t(La,la=wa),La.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},La),Na=(t(xa,fa=wa),xa.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Cs&&n.Ht.some(function(t){return e.value.contains(t)})},xa),Aa=(Ca.prototype.toString=function(){return this.name},Ca.ASCENDING=new Ca("asc"),Ca.DESCENDING=new Ca("desc"),Ca),Sa=(Oa.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},Oa.prototype.yi=function(t,e){Fr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.ut())Fr(o instanceof Rs,"Bound has a non-key value where the key path is being used."),n=Hi.G(o.key,e.key);else{var s=e.field(i.field);Fr(null!==s,"Field should exist since document matched the orderBy already."),n=o.h(s)}if(i.dir===Aa.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Oa.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},Oa),ka=(_a.prototype.compare=function(t,e){var n=this.Ii?Ls.Un(t,e):Ls.qn(this.field,t,e);switch(this.dir){case Aa.ASCENDING:return n;case Aa.DESCENDING:return-1*n;default:return Gr("Unknown direction: "+this.dir)}},_a.prototype.canonicalId=function(){return this.field.nt()+this.dir.toString()},_a.prototype.toString=function(){return this.field.nt()+" ("+this.dir+")"},_a.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},_a),Da=new ka(Bi.st(),Aa.ASCENDING),Ra=new ka(Bi.st(),Aa.DESCENDING);function _a(t,e){this.field=t,void 0===e&&(e=Aa.ASCENDING),this.dir=e,this.Ii=t.ut()}function Oa(t,e){this.position=t,this.before=e}function Ca(t){this.name=t}function xa(t,e){var n=fa.call(this,t,ga.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}function La(t,e){var n=la.call(this,t,ga.IN,e)||this;return n.value=e,n}function Pa(t,e){return pa.call(this,t,ga.ARRAY_CONTAINS,e)||this}function Ua(t,e){var n=da.call(this,t,ga.IN,e)||this;return n.value=e,n}function Ma(){return null!==ya&&ya.apply(this,arguments)||this}function qa(t,e,n){var r=va.call(this)||this;return r.field=t,r.op=e,r.value=n,r}function Va(t){this.name=t}function Ga(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=ra.Wn),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.Kn=n,this.filters=r,this.limit=i,this.Hn=o,this.startAt=s,this.endAt=a,this.Jn=null,this.Yn=null,this.startAt&&this.Xn(this.startAt),this.endAt&&this.Xn(this.endAt)}(ua=aa=aa||{})[ua.Ti=0]="__PRIVATE_Unknown",ua[ua.Ei=1]="__PRIVATE_Online",ua[ua.Ri=2]="__PRIVATE_Offline",(ca=ha=ha||{})[ca.Ai=0]="__PRIVATE_RemoteStore",ca[ca.Di=1]="__PRIVATE_SharedClientState";var Fa,ja,Ba=(Ha.fromBase64String=function(t){return new Ha(zu.t().atob(t))},Ha.fromUint8Array=function(t){return new Ha(za(t))},Ha.prototype.toBase64=function(){return zu.t().btoa(this.Pi)},Ha.prototype.toUint8Array=function(){return Ya(this.Pi)},Ha.prototype.Cn=function(){return 2*this.Pi.length},Ha.prototype.isEqual=function(t){return this.Pi===t.Pi},Ha.Si=new Ha(""),Ha);function Ha(t){this.Pi=t}function za(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}function Ya(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(ja=Fa=Fa||{})[ja.Ci=0]="__PRIVATE_Listen",ja[ja.Vi=1]="__PRIVATE_ExistenceFilterMismatch",ja[ja.Ni=2]="__PRIVATE_LimboResolution";var Wa,Ka,Qa=($a.prototype.Fi=function(t){return new $a(this.target,this.targetId,this.ki,t,this.Oi,this.lastLimboFreeSnapshotVersion,this.resumeToken)},$a.prototype.xi=function(t,e){return new $a(this.target,this.targetId,this.ki,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},$a.prototype.ji=function(t){return new $a(this.target,this.targetId,this.ki,this.sequenceNumber,this.Oi,t,this.resumeToken)},$a.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.ki===t.ki&&this.sequenceNumber===t.sequenceNumber&&this.Oi.isEqual(t.Oi)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken.isEqual(t.resumeToken)&&this.target.isEqual(t.target)},$a),Ja=(Xa.prototype.isEqual=function(t){return t&&t.count===this.count},Xa);function Xa(t){this.count=t}function $a(t,e,n,r,i,o,s){void 0===i&&(i=Vi.MIN),void 0===o&&(o=Vi.MIN),void 0===s&&(s=Ba.Si),this.target=t,this.targetId=e,this.ki=n,this.sequenceNumber=r,this.Oi=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Za(t){switch(t){case Zr.OK:return Gr("Treated status OK as error");case Zr.CANCELLED:case Zr.UNKNOWN:case Zr.DEADLINE_EXCEEDED:case Zr.RESOURCE_EXHAUSTED:case Zr.INTERNAL:case Zr.UNAVAILABLE:case Zr.UNAUTHENTICATED:return!1;case Zr.INVALID_ARGUMENT:case Zr.NOT_FOUND:case Zr.ALREADY_EXISTS:case Zr.PERMISSION_DENIED:case Zr.FAILED_PRECONDITION:case Zr.ABORTED:case Zr.OUT_OF_RANGE:case Zr.UNIMPLEMENTED:case Zr.DATA_LOSS:return!0;default:return Gr("Unknown status code: "+t)}}function tu(t){if(void 0===t)return qr("GRPC error has no .code"),Zr.UNKNOWN;switch(t){case Wa.OK:return Zr.OK;case Wa.CANCELLED:return Zr.CANCELLED;case Wa.UNKNOWN:return Zr.UNKNOWN;case Wa.DEADLINE_EXCEEDED:return Zr.DEADLINE_EXCEEDED;case Wa.RESOURCE_EXHAUSTED:return Zr.RESOURCE_EXHAUSTED;case Wa.INTERNAL:return Zr.INTERNAL;case Wa.UNAVAILABLE:return Zr.UNAVAILABLE;case Wa.UNAUTHENTICATED:return Zr.UNAUTHENTICATED;case Wa.INVALID_ARGUMENT:return Zr.INVALID_ARGUMENT;case Wa.NOT_FOUND:return Zr.NOT_FOUND;case Wa.ALREADY_EXISTS:return Zr.ALREADY_EXISTS;case Wa.PERMISSION_DENIED:return Zr.PERMISSION_DENIED;case Wa.FAILED_PRECONDITION:return Zr.FAILED_PRECONDITION;case Wa.ABORTED:return Zr.ABORTED;case Wa.OUT_OF_RANGE:return Zr.OUT_OF_RANGE;case Wa.UNIMPLEMENTED:return Zr.UNIMPLEMENTED;case Wa.DATA_LOSS:return Zr.DATA_LOSS;default:return Gr("Unknown status code: "+t)}}(Ka=Wa=Wa||{})[Ka.OK=0]="OK",Ka[Ka.CANCELLED=1]="CANCELLED",Ka[Ka.UNKNOWN=2]="UNKNOWN",Ka[Ka.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ka[Ka.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ka[Ka.NOT_FOUND=5]="NOT_FOUND",Ka[Ka.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ka[Ka.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ka[Ka.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ka[Ka.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ka[Ka.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ka[Ka.ABORTED=10]="ABORTED",Ka[Ka.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ka[Ka.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ka[Ka.INTERNAL=13]="INTERNAL",Ka[Ka.UNAVAILABLE=14]="UNAVAILABLE",Ka[Ka.DATA_LOSS=15]="DATA_LOSS";var eu=new zi(Hi.G);function nu(){return eu}function ru(){return nu()}var iu=new zi(Hi.G);function ou(){return iu}var su=new zi(Hi.G);function au(){return su}var uu=new so(Hi.G);function hu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=uu,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var cu=new so(Hr);function fu(){return cu}var lu,pu,du,yu,vu=(mu.Bi=function(t){return new mu(t.G)},mu.prototype.has=function(t){return null!=this.Ui.get(t)},mu.prototype.get=function(t){return this.Ui.get(t)},mu.prototype.first=function(){return this.Li.vt()},mu.prototype.last=function(){return this.Li.wt()},mu.prototype.J=function(){return this.Li.J()},mu.prototype.indexOf=function(t){var e=this.Ui.get(t);return e?this.Li.indexOf(e):-1},Object.defineProperty(mu.prototype,"size",{get:function(){return this.Li.size},enumerable:!0,configurable:!0}),mu.prototype.forEach=function(n){this.Li.pt(function(t,e){return n(t),!1})},mu.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ui.lt(t.key,t),e.Li.lt(t,null))},mu.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ui.remove(t),this.Li.remove(e)):this},mu.prototype.isEqual=function(t){if(!(t instanceof mu))return!1;if(this.size!==t.size)return!1;for(var e=this.Li.bt(),n=t.Li.bt();e.At();){var r=e.Rt().key,i=n.Rt().key;if(!r.isEqual(i))return!1}return!0},mu.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},mu.prototype.copy=function(t,e){var n=new mu;return n.G=this.G,n.Ui=t,n.Li=e,n},mu);function mu(n){this.G=n?function(t,e){return n(t,e)||Hi.G(t.key,e.key)}:function(t,e){return Hi.G(t.key,e.key)},this.Ui=ou(),this.Li=new zi(this.G)}(pu=lu=lu||{})[pu.Mi=0]="__PRIVATE_Added",pu[pu.qi=1]="__PRIVATE_Removed",pu[pu.Qi=2]="__PRIVATE_Modified",pu[pu.Gi=3]="__PRIVATE_Metadata",(yu=du=du||{})[yu.Wi=0]="__PRIVATE_Local",yu[yu.zi=1]="__PRIVATE_Synced";function gu(t,e,n,r){this.ae=t,this.removedTargetIds=e,this.key=n,this.fe=r}function wu(t,e){this.targetId=t,this.le=e}var bu,Eu,Iu=(Ru.prototype.track=function(t){var e=t.doc.key,n=this.Ki.get(e);n?t.type!==lu.Mi&&n.type===lu.Gi?this.Ki=this.Ki.lt(e,t):t.type===lu.Gi&&n.type!==lu.qi?this.Ki=this.Ki.lt(e,{type:n.type,doc:t.doc}):t.type===lu.Qi&&n.type===lu.Qi?this.Ki=this.Ki.lt(e,{type:lu.Qi,doc:t.doc}):t.type===lu.Qi&&n.type===lu.Mi?this.Ki=this.Ki.lt(e,{type:lu.Mi,doc:t.doc}):t.type===lu.qi&&n.type===lu.Mi?this.Ki=this.Ki.remove(e):t.type===lu.qi&&n.type===lu.Qi?this.Ki=this.Ki.lt(e,{type:lu.qi,doc:n.doc}):t.type===lu.Mi&&n.type===lu.qi?this.Ki=this.Ki.lt(e,{type:lu.Qi,doc:t.doc}):Gr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.Ki=this.Ki.lt(e,t)},Ru.prototype.Hi=function(){var n=[];return this.Ki.pt(function(t,e){n.push(e)}),n},Ru),Tu=(Du.Zi=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:lu.Mi,doc:t})}),new Du(t,e,vu.Bi(e),i,n,r,!0,!1)},Object.defineProperty(Du.prototype,"hasPendingWrites",{get:function(){return!this.Yi.J()},enumerable:!0,configurable:!0}),Du.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Xi===t.Xi&&this.Yi.isEqual(t.Yi)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.Ji.isEqual(t.Ji)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Du),Nu=(ku.re=function(t,e){var n,r=((n={})[t]=Au.ue(t,e),n);return new ku(Vi.MIN,r,fu(),nu(),hu())},ku),Au=(Su.ue=function(t,e){return new Su(Ba.Si,e,hu(),hu(),hu())},Su);function Su(t,e,n,r,i){this.resumeToken=t,this.se=e,this.oe=n,this.he=r,this.ce=i}function ku(t,e,n,r,i){this.Oi=t,this.te=e,this.ne=n,this.ie=r,this.ee=i}function Du(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.Ji=n,this.docChanges=r,this.Yi=i,this.fromCache=o,this.Xi=s,this.$i=a}function Ru(){this.Ki=new zi(Hi.G)}(Eu=bu=bu||{})[Eu.de=0]="__PRIVATE_NoChange",Eu[Eu.Mi=1]="__PRIVATE_Added",Eu[Eu.qi=2]="__PRIVATE_Removed",Eu[Eu.ve=3]="__PRIVATE_Current",Eu[Eu.we=4]="__PRIVATE_Reset";function _u(t,e,n,r){void 0===n&&(n=Ba.Si),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Ou=(Object.defineProperty(Lu.prototype,"se",{get:function(){return this.be},enumerable:!0,configurable:!0}),Object.defineProperty(Lu.prototype,"resumeToken",{get:function(){return this.ge},enumerable:!0,configurable:!0}),Object.defineProperty(Lu.prototype,"_e",{get:function(){return 0!==this.me},enumerable:!0,configurable:!0}),Object.defineProperty(Lu.prototype,"Ie",{get:function(){return this.ye},enumerable:!0,configurable:!0}),Lu.prototype.Te=function(t){0<t.Cn()&&(this.ye=!0,this.ge=t)},Lu.prototype.Ee=function(){var n=hu(),r=hu(),i=hu();return this.pe.forEach(function(t,e){switch(e){case lu.Mi:n=n.add(t);break;case lu.Qi:r=r.add(t);break;case lu.qi:i=i.add(t);break;default:Gr("Encountered invalid change type: "+e)}}),new Au(this.ge,this.be,n,r,i)},Lu.prototype.Re=function(){this.ye=!1,this.pe=Uu()},Lu.prototype.Ae=function(t,e){this.ye=!0,this.pe=this.pe.lt(t,e)},Lu.prototype.De=function(t){this.ye=!0,this.pe=this.pe.remove(t)},Lu.prototype.Pe=function(){this.me+=1},Lu.prototype.Se=function(){this.me-=1},Lu.prototype.Ce=function(){this.ye=!0,this.be=!0},Lu),Cu=(xu.prototype.xe=function(t){for(var e=0,n=t.ae;e<n.length;e++){var r=n[e];t.fe instanceof Ls?this.je(r,t.fe):t.fe instanceof Ps&&this.Ue(r,t.key,t.fe)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.Ue(r,t.key,t.fe)},xu.prototype.Le=function(n){var r=this;this.Be(n,function(t){var e=r.Me(t);switch(n.state){case bu.de:r.qe(t)&&e.Te(n.resumeToken);break;case bu.Mi:e.Se(),e._e||e.Re(),e.Te(n.resumeToken);break;case bu.qi:e.Se(),e._e||r.removeTarget(t),Fr(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case bu.ve:r.qe(t)&&(e.Ce(),e.Te(n.resumeToken));break;case bu.we:r.qe(t)&&(r.Qe(t),e.Te(n.resumeToken));break;default:Gr("Unknown target watch change state: "+n.state)}})},xu.prototype.Be=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):di(this.Ne,e)},xu.prototype.Ge=function(t){var e=t.targetId,n=t.le.count,r=this.We(e);if(r){var i=r.target;if(i.Gn())if(0===n){var o=new Hi(i.path);this.Ue(e,o,new Ps(o,Vi.B()))}else Fr(1===n,"Single document existence filter with count: "+n);else this.ze(e)!==n&&(this.Qe(e),this.Fe=this.Fe.add(e))}},xu.prototype.Ke=function(i){var o=this,s={};di(this.Ne,function(t,e){var n=o.We(t);if(n){if(e.se&&n.target.Gn()){var r=new Hi(n.target.path);null!==o.ke.get(r)||o.He(t,r)||o.Ue(t,r,new Ps(r,i))}e.Ie&&(s[t]=e.Ee(),e.Re())}});var r=hu();this.Oe.forEach(function(t,e){var n=!0;e.Bt(function(t){var e=o.We(t);return!e||e.ki===Fa.Ni||(n=!1)}),n&&(r=r.add(t))});var t=new Nu(i,s,this.Fe,this.ke,r);return this.ke=nu(),this.Oe=Pu(),this.Fe=new so(Hr),t},xu.prototype.je=function(t,e){if(this.qe(t)){var n=this.He(t,e.key)?lu.Qi:lu.Mi;this.Me(t).Ae(e.key,n),this.ke=this.ke.lt(e.key,e),this.Oe=this.Oe.lt(e.key,this.Je(e.key).add(t))}},xu.prototype.Ue=function(t,e,n){if(this.qe(t)){var r=this.Me(t);this.He(t,e)?r.Ae(e,lu.qi):r.De(e),this.Oe=this.Oe.lt(e,this.Je(e).delete(t)),n&&(this.ke=this.ke.lt(e,n))}},xu.prototype.removeTarget=function(t){delete this.Ne[t]},xu.prototype.ze=function(t){var e=this.Me(t).Ee();return this.Ve.Ye(t).size+e.oe.size-e.ce.size},xu.prototype.Pe=function(t){this.Me(t).Pe()},xu.prototype.Me=function(t){return this.Ne[t]||(this.Ne[t]=new Ou),this.Ne[t]},xu.prototype.Je=function(t){var e=this.Oe.get(t);return e||(e=new so(Hr),this.Oe=this.Oe.lt(t,e)),e},xu.prototype.qe=function(t){var e=null!==this.We(t);return e||Mr("WatchChangeAggregator","Detected inactive target",t),e},xu.prototype.We=function(t){var e=this.Ne[t];return e&&e._e?null:this.Ve.Xe(t)},xu.prototype.Qe=function(e){var n=this;Fr(!this.Ne[e]._e,"Should only reset active targets"),this.Ne[e]=new Ou,this.Ve.Ye(e).forEach(function(t){n.Ue(e,t,null)})},xu.prototype.He=function(t,e){return this.Ve.Ye(t).has(e)},xu);function xu(t){this.Ve=t,this.Ne={},this.ke=nu(),this.Oe=Pu(),this.Fe=new so(Hr)}function Lu(){this.me=0,this.pe=Uu(),this.ge=Ba.Si,this.be=!1,this.ye=!0}function Pu(){return new zi(Hi.G)}function Uu(){return new zi(Hi.G)}var Mu,qu,Vu=((Mu={})[Aa.ASCENDING.name]="ASCENDING",Mu[Aa.DESCENDING.name]="DESCENDING",Mu),Gu=((qu={})[ga.LESS_THAN.name]="LESS_THAN",qu[ga.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",qu[ga.GREATER_THAN.name]="GREATER_THAN",qu[ga.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",qu[ga.EQUAL.name]="EQUAL",qu[ga.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",qu[ga.IN.name]="IN",qu[ga.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",qu),Fu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ju(t,e){Fr(!ea(t),e+" is missing")}function Bu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Gr("can't parse "+t)}var Hu=(Wu.prototype.$e=function(t){var e=void 0===t.code?Zr.UNKNOWN:tu(t.code);return new ti(e,t.message||"")},Wu.prototype.Ze=function(t){return this.options.tr||ea(t)?t:{value:t}},Wu.prototype.nr=function(t){var e;return ea(e="object"==typeof t?t.value:t)?null:e},Wu.prototype.q=function(t){return this.options.tr?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Wu.prototype.L=function(t){if("string"==typeof t)return this.ir(t);Fr(!!t,"Cannot deserialize null or undefined timestamp.");var e=Bu(t.seconds||"0"),n=t.nanos||0;return new qi(e,n)},Wu.prototype.ir=function(t){var e=0,n=Fu.exec(t);if(Fr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new qi(o,e)},Wu.prototype.er=function(t){return this.options.tr?t.toBase64():t.toUint8Array()},Wu.prototype.rr=function(t){return this.options.tr?(Fr(void 0===t||"string"==typeof t,"value must be undefined or a string when using proto3 Json"),Ba.fromBase64String(t||"")):(Fr(void 0===t||t instanceof Uint8Array,"value must be undefined or Uint8Array"),Ba.fromUint8Array(t||new Uint8Array))},Wu.prototype.ur=function(t){return"string"==typeof t?(Fr(this.options.tr,"Expected bytes to be passed in as Uint8Array, but got a string instead."),th.fromBase64String(t)):(Fr(!this.options.tr,"Expected bytes to be passed in as Uint8Array, but got a string instead."),th.fromUint8Array(t))},Wu.prototype.toVersion=function(t){return this.q(t.q())},Wu.prototype.fromVersion=function(t){return Fr(!!t,"Trying to deserialize version that isn't set"),Vi.L(this.L(t))},Wu.prototype.sr=function(t,e){return this.or(t).child("documents").child(e).nt()},Wu.prototype.hr=function(t){var e=Fi.it(t);return Fr(this.cr(e),"Tried to deserialize invalid key "+e.toString()),e},Wu.prototype.ar=function(t){return this.sr(this.s,t.path)},Wu.prototype.lr=function(t){var e=this.hr(t);return Fr(e.get(1)===this.s.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.s.projectId),Fr(!e.get(3)&&!this.s.database||e.get(3)===this.s.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.s.database),new Hi(this.dr(e))},Wu.prototype.vr=function(t){return this.sr(this.s,t)},Wu.prototype.wr=function(t){var e=this.hr(t);return 4===e.length?Fi.et:this.dr(e)},Object.defineProperty(Wu.prototype,"mr",{get:function(){return new Fi(["projects",this.s.projectId,"databases",this.s.database]).nt()},enumerable:!0,configurable:!0}),Wu.prototype.or=function(t){return new Fi(["projects",t.projectId,"databases",t.database])},Wu.prototype.dr=function(t){return Fr(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.K(5)},Wu.prototype.cr=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},Wu.prototype.pr=function(t){if(t instanceof es)return{nullValue:"NULL_VALUE"};if(t instanceof ns)return{booleanValue:t.value()};if(t instanceof Ts)return{integerValue:""+t.value()};if(t instanceof Ns){var e=t.value();if(this.options.tr){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof As?{stringValue:t.value()}:t instanceof Os?{mapValue:this.gr(t)}:t instanceof Cs?{arrayValue:this.br(t)}:t instanceof Ss?{timestampValue:this.q(t.Ht)}:t instanceof _s?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Ds?{bytesValue:this.er(t.value())}:t instanceof Rs?{referenceValue:this.sr(t.s,t.key.path)}:Gr("Unknown FieldValue "+JSON.stringify(t))},Wu.prototype.yr=function(t){var e=this;if("nullValue"in t)return es.Vn;if("booleanValue"in t)return ns.of(t.booleanValue);if("integerValue"in t)return new Ts(Bu(t.integerValue));if("doubleValue"in t){if(this.options.tr){if("NaN"===t.doubleValue)return Ns.On;if("Infinity"===t.doubleValue)return Ns.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Ns.NEGATIVE_INFINITY}return new Ns(t.doubleValue)}if("stringValue"in t)return new As(t.stringValue);if("mapValue"in t)return this._r(t.mapValue.fields||{});if("arrayValue"in t){ju(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Cs(n.map(function(t){return e.yr(t)}))}if("timestampValue"in t)return ju(t.timestampValue,"timestampValue"),new Ss(this.L(t.timestampValue));if("geoPointValue"in t){ju(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new _s(new Mi(r,i))}if("bytesValue"in t){ju(t.bytesValue,"bytesValue");var o=this.ur(t.bytesValue);return new Ds(o)}if("referenceValue"in t){ju(t.referenceValue,"referenceValue");var s=this.hr(t.referenceValue),a=new Xr(s.get(1),s.get(3)),u=new Hi(this.dr(s));return new Rs(a,u)}return Gr("Unknown Value proto "+JSON.stringify(t))},Wu.prototype.Ir=function(t,e){return{name:this.ar(t),fields:this.Tr(e)}},Wu.prototype.Er=function(t){return Fr(!t.un,"Can't serialize documents with mutations."),{name:this.ar(t.key),fields:this.Tr(t.data()),updateTime:this.q(t.version.q())}},Wu.prototype.Rr=function(t,e){var n=this,r=this.lr(t.name),i=this.fromVersion(t.updateTime);return new Ls(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.yr(t)})},Wu.prototype.Tr=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.pr(e)}),r},Wu.prototype._r=function(t){var n=this,e=t,r=Os.EMPTY;return yi(e,function(t,e){r=r.set(new Bi([t]),n.yr(e))}),r},Wu.prototype.gr=function(t){return{fields:this.Tr(t)}},Wu.prototype.br=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.pr(t))}),{values:n}},Wu.prototype.Ar=function(t){var e=this;Fr(!!t.found,"Tried to deserialize a found document from a missing document."),ju(t.found.name,"doc.found.name"),ju(t.found.updateTime,"doc.found.updateTime");var n=this.lr(t.found.name),r=this.fromVersion(t.found.updateTime);return new Ls(n,r,{},void 0,t.found,function(t){return e.yr(t)})},Wu.prototype.Dr=function(t){Fr(!!t.missing,"Tried to deserialize a missing document from a found document."),Fr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.lr(t.missing),n=this.fromVersion(t.readTime);return new Ps(e,n)},Wu.prototype.Pr=function(t){return"found"in t?this.Ar(t):"missing"in t?this.Dr(t):Gr("invalid batch get response: "+JSON.stringify(t))},Wu.prototype.Sr=function(t){switch(t){case bu.Mi:return"ADD";case bu.ve:return"CURRENT";case bu.de:return"NO_CHANGE";case bu.qi:return"REMOVE";case bu.we:return"RESET";default:return Gr("Unknown WatchTargetChangeState: "+t)}},Wu.prototype.Cr=function(t){if(t instanceof wu)return{filter:{count:t.le.count,targetId:t.targetId}};if(t instanceof gu){if(t.fe instanceof Ls){var e=t.fe;return{documentChange:{document:{name:this.ar(e.key),fields:this.Tr(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.ae,removedTargetIds:t.removedTargetIds}}}if(t.fe instanceof Ps)return e=t.fe,{documentDelete:{document:this.ar(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.fe)return{documentRemove:{document:this.ar(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof _u){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Wa.OK;switch(t){case Zr.OK:return Wa.OK;case Zr.CANCELLED:return Wa.CANCELLED;case Zr.UNKNOWN:return Wa.UNKNOWN;case Zr.DEADLINE_EXCEEDED:return Wa.DEADLINE_EXCEEDED;case Zr.RESOURCE_EXHAUSTED:return Wa.RESOURCE_EXHAUSTED;case Zr.INTERNAL:return Wa.INTERNAL;case Zr.UNAVAILABLE:return Wa.UNAVAILABLE;case Zr.UNAUTHENTICATED:return Wa.UNAUTHENTICATED;case Zr.INVALID_ARGUMENT:return Wa.INVALID_ARGUMENT;case Zr.NOT_FOUND:return Wa.NOT_FOUND;case Zr.ALREADY_EXISTS:return Wa.ALREADY_EXISTS;case Zr.PERMISSION_DENIED:return Wa.PERMISSION_DENIED;case Zr.FAILED_PRECONDITION:return Wa.FAILED_PRECONDITION;case Zr.ABORTED:return Wa.ABORTED;case Zr.OUT_OF_RANGE:return Wa.OUT_OF_RANGE;case Zr.UNIMPLEMENTED:return Wa.UNIMPLEMENTED;case Zr.DATA_LOSS:return Wa.DATA_LOSS;default:return Gr("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.Sr(t.state),targetIds:t.targetIds,resumeToken:this.er(t.resumeToken),cause:n}}}return Gr("Unrecognized watch change: "+JSON.stringify(t))},Wu.prototype.Vr=function(t){var e,n=this;if("targetChange"in t){ju(t.targetChange,"targetChange");var r=this.Nr(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=this.rr(t.targetChange.resumeToken),s=t.targetChange.cause,a=s&&this.$e(s);e=new _u(r,i,o,a||null)}else if("documentChange"in t){ju(t.documentChange,"documentChange");var u=t.documentChange;ju(u.document,"documentChange.name"),ju(u.document.name,"documentChange.document.name"),ju(u.document.updateTime,"documentChange.document.updateTime");var h=this.lr(u.document.name),c=this.fromVersion(u.document.updateTime),f=new Ls(h,c,{},void 0,u.document,function(t){return n.yr(t)}),l=u.targetIds||[],p=u.removedTargetIds||[];e=new gu(l,p,f.key,f)}else if("documentDelete"in t){ju(t.documentDelete,"documentDelete");var d=t.documentDelete;ju(d.document,"documentDelete.document"),h=this.lr(d.document),c=d.readTime?this.fromVersion(d.readTime):Vi.B(),f=new Ps(h,c),p=d.removedTargetIds||[],e=new gu([],p,f.key,f)}else if("documentRemove"in t){ju(t.documentRemove,"documentRemove");var y=t.documentRemove;ju(y.document,"documentRemove"),h=this.lr(y.document),p=y.removedTargetIds||[],e=new gu([],p,h,null)}else{if(!("filter"in t))return Gr("Unknown change type "+JSON.stringify(t));ju(t.filter,"filter");var v=t.filter;ju(v.targetId,"filter.targetId");var m=v.count||0,g=new Ja(m),w=v.targetId;e=new wu(w,g)}return e},Wu.prototype.Nr=function(t){return"NO_CHANGE"===t?bu.de:"ADD"===t?bu.Mi:"REMOVE"===t?bu.qi:"CURRENT"===t?bu.ve:"RESET"===t?bu.we:Gr("Got unexpected TargetChange.state: "+t)},Wu.prototype.kr=function(t){if(!("targetChange"in t))return Vi.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Vi.MIN:e.readTime?this.fromVersion(e.readTime):Vi.MIN},Wu.prototype.Or=function(t){var e,n=this;if(t instanceof qo)e={update:this.Ir(t.key,t.value)};else if(t instanceof Fo)e={delete:this.ar(t.key)};else if(t instanceof Vo)e={update:this.Ir(t.key,t.data),updateMask:this.Fr(t.on)};else if(t instanceof Go)e={transform:{document:this.ar(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.xr(t)})}};else{if(!(t instanceof jo))return Gr("Unknown mutation type "+t.type);e={verify:this.ar(t.key)}}return t.rn.tn||(e.currentDocument=this.jr(t.rn)),e},Wu.prototype.Ur=function(t){var e=this,n=t.currentDocument?this.Lr(t.currentDocument):Uo.NONE;if(t.update){ju(t.update.name,"name");var r=this.lr(t.update.name),i=this._r(t.update.fields||{});if(t.updateMask){var o=this.Br(t.updateMask);return new Vo(r,i,o,n)}return new qo(r,i,n)}if(t.delete)return r=this.lr(t.delete),new Fo(r,n);if(t.transform){r=this.lr(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.Mr(t)});return Fr(!0===n.exists,'Transforms only support precondition "exists == true"'),new Go(r,s)}return t.verify?(r=this.lr(t.verify),new jo(r,n)):Gr("unknown mutation proto: "+JSON.stringify(t))},Wu.prototype.jr=function(t){return Fr(!t.tn,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Gr("Unknown precondition")},Wu.prototype.Lr=function(t){return void 0!==t.updateTime?Uo.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Uo.exists(t.exists):Uo.NONE},Wu.prototype.qr=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Vi.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.yr(t)})),new bo(r,i)},Wu.prototype.Qr=function(t,e){var n=this;return t&&0<t.length?(Fr(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.qr(t,e)})):[]},Wu.prototype.xr=function(t){var e=this,n=t.transform;if(n instanceof uo)return{fieldPath:t.field.nt(),setToServerValue:"REQUEST_TIME"};if(n instanceof ho)return{fieldPath:t.field.nt(),appendMissingElements:{values:n.elements.map(function(t){return e.pr(t)})}};if(n instanceof co)return{fieldPath:t.field.nt(),removeAllFromArray:{values:n.elements.map(function(t){return e.pr(t)})}};if(n instanceof fo)return{fieldPath:t.field.nt(),increment:this.pr(n.Kt)};throw Gr("Unknown transform: "+t.transform)},Wu.prototype.Mr=function(t){var e=this,n=null;if("setToServerValue"in t)Fr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=uo.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new ho(r.map(function(t){return e.yr(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new co(r.map(function(t){return e.yr(t)}));else if("increment"in t){var i=this.yr(t.increment);Fr(i instanceof rs,"NUMERIC_ADD transform requires a NumberValue"),n=new fo(i)}else Gr("Unknown transform proto: "+JSON.stringify(t));var o=Bi.ot(t.fieldPath);return new No(o,n)},Wu.prototype.Gr=function(t){return{documents:[this.vr(t.path)]}},Wu.prototype.Wr=function(t){var e=t.documents.length;Fr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return ma.$n(this.wr(n)).ai()},Wu.prototype.zr=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Fr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.vr(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Fr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.vr(n.H()),e.structuredQuery.from=[{collectionId:n.X()}]);var r=this.Kr(t.filters);r&&(e.structuredQuery.where=r);var i=this.Hr(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.Ze(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Jr(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Jr(t.endAt)),e},Wu.prototype.Yr=function(t){var e=this.wr(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Fr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.Xr(n.where));var a=[];n.orderBy&&(a=this.$r(n.orderBy));var u=null;n.limit&&(u=this.nr(n.limit));var h=null;n.startAt&&(h=this.Zr(n.startAt));var c=null;return n.endAt&&(c=this.Zr(n.endAt)),new ma(e,i,a,s,u,ra.Wn,h,c).ai()},Wu.prototype.tu=function(t){var e=this.nu(t.ki);return null==e?null:{"goog-listen-tags":e}},Wu.prototype.nu=function(t){switch(t){case Fa.Ci:return null;case Fa.Vi:return"existence-filter-mismatch";case Fa.Ni:return"limbo-document";default:return Gr("Unrecognized query purpose: "+t)}},Wu.prototype.ai=function(t){var e,n=t.target;return(e=n.Gn()?{documents:this.Gr(n)}:{query:this.zr(n)}).targetId=t.targetId,0<t.resumeToken.Cn()&&(e.resumeToken=this.er(t.resumeToken)),e},Wu.prototype.Kr=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof wa?e.iu(t):Gr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Wu.prototype.Xr=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.eu(t)]:void 0!==t.fieldFilter?[this.ru(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.Xr(t)}).reduce(function(t,e){return t.concat(e)}):Gr("Unknown filter: "+JSON.stringify(t)):[]},Wu.prototype.Hr=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.uu(t)})},Wu.prototype.$r=function(t){var e=this;return t.map(function(t){return e.su(t)})},Wu.prototype.Jr=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.pr(t)})}},Wu.prototype.Zr=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.yr(t)});return new Sa(r,n)},Wu.prototype.ou=function(t){return Vu[t.name]},Wu.prototype.hu=function(t){switch(t){case"ASCENDING":return Aa.ASCENDING;case"DESCENDING":return Aa.DESCENDING;default:return}},Wu.prototype.cu=function(t){return Gu[t.name]},Wu.prototype.au=function(t){switch(t){case"EQUAL":return ga.EQUAL;case"GREATER_THAN":return ga.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return ga.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return ga.LESS_THAN;case"LESS_THAN_OR_EQUAL":return ga.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return ga.ARRAY_CONTAINS;case"IN":return ga.IN;case"ARRAY_CONTAINS_ANY":return ga.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Gr("Unspecified operator");default:return Gr("Unknown operator")}},Wu.prototype.fu=function(t){return{fieldPath:t.nt()}},Wu.prototype.lu=function(t){return Bi.ot(t.fieldPath)},Wu.prototype.uu=function(t){return{field:this.fu(t.field),direction:this.ou(t.dir)}},Wu.prototype.su=function(t){return new ka(this.lu(t.field),this.hu(t.direction))},Wu.prototype.ru=function(t){return wa.create(this.lu(t.fieldFilter.field),this.au(t.fieldFilter.op),this.yr(t.fieldFilter.value))},Wu.prototype.iu=function(t){if(t.op===ga.EQUAL){if(t.value.isEqual(Ns.On))return{unaryFilter:{field:this.fu(t.field),op:"IS_NAN"}};if(t.value.isEqual(es.Vn))return{unaryFilter:{field:this.fu(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.fu(t.field),op:this.cu(t.op),value:this.pr(t.value)}}},Wu.prototype.eu=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.lu(t.unaryFilter.field);return wa.create(e,ga.EQUAL,Ns.On);case"IS_NULL":var n=this.lu(t.unaryFilter.field);return wa.create(n,ga.EQUAL,es.Vn);case"OPERATOR_UNSPECIFIED":return Gr("Unspecified filter");default:return Gr("Unknown filter")}},Wu.prototype.Fr=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.nt())}),{fieldPaths:e}},Wu.prototype.Br=function(t){var e=(t.fieldPaths||[]).map(function(t){return Bi.ot(t)});return To.Yt(e)},Wu),zu=(Yu.du=function(t){Yu.platform&&Gr("Platform already defined"),Yu.platform=t},Yu.t=function(){return Yu.platform||Gr("Platform not set"),Yu.platform},Yu);function Yu(){}function Wu(t,e){this.s=t,this.options=e}function Ku(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new ti(Zr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}function Qu(){if("undefined"==typeof Uint8Array)throw new ti(Zr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ju(){if(!zu.t().vu)throw new ti(Zr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function Xu(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var $u,Zu,th=(ih.fromBase64String=function(t){gi("Blob.fromBase64String",arguments,1),Ei("Blob.fromBase64String","string",1,t),Ju();try{return new ih(zu.t().atob(t))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},ih.fromUint8Array=function(t){if(gi("Blob.fromUint8Array",arguments,1),Qu(),!(t instanceof Uint8Array))throw Oi("Blob.fromUint8Array","Uint8Array",1,t);return new ih(za(t))},ih.prototype.toBase64=function(){return gi("Blob.toBase64",arguments,0),Ju(),zu.t().btoa(this.Pi)},ih.prototype.toUint8Array=function(){return gi("Blob.toUint8Array",arguments,0),Qu(),Ya(this.Pi)},ih.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},ih.prototype.isEqual=function(t){return this.Pi===t.Pi},ih.prototype.xn=function(){return 2*this.Pi.length},ih.prototype.j=function(t){return Hr(this.Pi,t.Pi)},ih),eh=Ku(th,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),nh=(rh.prototype.mu=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},rh.prototype.next=function(){var t=++this.previousValue;return this.pu&&this.pu(t),t},rh.bu=-1,rh);function rh(t,e){var n=this;this.previousValue=t,e&&(e.wu=function(t){return n.mu(t)},this.pu=function(t){return e.gu(t)})}function ih(t){Ju(),this.Pi=t}(Zu=$u=$u||{}).yu="all",Zu._u="listen_stream_idle",Zu.Iu="listen_stream_connection_backoff",Zu.Tu="write_stream_idle",Zu.Eu="write_stream_connection_backoff",Zu.Ru="online_state_timeout",Zu.Au="client_metadata_refresh",Zu.Du="lru_garbage_collection",Zu.Pu="retry_transaction";var oh=(lh.Ou=function(t,e,n,r,i){var o=new lh(t,e,Date.now()+n,r,i);return o.start(n),o},lh.prototype.start=function(t){var e=this;this.Fu=setTimeout(function(){return e.xu()},t)},lh.prototype.ju=function(){return this.xu()},lh.prototype.cancel=function(t){null!==this.Fu&&(this.clearTimeout(),this.ku.reject(new ti(Zr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},lh.prototype.xu=function(){var e=this;this.Su.Uu(function(){return null!==e.Fu?(e.clearTimeout(),e.op().then(function(t){return e.ku.resolve(t)})):Promise.resolve()})},lh.prototype.clearTimeout=function(){null!==this.Fu&&(this.Nu(this),clearTimeout(this.Fu),this.Fu=null)},lh),sh=(Object.defineProperty(fh.prototype,"Wu",{get:function(){return this.Bu},enumerable:!0,configurable:!0}),fh.prototype.Uu=function(t){this.enqueue(t)},fh.prototype.zu=function(t){this.Ku(),this.Hu(t)},fh.prototype.Ju=function(t){return this.Ku(),this.Hu(t)},fh.prototype.Yu=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Ku(),this.Bu?[3,2]:(this.Bu=!0,[4,this.Ju(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},fh.prototype.enqueue=function(t){return this.Ku(),this.Bu?new Promise(function(t){}):this.Hu(t)},fh.prototype.Hu=function(t){var n=this,e=this.Lu.then(function(){return n.Qu=!0,t().catch(function(t){n.qu=t,n.Qu=!1;var e=t.stack||t.message||"";throw qr("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.Qu=!1,t})});return this.Lu=e},fh.prototype.Xu=function(t,e,n){var r=this;this.Ku(),Fr(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.Gu.indexOf(t)&&(e=0);var i=oh.Ou(this,t,e,n,function(t){return r.$u(t)});return this.Mu.push(i),i},fh.prototype.Ku=function(){this.qu&&Gr("AsyncQueue is already failed: "+(this.qu.stack||this.qu.message))},fh.prototype.Zu=function(){Fr(this.Qu,"verifyOpInProgress() called when no op in progress on this queue.")},fh.prototype.ts=function(){return this.Ju(function(){return Promise.resolve()})},fh.prototype.ns=function(t){for(var e=0,n=this.Mu;e<n.length;e++)if(n[e].Cu===t)return!0;return!1},fh.prototype.es=function(r){var i=this;return this.ts().then(function(){Fr(r===$u.yu||i.ns(r),"Attempted to drain to missing operation "+r),i.Mu.sort(function(t,e){return t.Vu-e.Vu});for(var t=0,e=i.Mu;t<e.length;t++){var n=e[t];if(n.ju(),r!==$u.yu&&n.Cu===r)break}return i.ts()})},fh.prototype.rs=function(t){this.Gu.push(t)},fh.prototype.$u=function(t){var e=this.Mu.indexOf(t);Fr(0<=e,"Delayed operation not found."),this.Mu.splice(e,1)},fh),ah="",uh="",hh="",ch="";function fh(){this.Lu=Promise.resolve(),this.Bu=!1,this.Mu=[],this.qu=null,this.Qu=!1,this.Gu=[]}function lh(t,e,n,r,i){this.Su=t,this.Cu=e,this.Vu=n,this.op=r,this.Nu=i,this.ku=new Xu,this.then=this.ku.promise.then.bind(this.ku.promise),this.catch=this.ku.promise.catch.bind(this.ku.promise),this.ku.promise.catch(function(t){})}function ph(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=yh(e)),e=dh(t.get(n),e);return yh(e)}function dh(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=ah+hh;break;case ah:n+=ah+ch;break;default:n+=o}}return n}function yh(t){return t+ah+uh}function vh(t){var e=t.length;if(Fr(2<=e,"Invalid path "+t),2===e)return Fr(t.charAt(0)===ah&&t.charAt(1)===uh,"Non-empty path "+t+" had length 2"),Fi.et;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf(ah,o);switch((s<0||n<s)&&Gr('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case uh:var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case hh:i+=t.substring(o,s),i+="\0";break;case ch:i+=t.substring(o,s+1);break;default:Gr('Invalid encoded resource path: "'+t+'"')}o=s+2}return new Fi(r)}var mh=(Fh.prototype.Wt=function(t,e,n){e&&Fr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.us;Fr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.Wt(e,s)}}return e},Fh.prototype.Gt=function(t,e){e&&Fr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(a=r[n]).key.isEqual(t)&&(e=a.Gt(e,e,this.Fn));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.Gt(e,i,this.Fn))}return e},Fh.prototype.ss=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.Gt(t.key,n.get(t.key));e&&(i=i.lt(t.key,e))}),i},Fh.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},hu())},Fh.prototype.isEqual=function(t){return this.batchId===t.batchId&&zr(this.mutations,t.mutations)&&zr(this.baseMutations,t.baseMutations)},Fh),gh=(Gh.from=function(t,e,n,r){Fr(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=au(),o=t.mutations,s=0;s<o.length;s++)i=i.lt(o[s].key,n[s].version);return new Gh(t,e,n,r,i)},Gh),wh=(Vh.prototype.J=function(){return this.cs.J()},Vh.prototype.ls=function(t,e){var n=new bh(t,e);this.cs=this.cs.add(n),this.as=this.as.add(n)},Vh.prototype.ds=function(t,e){var n=this;t.forEach(function(t){return n.ls(t,e)})},Vh.prototype.vs=function(t,e){this.ws(new bh(t,e))},Vh.prototype.ms=function(t,e){var n=this;t.forEach(function(t){return n.vs(t,e)})},Vh.prototype.ps=function(t){var e=this,n=Hi.EMPTY,r=new bh(n,t),i=new bh(n,t+1),o=[];return this.as.Lt([r,i],function(t){e.ws(t),o.push(t.key)}),o},Vh.prototype.gs=function(){var e=this;this.cs.forEach(function(t){return e.ws(t)})},Vh.prototype.ws=function(t){this.cs=this.cs.delete(t),this.as=this.as.delete(t)},Vh.prototype.bs=function(t){var e=Hi.EMPTY,n=new bh(e,t),r=new bh(e,t+1),i=hu();return this.as.Lt([n,r],function(t){i=i.add(t.key)}),i},Vh.prototype.ys=function(t){var e=new bh(t,0),n=this.cs.Mt(e);return null!==n&&t.isEqual(n.key)},Vh),bh=(qh.Un=function(t,e){return Hi.G(t.key,e.key)||Hr(t._s,e._s)},qh.fs=function(t,e){return Hr(t._s,e._s)||Hi.G(t.key,e.key)},qh),Eh=(Mh.prototype.get=function(t){var e=this.Is(t),n=this.Ts[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},Mh.prototype.has=function(t){return void 0!==this.get(t)},Mh.prototype.set=function(t,e){var n=this.Is(t),r=this.Ts[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.Ts[n]=[[t,e]]},Mh.prototype.delete=function(t){var e=this.Is(t),n=this.Ts[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.Ts[e]:n.splice(r,1),!0;return!1},Mh.prototype.forEach=function(a){yi(this.Ts,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];a(o,s)}})},Mh.prototype.J=function(){return vi(this.Ts)},Mh),Ih=(Uh.prototype.catch=function(t){return this.next(void 0,t)},Uh.prototype.next=function(r,i){var o=this;return this.Ds&&Gr("Called next() or catch() twice for PersistencePromise"),this.Ds=!0,this.As?this.error?this.Ps(i,this.error):this.Ss(r,this.result):new Uh(function(e,n){o.Es=function(t){o.Ss(r,t).next(e,n)},o.Rs=function(t){o.Ps(i,t).next(e,n)}})},Uh.prototype.Cs=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Uh.prototype.Vs=function(t){try{var e=t();return e instanceof Uh?e:Uh.resolve(e)}catch(t){return Uh.reject(t)}},Uh.prototype.Ss=function(t,e){return t?this.Vs(function(){return t(e)}):Uh.resolve(e)},Uh.prototype.Ps=function(t,e){return t?this.Vs(function(){return t(e)}):Uh.reject(e)},Uh.resolve=function(n){return new Uh(function(t,e){t(n)})},Uh.reject=function(n){return new Uh(function(t,e){e(n)})},Uh.Ns=function(t){return new Uh(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Uh.ks=function(t){for(var n=Uh.resolve(!1),e=function(e){n=n.next(function(t){return t?Uh.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Uh.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Ns(i)},Uh),Th=(Object.defineProperty(Ph.prototype,"readTime",{get:function(){return Fr(void 0!==this.xs,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.xs},set:function(t){Fr(void 0===this.xs||this.xs.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.xs=t},enumerable:!0,configurable:!0}),Ph.prototype.js=function(t,e){this.Us(),this.readTime=e,this.Os.set(t.key,t)},Ph.prototype.Ls=function(t,e){this.Us(),e&&(this.readTime=e),this.Os.set(t,null)},Ph.prototype.Bs=function(t,e){this.Us();var n=this.Os.get(e);return void 0!==n?Ih.resolve(n):this.Ms(t,e)},Ph.prototype.getEntries=function(t,e){return this.qs(t,e)},Ph.prototype.apply=function(t){return this.Us(),this.Fs=!0,this.Qs(t)},Ph.prototype.Us=function(){Fr(!this.Fs,"Changes have already been applied.")},Ph),Nh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ah=(Lh.prototype.Ws=function(t){this.Gs.push(t)},Lh.prototype.zs=function(){this.Gs.forEach(function(t){return t()})},Lh),Sh=(xh.Hs=function(o,t,s){return Fr(xh.Js(),"IndexedDB not supported in current environment."),Mr("SimpleDb","Opening database:",o),new Ih(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new xh(e))},i.onblocked=function(){r(new ti(Zr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new ti(Zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Mr("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,Uc).next(function(){Mr("SimpleDb","Database upgrade to version "+Uc+" complete")})}}).Cs()},xh.delete=function(t){return Mr("SimpleDb","Removing database:",t),jh(window.indexedDB.deleteDatabase(t)).Cs()},xh.Js=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(xh.Ys())return!0;if(void 0===window.navigator)return!1;var t=l(),e=xh.Ks(t),n=0<e&&e<10,r=xh.Xs(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},xh.Ys=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.$s)},xh.Zs=function(t,e){return t.store(e)},xh.Ks=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},xh.Xs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},xh.prototype.to=function(e){this.db.onversionchange=function(t){return e(t)}},xh.prototype.runTransaction=function(r,h,c){return p(this,void 0,void 0,function(){var o,s,a,e,u,n;return y(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),s=r.endsWith("idempotent"),a=0,e=function(){var e,n,r,i;return y(this,function(t){switch(t.label){case 0:++a,e=Dh.open(u.db,o?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=c(e).catch(function(t){return e.abort(t),Ih.reject(t)}).Cs()).catch(function(){}),[4,e.no];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=s&&"FirebaseError"!==r.name&&a<3,Mr("SimpleDb","Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},xh.prototype.close=function(){this.db.close()},xh),kh=(Object.defineProperty(Ch.prototype,"As",{get:function(){return this.eo},enumerable:!0,configurable:!0}),Object.defineProperty(Ch.prototype,"uo",{get:function(){return this.ro},enumerable:!0,configurable:!0}),Object.defineProperty(Ch.prototype,"cursor",{set:function(t){this.io=t},enumerable:!0,configurable:!0}),Ch.prototype.done=function(){this.eo=!0},Ch.prototype.so=function(t){this.ro=t},Ch.prototype.delete=function(){return jh(this.io.delete())},Ch),Dh=(Oh.open=function(t,e,n){return new Oh(t.transaction(n,e))},Object.defineProperty(Oh.prototype,"no",{get:function(){return this.oo.promise},enumerable:!0,configurable:!0}),Oh.prototype.abort=function(t){t&&this.oo.reject(t),this.aborted||(Mr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Oh.prototype.store=function(t){var e=this.transaction.objectStore(t);return Fr(!!e,"Object store not part of transaction: "+t),new Rh(e)},Oh),Rh=(_h.prototype.put=function(t,e){return jh(void 0!==e?(Mr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Mr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},_h.prototype.add=function(t){return Mr("SimpleDb","ADD",this.store.name,t,t),jh(this.store.add(t))},_h.prototype.get=function(e){var n=this;return jh(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Mr("SimpleDb","GET",n.store.name,e,t),t})},_h.prototype.delete=function(t){return Mr("SimpleDb","DELETE",this.store.name,t),jh(this.store.delete(t))},_h.prototype.count=function(){return Mr("SimpleDb","COUNT",this.store.name),jh(this.store.count())},_h.prototype.ho=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.co(n,function(t,e){r.push(e)}).next(function(){return r})},_h.prototype.ao=function(t,e){Mr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.fo=!1;var r=this.cursor(n);return this.co(r,function(t,e,n){return n.delete()})},_h.prototype.lo=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.co(r,e)},_h.prototype.do=function(i){var t=this.cursor({});return new Ih(function(n,r){t.onerror=function(t){var e=Hh(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},_h.prototype.co=function(t,s){var a=[];return new Ih(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new kh(e),r=s(e.primaryKey,e.value,n);if(r instanceof Ih){var i=r.catch(function(t){return n.done(),Ih.reject(t)});a.push(i)}n.As?o():null===n.uo?e.continue():e.continue(n.uo)}else o()}}).next(function(){return Ih.Ns(a)})},_h.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Fr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},_h.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.fo?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},_h);function _h(t){this.store=t}function Oh(t){var n=this;this.transaction=t,this.aborted=!1,this.oo=new Xu,this.transaction.oncomplete=function(){n.oo.resolve()},this.transaction.onabort=function(){t.error?n.oo.reject(t.error):n.oo.resolve()},this.transaction.onerror=function(t){var e=Hh(t.target.error);n.oo.reject(e)}}function Ch(t){this.io=t,this.eo=!1,this.ro=null}function xh(t){this.db=t,12.2===xh.Ks(l())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Lh(){this.Gs=[]}function Ph(){this.Os=new Eh(function(t){return t.toString()}),this.Fs=!1}function Uh(t){var e=this;this.Es=null,this.Rs=null,this.result=void 0,this.error=void 0,this.As=!1,this.Ds=!1,t(function(t){e.As=!0,e.result=t,e.Es&&e.Es(t)},function(t){e.As=!0,e.error=t,e.Rs&&e.Rs(t)})}function Mh(t){this.Is=t,this.Ts={}}function qh(t,e){this.key=t,this._s=e}function Vh(){this.cs=new so(bh.Un),this.as=new so(bh.fs)}function Gh(t,e,n,r,i){this.batch=t,this.os=e,this.us=n,this.streamToken=r,this.hs=i}function Fh(t,e,n,r){this.batchId=t,this.Fn=e,this.baseMutations=n,Fr(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}function jh(t){return new Ih(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Hh(t.target.error);r(e)}})}var Bh=!1;function Hh(t){var e=Sh.Ks(l());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new ti("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Bh||(Bh=!0,setTimeout(function(){throw r},0)),r}}return t}var zh=(Yh.po=function(t,e,n,r){return Fr(""!==t.uid,"UserID must not be an empty string."),new Yh(t.l()?t.uid:"",e,n,r)},Yh.prototype.bo=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Qh(t).lo({index:zc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Yh.prototype.yo=function(e,t,n){return this._o(e).next(function(t){return t.lastStreamToken=n.toBase64(),Xh(e).put(t)})},Yh.prototype.Io=function(t){return this._o(t).next(function(t){return Ba.fromBase64String(t.lastStreamToken)})},Yh.prototype.To=function(e,n){return this._o(e).next(function(t){return t.lastStreamToken=n.toBase64(),Xh(e).put(t)})},Yh.prototype.Eo=function(h,c,f,l){var p=this,d=Jh(h),y=Qh(h);return y.add({}).next(function(t){Fr("number"==typeof t,"Auto-generated key is not a number");for(var e=new mh(t,c,f,l),n=p.serializer.Ro(p.userId,e),r=[],i=new so(function(t,e){return Hr(t.nt(),e.nt())}),o=0,s=l;o<s.length;o++){var a=s[o],u=Kc.key(p.userId,a.key.path,t);i=i.add(a.key.path.H()),r.push(y.put(n)),r.push(d.put(u,Kc.PLACEHOLDER))}return i.forEach(function(t){r.push(p.vo.Ao(h,t))}),h.Ws(function(){p.mo[t]=e.keys()}),Ih.Ns(r).next(function(){return e})})},Yh.prototype.Do=function(t,e){var n=this;return Qh(t).get(e).next(function(t){return t?(Fr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.Po(t)):null})},Yh.prototype.So=function(t,n){var r=this;return this.mo[n]?Ih.resolve(this.mo[n]):this.Do(t,n).next(function(t){if(t){var e=t.keys();return r.mo[n]=e}return null})},Yh.prototype.Co=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Qh(t).lo({index:zc.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Fr(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.Po(e)),n.done()}).next(function(){return o})},Yh.prototype.Vo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Qh(t).lo({index:zc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Yh.prototype.No=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Qh(t).ho(zc.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.Po(t)})})},Yh.prototype.ko=function(a,u){var h=this,t=Kc.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),c=[];return Jh(a).lo({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],s=vh(i);if(r===h.userId&&u.path.isEqual(s))return Qh(a).get(o).next(function(t){if(!t)throw Gr("Dangling document-mutation reference found: "+e+" which points to "+o);Fr(t.userId===h.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),c.push(h.serializer.Po(t))});n.done()}).next(function(){return c})},Yh.prototype.Oo=function(r,t){var u=this,h=new so(Hr),i=[];return t.forEach(function(a){var t=Kc.prefixForPath(u.userId,a.path),e=IDBKeyRange.lowerBound(t),n=Jh(r).lo({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=vh(i);r===u.userId&&a.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),Ih.Ns(i).next(function(){return u.Fo(r,h)})},Yh.prototype.xo=function(t,e){var a=this;Fr(!e.Gn(),"Document queries shouldn't go down this path"),Fr(!e.bi(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,h=u.length+1,n=Kc.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),c=new so(Hr);return Jh(t).lo({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=vh(i);r===a.userId&&u.$(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return a.Fo(t,c)})},Yh.prototype.Fo=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Qh(t).get(e).next(function(t){if(null===t)throw Gr("Dangling document-mutation reference found, which points to "+e);Fr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.Po(t))}))}),Ih.Ns(i).next(function(){return r})},Yh.prototype.jo=function(e,n){var r=this;return Kh(e.Uo,this.userId,n).next(function(t){return e.Ws(function(){r.Lo(n.batchId)}),Ih.forEach(t,function(t){return r.wo.Bo(e,t)})})},Yh.prototype.Lo=function(t){delete this.mo[t]},Yh.prototype.Mo=function(n){var o=this;return this.bo(n).next(function(t){if(!t)return Ih.resolve();var e=IDBKeyRange.lowerBound(Kc.prefixForUser(o.userId)),i=[];return Jh(n).lo({range:e},function(t,e,n){if(t[0]===o.userId){var r=vh(t[1]);i.push(r)}else n.done()}).next(function(){Fr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.nt()}))})})},Yh.prototype.ys=function(t,e){return Wh(t,this.userId,e)},Yh.prototype._o=function(t){var e=this;return Xh(t).get(this.userId).next(function(t){return t||new Hc(e.userId,-1,"")})},Yh);function Yh(t,e,n,r){this.userId=t,this.serializer=e,this.vo=n,this.wo=r,this.mo={}}function Wh(t,o,e){var n=Kc.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),a=!1;return Jh(t).lo({range:r,fo:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function Kh(t,e,n){var r=t.store(zc.store),i=t.store(Kc.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.lo({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Fr(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Kc.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return Ih.Ns(o).next(function(){return h})}function Qh(t){return Tf.Zs(t,zc.store)}function Jh(t){return Tf.Zs(t,Kc.store)}function Xh(t){return Tf.Zs(t,Hc.store)}var $h,Zh;(Zh=$h=$h||{})[Zh.qo=0]="__PRIVATE_QueryCache",Zh[Zh.Qo=1]="__PRIVATE_SyncEngine";var tc=(uc.prototype.next=function(){var t=this.zo;return this.zo+=2,t},uc.prototype.after=function(t){return this.Wo(t+2),this.next()},uc.prototype.Wo=function(t){Fr((1&t)===this.Go,"Cannot supply target ID from different generator ID"),this.zo=t},uc.Ko=function(){return new uc($h.qo,2)},uc.Ho=function(){return new uc($h.Qo)},uc),ec=(ac.prototype.Xo=function(e,n){var r=this;return this.Yo.ko(e,n).next(function(t){return r.$o(e,n,t)})},ac.prototype.$o=function(t,r,i){return this.Jo.Bs(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].Gt(r,t);return t})},ac.prototype.Zo=function(t,e,i){var o=ru();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].Gt(t,e);o=o.lt(t,e)}),o},ac.prototype.th=function(e,t){var n=this;return this.Jo.getEntries(e,t).next(function(t){return n.nh(e,t)})},ac.prototype.nh=function(r,i){var o=this;return this.Yo.Oo(r,i).next(function(t){var e=o.Zo(r,i,t),n=nu();return e.forEach(function(t,e){e=e||new Ps(t,Vi.B()),n=n.lt(t,e)}),n})},ac.prototype.ih=function(t,e,n){return e.Gn()?this.eh(t,e.path):e.bi()?this.rh(t,e,n):this.uh(t,e,n)},ac.prototype.eh=function(t,e){return this.Xo(t,new Hi(e)).next(function(t){var e=ou();return t instanceof Ls&&(e=e.lt(t.key,t)),e})},ac.prototype.rh=function(n,r,i){var o=this;Fr(r.path.J(),"Currently we only support collection group queries at the root.");var s=r.collectionGroup,a=ou();return this.vo.sh(n,s).next(function(t){return Ih.forEach(t,function(t){var e=r.hi(t.child(s));return o.uh(n,e,i).next(function(t){t.forEach(function(t,e){a=a.lt(t,e)})})}).next(function(){return a})})},ac.prototype.uh=function(e,n,t){var c,f,r=this;return this.Jo.ih(e,n,t).next(function(t){return c=t,r.Yo.xo(e,n)}).next(function(t){return f=t,r.oh(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,u=c.get(a),h=s.Gt(u,u,r.Fn);c=h instanceof Ls?c.lt(a,h):c.remove(a)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},ac.prototype.oh=function(t,e,n){for(var r=hu(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Vo&&null===n.get(u.key)&&(r=r.add(u.key))}var h=n;return this.Jo.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ls&&(h=h.lt(t,e))}),h})},ac),nc=(sc.fh=function(t,e){for(var n=hu(),r=hu(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case lu.Mi:n=n.add(s.doc.key);break;case lu.qi:r=r.add(s.doc.key)}}return new sc(t,e.fromCache,n,r)},sc),rc="LocalStore",ic=(oc.prototype.start=function(){return this.Dh()},oc.prototype.Ph=function(i){return p(this,void 0,void 0,function(){var e,v,n,r=this;return y(this,function(t){switch(t.label){case 0:return e=this.Yo,v=this.Eh,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var y;return r.Yo.No(d).next(function(t){return y=t,e=r.persistence.bh(i),v=new ec(r.yh,e,r.persistence.Rh()),e.No(d)}).next(function(t){for(var e=[],n=[],r=hu(),i=0,o=y;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++){var h=u[a];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){s=f[c],n.push(s.batchId);for(var l=0,p=s.mutations;l<p.length;l++)h=p[l],r=r.add(h.key)}return v.th(d,r).next(function(t){return{Sh:t,Ch:e,Vh:n}})})})];case 1:return n=t.sent(),this.Yo=e,this.Eh=v,this.lh.Ah(this.Eh),[2,n]}})})},oc.prototype.Nh=function(a){var u,h=this,c=qi.now(),t=a.reduce(function(t,e){return t.add(e.key)},hu());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(s){return h.Eh.th(s,t).next(function(t){u=t;for(var e=[],n=0,r=a;n<r.length;n++){var i=r[n],o=i.sn(u.get(i.key));null!=o&&e.push(new Vo(i.key,o,o.on(),Uo.exists(!0)))}return h.Yo.Eo(s,c,e,a)})}).then(function(t){var e=t.ss(u);return{batchId:t.batchId,Os:e}})},oc.prototype.kh=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.Yo.So(e,t).next(function(t){return t?n.Eh.th(e,t):Ih.resolve(null)})})},oc.prototype.yo=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.yh.Oh({Fh:!0});return i.Yo.yo(t,r.batch,r.streamToken).next(function(){return i.xh(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.Yo.Mo(t)}).next(function(){return i.Eh.th(t,e)})})},oc.prototype.jh=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.Yo.Do(e,t).next(function(t){return Fr(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.Yo.jo(e,t)}).next(function(){return r.Yo.Mo(e)}).next(function(){return r.Eh.th(e,n)})})},oc.prototype.Vo=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.Yo.Vo(t)})},oc.prototype.Io=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.Yo.Io(t)})},oc.prototype.To=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.Yo.To(t,e)})},oc.prototype.Uh=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e.Ih.Uh(t)})},oc.prototype.Lh=function(u){var h=this,c=u.Oi,f=this.vh;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=h.yh.Oh({Fh:!0});f=h.vh;var s=[];di(u.te,function(t,e){var n=f.get(t);if(n){s.push(h.Ih.Bh(o,e.ce,t).next(function(){return h.Ih.Mh(o,e.oe,t)}));var r=e.resumeToken;if(0<r.Cn()){var i=n.xi(r,c).Fi(o.qh);f=f.lt(t,i),oc.Qh(n,i,e)&&s.push(h.Ih.Gh(o,i))}}});var a=nu(),n=hu();if(u.ie.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){u.ie.forEach(function(t,e){var n=r.get(t);e instanceof Ps&&e.version.isEqual(Vi.MIN)?(i.Ls(t,c),a=a.lt(t,e)):null==n||0<e.version.h(n.version)||0===e.version.h(n.version)&&n.hasPendingWrites?(Fr(!Vi.MIN.isEqual(c),"Cannot add a document when the remote version is zero"),i.js(e,c),a=a.lt(t,e)):Mr(rc,"Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.ee.has(t)&&s.push(h.persistence.wo.Wh(o,t))})})),!c.isEqual(Vi.MIN)){var t=h.Ih.Uh(o).next(function(t){return Fr(0<=c.h(t),"Watch stream reverted to previous snapshot?? "+c+" < "+t),h.Ih.zh(o,o.qh,c)});s.push(t)}return Ih.Ns(s).next(function(){return i.apply(o)}).next(function(){return h.Eh.nh(o,a)})}).then(function(t){return h.vh=f,t})},oc.Qh=function(t,e,n){return Fr(0<e.resumeToken.Cn(),"Attempted to persist target data with no resume token"),0===t.resumeToken.Cn()||e.Oi.M()-t.Oi.M()>=this.Kh||0<n.oe.size+n.he.size+n.ce.size},oc.prototype.Hh=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.dh.ds(i.hh,o),this.dh.ms(i.ah,o),!i.fromCache){var s=this.vh.get(o);Fr(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var a=s.Oi,u=s.ji(a);this.vh=this.vh.lt(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return Ih.forEach(t,function(t){return Ih.forEach(t.ah,function(t){return n.persistence.wo.vs(e,t)})})})},oc.prototype.Jh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.Yo.Co(t,e)})},oc.prototype.Yh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.Eh.Xo(t,e)})},oc.prototype.Xh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i.Ih.$h(e,r).next(function(t){return t?(n=t,Ih.resolve(n)):i.Ih.Zh(e).next(function(t){return n=new Qa(r,t,Fa.Ci,e.qh),i.Ih.tc(e,n).next(function(){return n})})})}).then(function(t){return null===i.vh.get(t.targetId)&&(i.vh=i.vh.lt(t.targetId,t),i.wh.set(r,t.targetId)),t})},oc.prototype.$h=function(t,e){var n=this.wh.get(e);return void 0!==n?Ih.resolve(this.vh.get(n)):this.Ih.$h(t,e)},oc.prototype.nc=function(n,r){var i=this,o=this.vh.get(n);Fr(null!==o,"Tried to release nonexistent target: "+n);var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.dh.ps(n);return r?Ih.resolve():Ih.forEach(t,function(t){return i.persistence.wo.vs(e,t)}).next(function(){i.persistence.wo.removeTarget(e,o)})}).then(function(){i.vh=i.vh.remove(n),i.wh.delete(o.target)})},oc.prototype.ic=function(t,n){var r=this,i=Vi.MIN,o=hu();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.$h(e,t.ai()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ih.ec(e,t.targetId).next(function(t){o=t})}).next(function(){return r.lh.ih(e,t,n?i:Vi.MIN,n?o:hu())}).next(function(t){return{documents:t,rc:o}})})},oc.prototype.uc=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n.Ih.ec(t,e)})},oc.prototype.sc=function(){return this.persistence.sc()},oc.prototype.oc=function(t){this.Yo.Lo(t)},oc.prototype.hc=function(t){this.persistence.hc(t)},oc.prototype.xh=function(t,i,o){var e=this,s=i.batch,n=s.keys(),a=Ih.resolve();return n.forEach(function(r){a=a.next(function(){return o.Bs(t,r)}).next(function(t){var e=t,n=i.hs.get(r);Fr(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.h(n)<0)&&((e=s.Wt(r,e,i))?o.js(e,i.os):Fr(!t,"Mutation batch "+s+" applied to document "+t+" resulted in null"))})}),a.next(function(){return e.Yo.jo(t,s)})},oc.prototype.cc=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.ac(t,n.vh)})},oc.prototype.fc=function(e){var n=this,t=this.vh.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n.Ih.Xe(t,e).next(function(t){return t?t.target:null})})},oc.prototype.lc=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.yh.lc(t,r.mh)}).then(function(t){var e=t.dc,n=t.readTime;return r.mh=n,e})},oc.prototype.Dh=function(){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return n.yh.vc(t)})];case 1:return e.mh=t.sent(),[2]}})})},oc.Kh=3e8,oc);function oc(t,e,n){this.persistence=t,this.lh=e,this.dh=new wh,this.vh=new zi(Hr),this.wh=new Eh(function(t){return t.canonicalId()}),this.mh=Vi.MIN,Fr(t.ph,"LocalStore was passed an unstarted persistence implementation"),this.persistence.wo.gh(this.dh),this.Yo=t.bh(n),this.yh=t._h(),this.Ih=t.Th(),this.Eh=new ec(this.yh,this.Yo,this.persistence.Rh()),this.lh.Ah(this.Eh)}function sc(t,e,n,r){this.targetId=t,this.fromCache=e,this.hh=n,this.ah=r}function ac(t,e,n){this.Jo=t,this.Yo=e,this.vo=n}function uc(t,e){Fr((1&(this.Go=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.Wo(void 0!==e?e:this.Go)}function hc(e){return p(this,void 0,void 0,function(){return y(this,function(t){if(e.code!==Zr.FAILED_PRECONDITION||e.message!==Nh)throw e;return Mr(rc,"Unexpectedly lost primary lease"),[2]})})}function cc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Hr(n,i);return 0===s?Hr(r,o):s}var fc=(Ec.prototype.pc=function(){return++this.mc},Ec.prototype.gc=function(t){var e=[t,this.pc()];if(this.buffer.size<this.wc)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();cc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(Ec.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),Ec),lc={bc:!1,yc:0,_c:0,Ic:0},pc=(bc.Ac=function(t){return new bc(t,bc.Dc,bc.Pc)},bc.Sc=-1,bc.Cc=1048576,bc.Nc=new bc(bc.Vc=41943040,bc.Dc=10,bc.Pc=1e3),bc.DISABLED=new bc(bc.Sc,0,0),bc),dc=(wc.prototype.start=function(){Fr(null===this.xc,"Cannot start an already started LruScheduler"),this.kc.params.Tc!==pc.Sc&&this.jc()},wc.prototype.stop=function(){this.xc&&(this.xc.cancel(),this.xc=null)},Object.defineProperty(wc.prototype,"ph",{get:function(){return null!==this.xc},enumerable:!0,configurable:!0}),wc.prototype.jc=function(){var t=this;Fr(null===this.xc,"Cannot schedule GC while a task is pending");var e=this.Fc?3e5:6e4;Mr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.xc=this.Su.Xu($u.Du,e,function(){return t.xc=null,t.Fc=!0,t.Oc.cc(t.kc).then(function(){return t.jc()}).catch(hc)})},wc),yc=(gc.prototype.Lc=function(t,e){return this.Uc.Bc(t).next(function(t){return Math.floor(e/100*t)})},gc.prototype.Mc=function(t,e){var n=this;if(0===e)return Ih.resolve(nh.bu);var r=new fc(e);return this.Uc.Be(t,function(t){return r.gc(t.sequenceNumber)}).next(function(){return n.Uc.qc(t,function(t){return r.gc(t)})}).next(function(){return r.maxValue})},gc.prototype.Qc=function(t,e,n){return this.Uc.Qc(t,e,n)},gc.prototype.Gc=function(t,e){return this.Uc.Gc(t,e)},gc.prototype.ac=function(e,n){var r=this;return this.params.Tc===pc.Sc?(Mr("LruGarbageCollector","Garbage collection skipped; disabled"),Ih.resolve(lc)):this.Wc(e).next(function(t){return t<r.params.Tc?(Mr("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Tc),lc):r.zc(e,n)})},gc.prototype.Wc=function(t){return this.Uc.Wc(t)},gc.prototype.zc=function(e,n){var r,i,o,s,a,u,h,c=this,f=Date.now();return this.Lc(e,this.params.Ec).next(function(t){return i=t>c.params.Rc?(Mr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Rc+" from "+t),c.params.Rc):t,s=Date.now(),c.Mc(e,i)}).next(function(t){return r=t,a=Date.now(),c.Qc(e,r,n)}).next(function(t){return o=t,u=Date.now(),c.Gc(e,r)}).next(function(t){return h=Date.now(),Pr()<=Ar.DEBUG&&Mr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(h-u)+"ms\nTotal Duration: "+(h-f)+"ms"),Ih.resolve({bc:!0,yc:i,_c:o,Ic:t})})},gc),vc=(mc.prototype.Zh=function(e){var n=this;return this.Hc(e).next(function(t){return t.highestTargetId=n.Kc.after(t.highestTargetId),n.Jc(e,t).next(function(){return t.highestTargetId})})},mc.prototype.Uh=function(t){return this.Hc(t).next(function(t){return Vi.L(new qi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},mc.prototype.Yc=function(t){return Nc(t.Uo)},mc.prototype.zh=function(e,n,r){var i=this;return this.Hc(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.q()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Jc(e,t)})},mc.prototype.tc=function(e,n){var r=this;return this.Xc(e,n).next(function(){return r.Hc(e).next(function(t){return t.targetCount+=1,r.$c(n,t),r.Jc(e,t)})})},mc.prototype.Gh=function(t,e){return this.Xc(t,e)},mc.prototype.Zc=function(e,t){var n=this;return this.ta(e,t.targetId).next(function(){return Ic(e).delete(t.targetId)}).next(function(){return n.Hc(e)}).next(function(t){return Fr(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.Jc(e,t)})},mc.prototype.Qc=function(r,i,o){var s=this,a=0,u=[];return Ic(r).lo(function(t,e){var n=s.serializer.na(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(a++,u.push(s.Zc(r,n)))}).next(function(){return Ih.Ns(u)}).next(function(){return a})},mc.prototype.Be=function(t,r){var i=this;return Ic(t).lo(function(t,e){var n=i.serializer.na(e);r(n)})},mc.prototype.Hc=function(t){return Tc(t.Uo)},mc.prototype.Jc=function(t,e){return(n=t,Tf.Zs(n,of.store)).put(of.key,e);var n},mc.prototype.Xc=function(t,e){return Ic(t).put(this.serializer.ia(e))},mc.prototype.$c=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},mc.prototype.ea=function(t){return this.Hc(t).next(function(t){return t.targetCount})},mc.prototype.$h=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Ic(t).lo({range:n,index:nf.queryTargetsIndexName},function(t,e,n){var r=o.serializer.na(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},mc.prototype.Mh=function(n,t,r){var i=this,o=[],s=Ac(n);return t.forEach(function(t){var e=ph(t.path);o.push(s.put(new rf(r,e))),o.push(i.wo.ls(n,t))}),Ih.Ns(o)},mc.prototype.Bh=function(n,t,r){var i=this,o=Ac(n);return Ih.forEach(t,function(t){var e=ph(t.path);return Ih.Ns([o.delete([r,e]),i.wo.vs(n,t)])})},mc.prototype.ta=function(t,e){var n=Ac(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},mc.prototype.ec=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ac(t),o=hu();return r.lo({range:n,fo:!0},function(t,e,n){var r=vh(t[1]),i=new Hi(r);o=o.add(i)}).next(function(){return o})},mc.prototype.ys=function(t,e){var n=ph(e.path),r=IDBKeyRange.bound([n],[Yr(n)],!1,!0),i=0;return Ac(t).lo({index:rf.documentTargetsIndex,fo:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},mc.prototype.Xe=function(t,e){var n=this;return Ic(t).get(e).next(function(t){return t?n.serializer.na(t):null})},mc);function mc(t,e){this.wo=t,this.serializer=e,this.Kc=tc.Ko()}function gc(t,e){this.Uc=t,this.params=e}function wc(t,e,n){this.kc=t,this.Su=e,this.Oc=n,this.Fc=!1,this.xc=null}function bc(t,e,n){this.Tc=t,this.Ec=e,this.Rc=n}function Ec(t){this.wc=t,this.buffer=new so(cc),this.mc=0}function Ic(t){return Tf.Zs(t,nf.store)}function Tc(t){return Sh.Zs(t,of.store).get(of.key).next(function(t){return Fr(null!==t,"Missing metadata row."),t})}function Nc(t){return Tc(t).next(function(t){return t.highestListenSequenceNumber})}function Ac(t){return Tf.Zs(t,rf.store)}var Sc,kc=(Dc.prototype.js=function(t,e,n){return Oc(t).put(Cc(e),n)},Dc.prototype.Ls=function(t,e){var n=Oc(t),r=Cc(e);return n.delete(r)},Dc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.ra(e,t)})},Dc.prototype.Bs=function(t,e){var n=this;return Oc(t).get(Cc(e)).next(function(t){return n.ua(t)})},Dc.prototype.sa=function(t,e){var n=this;return Oc(t).get(Cc(e)).next(function(t){var e=n.ua(t);return e?{oa:e,size:xc(t)}:null})},Dc.prototype.getEntries=function(t,e){var r=this,i=ru();return this.ha(t,e,function(t,e){var n=r.ua(e);i=i.lt(t,n)}).next(function(){return i})},Dc.prototype.ca=function(t,e){var r=this,i=ru(),o=new zi(Hi.G);return this.ha(t,e,function(t,e){var n=r.ua(e);o=n?(i=i.lt(t,n),o.lt(t,xc(e))):(i=i.lt(t,null),o.lt(t,0))}).next(function(){return{aa:i,fa:o}})},Dc.prototype.ha=function(t,e,i){if(e.J())return Ih.resolve();var n=IDBKeyRange.bound(e.first().path.tt(),e.last().path.tt()),o=e.bt(),s=o.Rt();return Oc(t).lo({range:n},function(t,e,n){for(var r=Hi.at(t);s&&Hi.G(s,r)<0;)i(s,null),s=o.Rt();s&&s.isEqual(r)&&(i(s,e),s=o.At()?o.Rt():null),s?n.so(s.path.tt()):n.done()}).next(function(){for(;s;)i(s,null),s=o.At()?o.Rt():null})},Dc.prototype.ih=function(t,i,e){var o=this;Fr(!i.bi(),"CollectionGroup queries should be handled in LocalDocumentsView");var s=ou(),a=i.path.length+1,n={};if(e.isEqual(Vi.MIN)){var r=i.path.tt();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.tt(),h=this.serializer.la(e);n.range=IDBKeyRange.lowerBound([u,h],!0),n.index=$c.collectionReadTimeIndex}return Oc(t).lo(n,function(t,e,n){if(t.length===a){var r=o.serializer.da(e);i.path.$(r.key.path)?r instanceof Ls&&i.matches(r)&&(s=s.lt(r.key,r)):n.done()}}).next(function(){return s})},Dc.prototype.lc=function(t,e){var r=this,i=nu(),o=this.serializer.la(e),n=Oc(t),s=IDBKeyRange.lowerBound(o,!0);return n.lo({index:$c.readTimeIndex,range:s},function(t,e){var n=r.serializer.da(e);i=i.lt(n.key,n),o=e.readTime}).next(function(){return{dc:i,readTime:r.serializer.va(o)}})},Dc.prototype.vc=function(t){var r=this,e=Oc(t),i=Vi.MIN;return e.lo({index:$c.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.va(e.readTime)),n.done()}).next(function(){return i})},Dc.prototype.Oh=function(t){return new Dc.wa(this,!!t&&t.Fh)},Dc.prototype.ma=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Dc.prototype.getMetadata=function(t){return _c(t).get(Zc.key).next(function(t){return Fr(!!t,"Missing document cache metadata"),t})},Dc.prototype.ra=function(t,e){return _c(t).put(Zc.key,e)},Dc.prototype.ua=function(t){if(t){var e=this.serializer.da(t);return e instanceof Ps&&e.version.isEqual(Vi.B())?null:e}return null},Dc.wa=(t(Rc,Sc=Th),Rc.prototype.Qs=function(s){var a=this,u=[],h=0,c=new so(function(t,e){return Hr(t.nt(),e.nt())});return this.Os.forEach(function(t,e){var n=a.ga.get(t);if(Fr(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){Fr(!a.readTime.isEqual(Vi.MIN),"Cannot add a document with a read time of zero");var r=a.pa.serializer.ba(e,a.readTime);c=c.add(t.path.H());var i=xc(r);h+=i-n,u.push(a.pa.js(s,t,r))}else if(h-=n,a.Fh){var o=a.pa.serializer.ba(new Ps(t,Vi.B()),a.readTime);u.push(a.pa.js(s,t,o))}else u.push(a.pa.Ls(s,t))}),c.forEach(function(t){u.push(a.pa.vo.Ao(s,t))}),u.push(this.pa.updateMetadata(s,h)),Ih.Ns(u)},Rc.prototype.Ms=function(t,e){var n=this;return this.pa.sa(t,e).next(function(t){return null===t?(n.ga.set(e,0),null):(n.ga.set(e,t.size),t.oa)})},Rc.prototype.qs=function(t,e){var n=this;return this.pa.ca(t,e).next(function(t){var e=t.aa;return t.fa.forEach(function(t,e){n.ga.set(t,e)}),e})},Rc),Dc);function Dc(t,e){this.serializer=t,this.vo=e}function Rc(t,e){var n=Sc.call(this)||this;return n.pa=t,n.Fh=e,n.ga=new Eh(function(t){return t.toString()}),n}function _c(t){return Tf.Zs(t,Zc.store)}function Oc(t){return Tf.Zs(t,$c.store)}function Cc(t){return t.path.tt()}function xc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Gr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Lc=(Gc.prototype.Ao=function(t,e){return this.ya.add(e),Ih.resolve()},Gc.prototype.sh=function(t,e){return Ih.resolve(this.ya.getEntries(e))},Gc),Pc=(Vc.prototype.add=function(t){Fr(t.length%2==1,"Expected a collection path.");var e=t.X(),n=t.H(),r=this.index[e]||new so(Fi.G),i=!r.has(n);return this.index[e]=r.add(n),i},Vc.prototype.has=function(t){var e=t.X(),n=t.H(),r=this.index[e];return r&&r.has(n)},Vc.prototype.getEntries=function(t){return(this.index[t]||new so(Fi.G)).tt()},Vc),Uc=9,Mc=(qc.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Fr(t<e&&0<=t&&e<=Uc,"Unexpected schema upgrade from v"+t+" to v{toVersion}.");var o,s=new Dh(r);t<1&&1<=e&&(n.createObjectStore(jc.store),(o=n).createObjectStore(Hc.store,{keyPath:Hc.keyPath}),o.createObjectStore(zc.store,{keyPath:zc.keyPath,autoIncrement:!0}).createIndex(zc.userMutationsIndex,zc.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Kc.store),ff(n),n.createObjectStore($c.store));var a,u=Ih.resolve();return t<3&&3<=e&&(0!==t&&((a=n).deleteObjectStore(rf.store),a.deleteObjectStore(nf.store),a.deleteObjectStore(of.store),ff(n)),u=u.next(function(){return t=s.store(of.store),e=new of(0,0,Vi.MIN.q(),0),t.put(of.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(u=u.next(function(){return r=n,(i=s).store(zc.store).ho().next(function(t){r.deleteObjectStore(zc.store),r.createObjectStore(zc.store,{keyPath:zc.keyPath,autoIncrement:!0}).createIndex(zc.userMutationsIndex,zc.userMutationsKeyPath,{unique:!0});var e=i.store(zc.store),n=t.map(function(t){return e.put(t)});return Ih.Ns(n)});var r,i})),u=u.next(function(){n.createObjectStore(lf.store,{keyPath:lf.keyPath})})),t<5&&5<=e&&(u=u.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(u=u.next(function(){return n.createObjectStore(Zc.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(u=u.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(u=u.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(u=u.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore($c.store)).createIndex($c.readTimeIndex,$c.readTimeIndexPath,{unique:!1}),t.createIndex($c.collectionReadTimeIndex,$c.collectionReadTimeIndexPath,{unique:!1})})),u},qc.prototype.addDocumentGlobal=function(e){var n=0;return e.store($c.store).lo(function(t,e){n+=xc(e)}).next(function(){var t=new Zc(n);return e.store(Zc.store).put(Zc.key,t)})},qc.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Hc.store),e=r.store(zc.store);return t.ho().next(function(t){return Ih.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.ho(zc.userMutationsIndex,t).next(function(t){return Ih.forEach(t,function(t){Fr(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.Po(t);return Kh(r,n.userId,e).next(function(){})})})})})},qc.prototype.ensureSequenceNumbers=function(t){var s=t.store(rf.store),e=t.store($c.store);return Nc(t).next(function(i){var o=[];return e.lo(function(t,e){var n=new Fi(t),r=[0,ph(n)];o.push(s.get(r).next(function(t){return t?Ih.resolve():(e=n,s.put(new rf(0,ph(e),i)));var e}))}).next(function(){return Ih.Ns(o)})})},qc.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.X(),n=t.H();return r.put({collectionId:e,parent:ph(n)})}}t.createObjectStore(sf.store,{keyPath:sf.keyPath});var r=e.store(sf.store),o=new Pc;return e.store($c.store).lo({fo:!0},function(t,e){var n=new Fi(t);return i(n.H())}).next(function(){return e.store(Kc.store).lo({fo:!0},function(t,e){t[0];var n=t[1],r=(t[2],vh(n));return i(r.H())})})},qc);function qc(t){this.serializer=t}function Vc(){this.index={}}function Gc(){this.ya=new Pc}function Fc(t,e){this.seconds=t,this.nanoseconds=e}var jc=(Bc.store="owner",Bc.key="owner",Bc);function Bc(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Hc=(Wc.store="mutationQueues",Wc.keyPath="userId",Wc),zc=(Yc.store="mutations",Yc.keyPath="batchId",Yc.userMutationsIndex="userMutationsIndex",Yc.userMutationsKeyPath=["userId","batchId"],Yc);function Yc(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}function Wc(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var Kc=(Qc.prefixForUser=function(t){return[t]},Qc.prefixForPath=function(t,e){return[t,ph(e)]},Qc.key=function(t,e,n){return[t,ph(e),n]},Qc.store="documentMutations",Qc.PLACEHOLDER=new Qc,Qc);function Qc(){}function Jc(t,e){this.path=t,this.readTime=e}function Xc(t,e){this.path=t,this.version=e}var $c=(ef.store="remoteDocuments",ef.readTimeIndex="readTimeIndex",ef.readTimeIndexPath="readTime",ef.collectionReadTimeIndex="collectionReadTimeIndex",ef.collectionReadTimeIndexPath=["parentPath","readTime"],ef),Zc=(tf.store="remoteDocumentGlobal",tf.key="remoteDocumentGlobalKey",tf);function tf(t){this.byteSize=t}function ef(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var nf=(cf.store="targets",cf.keyPath="targetId",cf.queryTargetsIndexName="queryTargetsIndex",cf.queryTargetsKeyPath=["canonicalId","targetId"],cf),rf=(hf.store="targetDocuments",hf.keyPath=["targetId","path"],hf.documentTargetsIndex="documentTargetsIndex",hf.documentTargetsKeyPath=["path","targetId"],hf),of=(uf.key="targetGlobalKey",uf.store="targetGlobal",uf),sf=(af.store="collectionParents",af.keyPath=["collectionId","parent"],af);function af(t,e){this.collectionId=t,this.parent=e}function uf(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}function hf(t,e,n){this.targetId=t,this.path=e,Fr(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}function cf(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}function ff(t){t.createObjectStore(rf.store,{keyPath:rf.keyPath}).createIndex(rf.documentTargetsIndex,rf.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(nf.store,{keyPath:nf.keyPath}).createIndex(nf.queryTargetsIndexName,nf.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(of.store)}var lf=(pf.store="clientMetadata",pf.keyPath="clientId",pf);function pf(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var df=s(s(s([Hc.store,zc.store,Kc.store,$c.store,nf.store,jc.store,of.store,rf.store],[lf.store]),[Zc.store]),[sf.store]),yf=(vf.prototype.Ao=function(t,e){var n=this;if(Fr(e.length%2==1,"Expected a collection path."),this._a.has(e))return Ih.resolve();var r=e.X(),i=e.H();t.Ws(function(){n._a.add(e)});var o={collectionId:r,parent:ph(i)};return mf(t).put(o)},vf.prototype.sh=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Yr(i),""],!1,!0);return mf(t).ho(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(vh(r.parent))}return o})},vf);function vf(){this._a=new Pc}function mf(t){return Tf.Zs(t,sf.store)}var gf=(wf.prototype.da=function(t){if(t.document)return this.Ia.Rr(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Hi.at(t.noDocument.path),n=this.Ta(t.noDocument.readTime);return new Ps(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=Hi.at(t.unknownDocument.path),n=this.Ta(t.unknownDocument.version),new Us(e,n)):Gr("Unexpected DbRemoteDocument")},wf.prototype.ba=function(t,e){var n=this.la(e),r=t.key.path.H().tt();if(t instanceof Ls){var i=t.proto?t.proto:this.Ia.Er(t),o=t.hasCommittedMutations;return new $c(null,null,i,o,n,r)}if(t instanceof Ps){var s=t.key.path.tt(),a=this.Ea(t.version);return o=t.hasCommittedMutations,new $c(null,new Jc(s,a),null,o,n,r)}if(t instanceof Us){s=t.key.path.tt();var u=this.Ea(t.version);return new $c(new Xc(s,u),null,null,!0,n,r)}return Gr("Unexpected MaybeDocument")},wf.prototype.la=function(t){var e=t.q();return[e.seconds,e.nanoseconds]},wf.prototype.va=function(t){var e=new qi(t[0],t[1]);return Vi.L(e)},wf.prototype.Ea=function(t){var e=t.q();return new Fc(e.seconds,e.nanoseconds)},wf.prototype.Ta=function(t){var e=new qi(t.seconds,t.nanoseconds);return Vi.L(e)},wf.prototype.Ro=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.Ia.Or(t)}),i=e.mutations.map(function(t){return n.Ia.Or(t)});return new zc(t,e.batchId,e.Fn.toMillis(),r,i)},wf.prototype.Po=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.Ia.Ur(t)}),r=t.mutations.map(function(t){return e.Ia.Ur(t)}),i=qi.fromMillis(t.localWriteTimeMs);return new mh(t.batchId,i,n,r)},wf.prototype.Ra=function(t){var e=[];return t.forEach(function(t){e.push(ph(t.path))}),e},wf.prototype.Aa=function(t){for(var e=hu(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Hi(vh(i)))}return e},wf.prototype.na=function(t){var e,n=this.Ta(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Ta(t.lastLimboFreeSnapshotVersion):Vi.MIN;return e=void 0!==t.query.documents?this.Ia.Wr(t.query):this.Ia.Yr(t.query),new Qa(e,t.targetId,Fa.Ci,t.lastListenSequenceNumber,n,r,Ba.fromBase64String(t.resumeToken))},wf.prototype.ia=function(t){Fr(Fa.Ci===t.ki,"Only queries with purpose "+Fa.Ci+" may be stored, got "+t.ki);var e,n=this.Ea(t.Oi),r=this.Ea(t.lastLimboFreeSnapshotVersion);e=t.target.Gn()?this.Ia.Gr(t.target):this.Ia.zr(t.target);var i=t.resumeToken.toBase64();return new nf(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},wf);function wf(t){this.Ia=t}var bf,Ef="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",If=(t(Af,bf=Ah),Af),Tf=(Nf.Zs=function(t,e){if(t instanceof If)return Sh.Zs(t.Uo,e);throw Gr("IndexedDbPersistence must use instances of IndexedDbTransaction")},Nf.Ua=function(n){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:if(!Nf.Js())throw new ti(Zr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new Nf(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.La,n.Da,n.serializer,n.Pa)).start()];case 1:return t.sent(),[2,e]}})})},Nf.prototype.start=function(){var e=this;return Fr(!this.ph,"IndexedDbPersistence double-started!"),Fr(null!==this.window,"Expected 'window' to be defined"),Sh.Hs(this.Fa,Uc,new Mc(this.serializer)).then(function(t){return e.Ba=t,e.Ma()}).then(function(){return e.qa(),e.Qa(),e.Ga(),e.Ba.runTransaction("readonly-idempotent",[of.store],function(t){return Nc(t)})}).then(function(t){e.Wa=new nh(t,e.Pa)}).then(function(){e.Sa=!0}).catch(function(t){return e.Ba&&e.Ba.close(),Promise.reject(t)})},Nf.prototype.za=function(n){var t=this;return this.Oa=function(e){return p(t,void 0,void 0,function(){return y(this,function(t){return this.ph?[2,n(e)]:[2]})})},n(this.isPrimary)},Nf.prototype.Ka=function(n){var t=this;this.Ba.to(function(e){return p(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Nf.prototype.hc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Da.Uu(function(){return p(e,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.ph?[4,this.Ma()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Nf.prototype.Ma=function(){var n=this;return this.Ba.runTransaction("readwrite-idempotent",df,function(e){return kf(e).put(new lf(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Ha(e).next(function(t){t||(n.isPrimary=!1,n.Da.Uu(function(){return n.Oa(!1)}))})}).next(function(){return n.Ja(e)}).next(function(t){return n.isPrimary&&!t?n.Ya(e).next(function(){return!1}):!!t&&n.Xa(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return Mr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Da.Uu(function(){return n.Oa(t)}),n.isPrimary=t})},Nf.prototype.Ha=function(t){var e=this;return Sf(t).get(jc.key).next(function(t){return Ih.resolve(e.$a(t))})},Nf.prototype.Za=function(t){return kf(t).delete(this.clientId)},Nf.prototype.tf=function(){return p(this,void 0,void 0,function(){var i=this;return y(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.nf(this.ka,18e5)?[3,2]:(this.ka=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=Nf.Zs(t,lf.store);return r.ho().next(function(t){var e=i.if(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Ih.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.ef(t.clientId))}),t.label=2;case 2:return[2]}})})},Nf.prototype.Ga=function(){var t=this;this.Na=this.Da.Xu($u.Au,4e3,function(){return t.Ma().then(function(){return t.tf()}).then(function(){return t.Ga()})})},Nf.prototype.$a=function(t){return!!t&&t.ownerId===this.clientId},Nf.prototype.Ja=function(e){var i=this;return Sf(e).get(jc.key).next(function(t){if(null!==t&&i.nf(t.leaseTimestampMs,5e3)&&!i.rf(t.ownerId)){if(i.$a(t)&&i.networkEnabled)return!0;if(!i.$a(t)){if(!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,Ef);return!1}}return!(!i.networkEnabled||!i.inForeground)||kf(e).ho().next(function(t){return void 0===i.if(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Mr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Nf.prototype.shutdown=function(){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){switch(t.label){case 0:return this.Sa=!1,this.uf(),this.Na&&(this.Na.cancel(),this.Na=null),this.sf(),this.hf(),[4,this.Ba.runTransaction("readwrite-idempotent",[jc.store,lf.store],function(t){return e.Ya(t).next(function(){return e.Za(t)})})];case 1:return t.sent(),this.Ba.close(),this.cf(),[2]}})})},Nf.prototype.if=function(t,e){var n=this;return t.filter(function(t){return n.nf(t.updateTimeMs,e)&&!n.rf(t.clientId)})},Nf.prototype.sc=function(){var e=this;return this.Ba.runTransaction("readonly-idempotent",[lf.store],function(t){return kf(t).ho().next(function(t){return e.if(t,18e5).map(function(t){return t.clientId})})})},Nf.clearPersistence=function(n){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return Nf.Js()?(e=n+Nf.xa,[4,Sh.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Nf.prototype,"ph",{get:function(){return this.Sa},enumerable:!0,configurable:!0}),Nf.prototype.bh=function(t){return Fr(this.ph,"Cannot initialize MutationQueue before persistence is started."),zh.po(t,this.serializer,this.vo,this.wo)},Nf.prototype.Th=function(){return Fr(this.ph,"Cannot initialize TargetCache before persistence is started."),this.Ih},Nf.prototype._h=function(){return Fr(this.ph,"Cannot initialize RemoteDocumentCache before persistence is started."),this.Jo},Nf.prototype.Rh=function(){return Fr(this.ph,"Cannot initialize IndexManager before persistence is started."),this.vo},Nf.prototype.runTransaction=function(n,t,r){var i=this;Mr("IndexedDbPersistence","Starting transaction:",n);var o,e=t.endsWith("idempotent"),s=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.Ba.runTransaction(s,df,function(e){return o=new If(e,i.Wa.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.Ha(e).next(function(t){return!!t||i.Ja(e)}).next(function(t){if(!t)throw qr("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.Da.Uu(function(){return i.Oa(!1)}),new ti(Zr.FAILED_PRECONDITION,Nh);return r(o)}).next(function(t){return i.Xa(e).next(function(){return t})}):i.af(e).next(function(){return r(o)})}).then(function(t){return o.zs(),t})},Nf.prototype.af=function(t){var e=this;return Sf(t).get(jc.key).next(function(t){if(null!==t&&e.nf(t.leaseTimestampMs,5e3)&&!e.rf(t.ownerId)&&!e.$a(t)&&!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,Ef)})},Nf.prototype.Xa=function(t){var e=new jc(this.clientId,this.allowTabSynchronization,Date.now());return Sf(t).put(jc.key,e)},Nf.Js=function(){return Sh.Js()},Nf.ff=function(t){var e=t.s.projectId;return t.s.o||(e+="."+t.s.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Nf.prototype.Ya=function(t){var e=this,n=Sf(t);return n.get(jc.key).next(function(t){return e.$a(t)?(Mr("IndexedDbPersistence","Releasing primary lease."),n.delete(jc.key)):Ih.resolve()})},Nf.prototype.nf=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(qr("Detected an update time that is in the future: "+t+" > "+n),1))},Nf.prototype.qa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Va=function(){t.Da.Uu(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ma()})},this.document.addEventListener("visibilitychange",this.Va),this.inForeground="visible"===this.document.visibilityState)},Nf.prototype.sf=function(){this.Va&&(Fr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.Va),this.Va=null)},Nf.prototype.Qa=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Ca=function(){t.uf(),t.Da.Uu(function(){return t.shutdown()})},this.window.addEventListener("unload",this.Ca))},Nf.prototype.hf=function(){this.Ca&&(Fr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.Ca),this.Ca=null)},Nf.prototype.rf=function(t){try{var e=null!==this.ja.getItem(this.ef(t));return Mr("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return qr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Nf.prototype.uf=function(){try{this.ja.setItem(this.ef(this.clientId),String(Date.now()))}catch(t){qr("Failed to set zombie client id.",t)}},Nf.prototype.cf=function(){try{this.ja.removeItem(this.ef(this.clientId))}catch(t){}},Nf.prototype.ef=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Nf.xa="main",Nf);function Nf(t,e,n,r,i,o,s,a){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Da=o,this.Pa=a,this.Sa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ca=null,this.inForeground=!1,this.Va=null,this.Na=null,this.ka=Number.NEGATIVE_INFINITY,this.Oa=function(t){return Promise.resolve()},this.wo=new Df(this,i),this.Fa=e+Nf.xa,this.serializer=new gf(s),this.document=r.document,this.Ih=new vc(this.wo,this.serializer),this.vo=new yf,this.Jo=new kc(this.serializer,this.vo),!r.window||!r.window.localStorage)throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.ja=this.window.localStorage}function Af(t,e){var n=bf.call(this)||this;return n.Uo=t,n.qh=e,n}function Sf(t){return t.store(jc.store)}function kf(t){return t.store(lf.store)}var Df=(Rf.prototype.Bc=function(t){var n=this.df(t);return this.db.Th().ea(t).next(function(e){return n.next(function(t){return e+t})})},Rf.prototype.df=function(t){var e=0;return this.qc(t,function(t){e++}).next(function(){return e})},Rf.prototype.Be=function(t,e){return this.db.Th().Be(t,e)},Rf.prototype.qc=function(t,n){return this.vf(t,function(t,e){return n(e)})},Rf.prototype.gh=function(t){this.lf=t},Rf.prototype.ls=function(t,e){return _f(t,e)},Rf.prototype.vs=function(t,e){return _f(t,e)},Rf.prototype.Qc=function(t,e,n){return this.db.Th().Qc(t,e,n)},Rf.prototype.Bo=function(t,e){return _f(t,e)},Rf.prototype.wf=function(t,e){return this.lf.ys(e)?Ih.resolve(!0):(r=e,i=!1,Xh(n=t).do(function(t){return Wh(n,t,r).next(function(t){return t&&(i=!0),Ih.resolve(!t)})}).next(function(){return i}));var n,r,i},Rf.prototype.Gc=function(r,i){var o=this,s=this.db._h().Oh(),a=[],u=0;return this.vf(r,function(e,t){if(t<=i){var n=o.wf(r,e).next(function(t){if(!t)return u++,s.Bs(r,e).next(function(){return s.Ls(e),Ac(r).delete([0,ph(e.path)])})});a.push(n)}}).next(function(){return Ih.Ns(a)}).next(function(){return s.apply(r)}).next(function(){return u})},Rf.prototype.removeTarget=function(t,e){var n=e.Fi(t.qh);return this.db.Th().Gh(t,n)},Rf.prototype.Wh=function(t,e){return _f(t,e)},Rf.prototype.vf=function(t,o){var s,e=Ac(t),a=nh.bu;return e.lo({index:rf.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(a!==nh.bu&&o(new Hi(vh(s)),a),a=i,s=r):a=nh.bu}).next(function(){a!==nh.bu&&o(new Hi(vh(s)),a)})},Rf.prototype.Wc=function(t){return this.db._h().ma(t)},Rf);function Rf(t,e){this.db=t,this.lf=null,this.kc=new yc(this,e)}function _f(t,e){return Ac(t).put((n=e,r=t.qh,new rf(0,ph(n.path),r)));var n,r}var Of=(Lf.prototype.Ah=function(t){this.mf=t},Lf.prototype.ih=function(e,r,i,o){var s=this;return Fr(void 0!==this.mf,"setLocalDocumentsView() not called"),r.ci()?this.pf(e,r):i.isEqual(Vi.MIN)?this.pf(e,r):this.mf.th(e,o).next(function(t){var n=s.gf(r,t);return(r.mi()||r.pi())&&s.bf(r.Hn,n,o,i)?s.pf(e,r):(Pr()<=Ar.DEBUG&&Mr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.mf.ih(e,r,i).next(function(e){return n.forEach(function(t){e=e.lt(t.key,t)}),e}))})},Lf.prototype.gf=function(n,t){var r=new so(function(t,e){return n.fi(t,e)});return t.forEach(function(t,e){e instanceof Ls&&n.matches(e)&&(r=r.add(e))}),r},Lf.prototype.bf=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===ra.Wn?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.h(r))},Lf.prototype.pf=function(t,e){return Pr()<=Ar.DEBUG&&Mr("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.mf.ih(t,e,Vi.MIN)},Lf),Cf=(xf.prototype.bo=function(t){return Ih.resolve(0===this.Yo.length)},xf.prototype.yo=function(t,e,n){var r=e.batchId,i=this.If(r,"acknowledged");Fr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.Yo[i];return Fr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Ih.resolve()},xf.prototype.Io=function(t){return Ih.resolve(this.lastStreamToken)},xf.prototype.To=function(t,e){return this.lastStreamToken=e,Ih.resolve()},xf.prototype.Eo=function(t,e,n,r){Fr(0!==r.length,"Mutation batches should not be empty");var i=this.yf;this.yf++,0<this.Yo.length&&Fr(this.Yo[this.Yo.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new mh(i,e,n,r);this.Yo.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this._f=this._f.add(new bh(u.key,i)),this.vo.Ao(t,u.key.path.H())}return Ih.resolve(o)},xf.prototype.Do=function(t,e){return Ih.resolve(this.Tf(e))},xf.prototype.So=function(t,e){var n=this.Tf(e);return Fr(null!=n,"Failed to find local mutation batch."),Ih.resolve(n.keys())},xf.prototype.Co=function(t,e){var n=e+1,r=this.Ef(n),i=r<0?0:r;return Ih.resolve(this.Yo.length>i?this.Yo[i]:null)},xf.prototype.Vo=function(){return Ih.resolve(0===this.Yo.length?-1:this.yf-1)},xf.prototype.No=function(t){return Ih.resolve(this.Yo.slice())},xf.prototype.ko=function(t,n){var r=this,e=new bh(n,0),i=new bh(n,Number.POSITIVE_INFINITY),o=[];return this._f.Lt([e,i],function(t){Fr(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.Tf(t._s);Fr(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Ih.resolve(o)},xf.prototype.Oo=function(t,e){var r=this,i=new so(Hr);return e.forEach(function(e){var t=new bh(e,0),n=new bh(e,Number.POSITIVE_INFINITY);r._f.Lt([t,n],function(t){Fr(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t._s)})}),Ih.resolve(this.Rf(i))},xf.prototype.xo=function(t,e){Fr(!e.bi(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Hi.ht(i)||(i=i.child(""));var o=new bh(new Hi(i),0),s=new so(Hr);return this._f.Bt(function(t){var e=t.key.path;return!!n.$(e)&&(e.length===r&&(s=s.add(t._s)),!0)},o),Ih.resolve(this.Rf(s))},xf.prototype.Rf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Tf(t);null!==e&&r.push(e)}),r},xf.prototype.jo=function(n,r){var i=this;Fr(0===this.If(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.Yo.shift();var o=this._f;return Ih.forEach(r.mutations,function(t){var e=new bh(t.key,r.batchId);return o=o.delete(e),i.wo.Bo(n,t.key)}).next(function(){i._f=o})},xf.prototype.Lo=function(t){},xf.prototype.ys=function(t,e){var n=new bh(e,0),r=this._f.Mt(n);return Ih.resolve(e.isEqual(r&&r.key))},xf.prototype.Mo=function(t){return 0===this.Yo.length&&Fr(this._f.J(),"Document leak -- detected dangling mutation references when queue is empty."),Ih.resolve()},xf.prototype.If=function(t,e){var n=this.Ef(t);return Fr(0<=n&&n<this.Yo.length,"Batches must exist to be "+e),n},xf.prototype.Ef=function(t){return 0===this.Yo.length?0:t-this.Yo[0].batchId},xf.prototype.Tf=function(t){var e=this.Ef(t);if(e<0||e>=this.Yo.length)return null;var n=this.Yo[e];return Fr(n.batchId===t,"If found batch must match"),n},xf);function xf(t,e){this.vo=t,this.wo=e,this.Yo=[],this.yf=1,this.lastStreamToken=Ba.Si,this._f=new so(bh.Un)}function Lf(){}var Pf,Uf,Mf,qf,Vf=($f.prototype.js=function(t,e,n){Fr(!n.isEqual(Vi.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Af(e);return this.docs=this.docs.lt(r,{oa:e,size:s,readTime:n}),this.size+=s-o,this.vo.Ao(t,r.path.H())},$f.prototype.Ls=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},$f.prototype.Bs=function(t,e){var n=this.docs.get(e);return Ih.resolve(n?n.oa:null)},$f.prototype.getEntries=function(t,e){var n=this,r=ru();return e.forEach(function(t){var e=n.docs.get(t);r=r.lt(t,e?e.oa:null)}),Ih.resolve(r)},$f.prototype.ih=function(t,e,n){Fr(!e.bi(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=ou(),i=new Hi(e.path.child("")),o=this.docs.yt(i);o.At();){var s=o.Rt(),a=s.key,u=s.value,h=u.oa,c=u.readTime;if(!e.path.$(a.path))break;c.h(n)<=0||h instanceof Ls&&e.matches(h)&&(r=r.lt(h.key,h))}return Ih.resolve(r)},$f.prototype.Df=function(t,e){return Ih.forEach(this.docs,function(t){return e(t)})},$f.prototype.lc=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},$f.prototype.vc=function(t){return Ih.resolve(Vi.MIN)},$f.prototype.Oh=function(t){return new $f.wa(this)},$f.prototype.ma=function(t){return Ih.resolve(this.size)},$f.wa=(t(Zf,qf=Th),Zf.prototype.Qs=function(n){var r=this,i=[];return this.Os.forEach(function(t,e){e?i.push(r.pa.js(n,e,r.readTime)):r.pa.Ls(t)}),Ih.Ns(i)},Zf.prototype.Ms=function(t,e){return this.pa.Bs(t,e)},Zf.prototype.qs=function(t,e){return this.pa.getEntries(t,e)},Zf),$f),Gf=(Xf.prototype.Be=function(t,n){return this.Pf.forEach(function(t,e){return n(e)}),Ih.resolve()},Xf.prototype.Uh=function(t){return Ih.resolve(this.lastRemoteSnapshotVersion)},Xf.prototype.Yc=function(t){return Ih.resolve(this.Sf)},Xf.prototype.Zh=function(t){var e=this.Kc.after(this.highestTargetId);return this.highestTargetId=e,Ih.resolve(e)},Xf.prototype.zh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Sf&&(this.Sf=e),Ih.resolve()},Xf.prototype.Xc=function(t){this.Pf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.Sf&&(this.Sf=t.sequenceNumber)},Xf.prototype.tc=function(t,e){return Fr(!this.Pf.has(e.target),"Adding a target that already exists"),this.Xc(e),this.targetCount+=1,Ih.resolve()},Xf.prototype.Gh=function(t,e){return Fr(this.Pf.has(e.target),"Updating a non-existent target"),this.Xc(e),Ih.resolve()},Xf.prototype.Zc=function(t,e){return Fr(0<this.targetCount,"Removing a target from an empty cache"),Fr(this.Pf.has(e.target),"Removing a non-existent target from the cache"),this.Pf.delete(e.target),this.Cf.ps(e.targetId),this.targetCount-=1,Ih.resolve()},Xf.prototype.Qc=function(n,r,i){var o=this,s=0,a=[];return this.Pf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Pf.delete(t),a.push(o.ta(n,e.targetId)),s++)}),Ih.Ns(a).next(function(){return s})},Xf.prototype.ea=function(t){return Ih.resolve(this.targetCount)},Xf.prototype.$h=function(t,e){var n=this.Pf.get(e)||null;return Ih.resolve(n)},Xf.prototype.Xe=function(t,e){return Gr("Not yet implemented.")},Xf.prototype.Mh=function(e,t,n){this.Cf.ds(t,n);var r=this.persistence.wo,i=[];return r&&t.forEach(function(t){i.push(r.ls(e,t))}),Ih.Ns(i)},Xf.prototype.Bh=function(e,t,n){this.Cf.ms(t,n);var r=this.persistence.wo,i=[];return r&&t.forEach(function(t){i.push(r.vs(e,t))}),Ih.Ns(i)},Xf.prototype.ta=function(t,e){return this.Cf.ps(e),Ih.resolve()},Xf.prototype.ec=function(t,e){var n=this.Cf.bs(e);return Ih.resolve(n)},Xf.prototype.ys=function(t,e){return Ih.resolve(this.Cf.ys(e))},Xf),Ff=(Jf.kf=function(t,e){return new Jf(t,function(t){return new Hf(t,e)})},Jf.Of=function(t){return new Jf(t,function(t){return new Bf(t)})},Jf.prototype.shutdown=function(){return this.Sa=!1,Promise.resolve()},Object.defineProperty(Jf.prototype,"ph",{get:function(){return this.Sa},enumerable:!0,configurable:!0}),Jf.prototype.sc=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return[2,[this.clientId]]})})},Jf.prototype.za=function(t){return t(!0)},Jf.prototype.Ka=function(){},Jf.prototype.hc=function(t){},Jf.prototype.Rh=function(){return this.vo},Jf.prototype.bh=function(t){var e=this.Vf[t.v()];return e||(e=new Cf(this.vo,this.wo),this.Vf[t.v()]=e),e},Jf.prototype.Th=function(){return this.Ih},Jf.prototype._h=function(){return this.Jo},Jf.prototype.runTransaction=function(t,e,n){var r=this;Mr("MemoryPersistence","Starting transaction:",t);var i=new jf(this.Wa.next());return this.wo.Ff(),n(i).next(function(t){return r.wo.xf(i).next(function(){return t})}).Cs().then(function(t){return i.zs(),t})},Jf.prototype.jf=function(e,n){return Ih.ks((t=this.Vf,r=[],yi(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.ys(e,n)}}));var t,r},Jf),jf=(t(Qf,Mf=Ah),Qf),Bf=(Object.defineProperty(Kf.prototype,"Lf",{get:function(){if(this.Uf)return this.Uf;throw Gr("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),Kf.prototype.gh=function(t){this.lf=t},Kf.prototype.ls=function(t,e){return this.Lf.delete(e),Ih.resolve()},Kf.prototype.vs=function(t,e){return this.Lf.add(e),Ih.resolve()},Kf.prototype.Bo=function(t,e){return this.Lf.add(e),Ih.resolve()},Kf.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.Th();return r.ec(t,e.targetId).next(function(t){t.forEach(function(t){return n.Lf.add(t)})}).next(function(){return r.Zc(t,e)})},Kf.prototype.Ff=function(){this.Uf=new Set},Kf.prototype.xf=function(t){var n=this,r=this.persistence._h().Oh();return Ih.forEach(this.Lf,function(e){return n.Bf(t,e).next(function(t){t||r.Ls(e)})}).next(function(){return n.Uf=null,r.apply(t)})},Kf.prototype.Wh=function(t,e){var n=this;return this.Bf(t,e).next(function(t){t?n.Lf.delete(e):n.Lf.add(e)})},Kf.prototype.Nf=function(t){return 0},Kf.prototype.Bf=function(t,e){var n=this;return Ih.ks([function(){return n.persistence.Th().ys(t,e)},function(){return n.persistence.jf(t,e)},function(){return Ih.resolve(n.lf.ys(e))}])},Kf),Hf=(Wf.prototype.Ff=function(){},Wf.prototype.xf=function(t){return Ih.resolve()},Wf.prototype.Be=function(t,e){return this.persistence.Th().Be(t,e)},Wf.prototype.Bc=function(t){var n=this.qf(t);return this.persistence.Th().ea(t).next(function(e){return n.next(function(t){return e+t})})},Wf.prototype.qf=function(t){var e=0;return this.qc(t,function(t){e++}).next(function(){return e})},Wf.prototype.qc=function(n,r){var i=this;return Ih.forEach(this.Mf,function(t,e){return i.wf(n,t,e).next(function(t){return t?Ih.resolve():r(e)})})},Wf.prototype.gh=function(t){this.lf=t},Wf.prototype.Qc=function(t,e,n){return this.persistence.Th().Qc(t,e,n)},Wf.prototype.Gc=function(t,n){var r=this,i=0,e=this.persistence._h(),o=e.Oh();return e.Df(t,function(e){return r.wf(t,e,n).next(function(t){t||(i++,o.Ls(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},Wf.prototype.Bo=function(t,e){return this.Mf.set(e,t.qh),Ih.resolve()},Wf.prototype.removeTarget=function(t,e){var n=e.Fi(t.qh);return this.persistence.Th().Gh(t,n)},Wf.prototype.ls=function(t,e){return this.Mf.set(e,t.qh),Ih.resolve()},Wf.prototype.vs=function(t,e){return this.Mf.set(e,t.qh),Ih.resolve()},Wf.prototype.Wh=function(t,e){return this.Mf.set(e,t.qh),Ih.resolve()},Wf.prototype.Nf=function(t){var e=t.key.toString().length;return t instanceof Ls&&(e+=t.data().Cn()),e},Wf.prototype.wf=function(t,e,n){var r=this;return Ih.ks([function(){return r.persistence.jf(t,e)},function(){return Ih.resolve(r.lf.ys(e))},function(){return r.persistence.Th().ys(t,e)},function(){var t=r.Mf.get(e);return Ih.resolve(void 0!==t&&n<t)}])},Wf.prototype.Wc=function(t){return this.persistence._h().ma(t)},Wf),zf=(Yf.prototype.reset=function(){this.zf=0},Yf.prototype.Jf=function(){this.zf=this.Wf},Yf.prototype.Yf=function(t){var e=this;this.cancel();var n=Math.floor(this.zf+this.Xf()),r=Math.max(0,Date.now()-this.Hf),i=Math.max(0,n-r);0<this.zf&&Mr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.zf+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Kf=this.Da.Xu(this.Cu,i,function(){return e.Hf=Date.now(),t()}),this.zf*=this.Gf,this.zf<this.Qf&&(this.zf=this.Qf),this.zf>this.Wf&&(this.zf=this.Wf)},Yf.prototype.cancel=function(){null!==this.Kf&&(this.Kf.cancel(),this.Kf=null)},Yf.prototype.Xf=function(){return(Math.random()-.5)*this.zf},Yf);function Yf(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Da=t,this.Cu=e,this.Qf=n,this.Gf=r,this.Wf=i,this.zf=0,this.Kf=null,this.Hf=Date.now(),this.reset()}function Wf(t,e){this.persistence=t,this.lf=null,this.Mf=new Eh(function(t){return ph(t.path)}),this.kc=new yc(this,e)}function Kf(t){this.persistence=t,this.lf=null,this.Uf=null}function Qf(t){var e=Mf.call(this)||this;return e.qh=t,e}function Jf(t,e){var n=this;this.clientId=t,this.Vf={},this.Wa=new nh(0),this.Sa=!1,this.Sa=!0,this.wo=e(this),this.Ih=new Gf(this),this.vo=new Lc,this.Jo=new Vf(this.vo,function(t){return n.wo.Nf(t)})}function Xf(t){this.persistence=t,this.Pf=new Eh(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Vi.MIN,this.highestTargetId=0,this.Sf=0,this.Cf=new wh,this.targetCount=0,this.Kc=tc.Ko()}function $f(t,e){this.vo=t,this.Af=e,this.docs=new zi(Hi.G),this.size=0}function Zf(t){var e=qf.call(this)||this;return e.pa=t,e}(Uf=Pf=Pf||{})[Uf.$f=0]="__PRIVATE_Initial",Uf[Uf.Zf=1]="__PRIVATE_Starting",Uf[Uf.tl=2]="__PRIVATE_Open",Uf[Uf.Error=3]="Error",Uf[Uf.nl=4]="__PRIVATE_Backoff";var tl,el,nl=(ll.prototype.ol=function(){return this.state===Pf.Zf||this.state===Pf.tl||this.state===Pf.nl},ll.prototype.hl=function(){return this.state===Pf.tl},ll.prototype.start=function(){this.state!==Pf.Error?(Fr(this.state===Pf.$f,"Already started"),this.auth()):this.cl()},ll.prototype.stop=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.ol()?[4,this.close(Pf.$f)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},ll.prototype.al=function(){Fr(!this.ol(),"Can only inhibit backoff in a stopped state"),this.state=Pf.$f,this.sl.reset()},ll.prototype.fl=function(){var t=this;this.hl()&&null===this.ul&&(this.ul=this.Da.Xu(this.il,6e4,function(){return t.ll()}))},ll.prototype.dl=function(t){this.vl(),this.stream.send(t)},ll.prototype.ll=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.hl()?[2,this.close(Pf.$f)]:[2]})})},ll.prototype.vl=function(){this.ul&&(this.ul.cancel(),this.ul=null)},ll.prototype.close=function(e,n){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return Fr(this.ol(),"Only started streams should be closed."),Fr(e===Pf.Error||ea(n),"Can't provide an error when not in an error state."),this.vl(),this.sl.cancel(),this.rl++,e!==Pf.Error?this.sl.reset():n&&n.code===Zr.RESOURCE_EXHAUSTED?(qr(n.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.sl.Jf()):n&&n.code===Zr.UNAUTHENTICATED&&this.el.I(),null!==this.stream&&(this.wl(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.ml(n)];case 1:return t.sent(),[2]}})})},ll.prototype.wl=function(){},ll.prototype.auth=function(){var n=this;Fr(this.state===Pf.$f,"Must be in initial state to auth"),this.state=Pf.Zf;var t=this.pl(this.rl),e=this.rl;this.el.getToken().then(function(t){n.rl===e&&n.gl(t)},function(e){t(function(){var t=new ti(Zr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.bl(t)})})},ll.prototype.gl=function(t){var e=this;Fr(this.state===Pf.Zf,"Trying to start stream in a non-starting state");var n=this.pl(this.rl);this.stream=this.yl(t),this.stream._l(function(){n(function(){return Fr(e.state===Pf.Zf,"Expected stream to be in state Starting, but was "+e.state),e.state=Pf.tl,e.listener._l()})}),this.stream.ml(function(t){n(function(){return e.bl(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},ll.prototype.cl=function(){var t=this;Fr(this.state===Pf.Error,"Should only perform backoff when in Error state"),this.state=Pf.nl,this.sl.Yf(function(){return p(t,void 0,void 0,function(){return y(this,function(t){return Fr(this.state===Pf.nl,"Backoff elapsed but state is now: "+this.state),this.state=Pf.$f,this.start(),Fr(this.ol(),"PersistentStream should have started"),[2]})})})},ll.prototype.bl=function(t){return Fr(this.ol(),"Can't handle server close on non-started stream"),Mr("PersistentStream","close with error: "+t),this.stream=null,this.close(Pf.Error,t)},ll.prototype.pl=function(e){var n=this;return function(t){n.Da.Uu(function(){return n.rl===e?t():(Mr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},ll),rl=(t(fl,el=nl),fl.prototype.yl=function(t){return this.connection.Il("Listen",t)},fl.prototype.onMessage=function(t){this.sl.reset();var e=this.serializer.Vr(t),n=this.serializer.kr(t);return this.listener.Tl(e,n)},fl.prototype.watch=function(t){var e={};e.database=this.serializer.mr,e.addTarget=this.serializer.ai(t);var n=this.serializer.tu(t);n&&(e.labels=n),this.dl(e)},fl.prototype.El=function(t){var e={};e.database=this.serializer.mr,e.removeTarget=t,this.dl(e)},fl),il=(t(cl,tl=nl),Object.defineProperty(cl.prototype,"Al",{get:function(){return this.Rl},enumerable:!0,configurable:!0}),cl.prototype.start=function(){this.Rl=!1,tl.prototype.start.call(this)},cl.prototype.wl=function(){this.Rl&&this.Dl([])},cl.prototype.yl=function(t){return this.connection.Il("Write",t)},cl.prototype.onMessage=function(t){if(Fr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.rr(t.streamToken),this.Rl){this.sl.reset();var e=this.serializer.Qr(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Pl(n,e)}return Fr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.Rl=!0,this.listener.Sl()},cl.prototype.Cl=function(){Fr(this.hl(),"Writing handshake requires an opened stream"),Fr(!this.Rl,"Handshake already completed");var t={};t.database=this.serializer.mr,this.dl(t)},cl.prototype.Dl=function(t){var e=this;Fr(this.hl(),"Writing mutations requires an opened stream"),Fr(this.Rl,"Handshake must be complete before writing mutations"),Fr(0<this.lastStreamToken.Cn(),"Trying to write mutation without a token");var n={streamToken:this.serializer.er(this.lastStreamToken),writes:t.map(function(t){return e.serializer.Or(t)})};this.dl(n)},cl),ol=(hl.prototype.Vl=function(t){return new il(this.Da,this.connection,this.credentials,this.serializer,t)},hl.prototype.Nl=function(t){return new rl(this.Da,this.connection,this.credentials,this.serializer,t)},hl.prototype.commit=function(t){var e=this,n={database:this.serializer.mr,writes:t.map(function(t){return e.serializer.Or(t)})};return this.kl("Commit",n).then(function(t){return e.serializer.Qr(t.writeResults,t.commitTime)})},hl.prototype.lookup=function(e){var i=this,t={database:this.serializer.mr,documents:e.map(function(t){return i.serializer.ar(t)})};return this.Ol("BatchGetDocuments",t).then(function(t){var n=nu();t.forEach(function(t){var e=i.serializer.Pr(t);n=n.lt(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Fr(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},hl.prototype.kl=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.kl(e,n,t)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&r.credentials.I(),t})},hl.prototype.Ol=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.Ol(e,n,t)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&r.credentials.I(),t})},hl),sl=(ul.documentId=function(){return ul.xl},ul.prototype.isEqual=function(t){if(!(t instanceof ul))throw Oi("isEqual","FieldPath",1,t);return this.Fl.isEqual(t.Fl)},ul.xl=new ul(Bi.st().nt()),ul),al=new RegExp("[~\\*/\\[\\]]");function ul(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new ti(Zr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Li(1,"element")+".")}();for(var n=0;n<t.length;++n)if(Ei("FieldPath","string",n,t[n]),0===t[n].length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Fl=new Bi(t)}function hl(t,e,n,r){this.Da=t,this.connection=e,this.credentials=n,this.serializer=r}function cl(t,e,n,r,i){var o=tl.call(this,t,$u.Eu,$u.Tu,e,n,i)||this;return o.serializer=r,o.Rl=!1,o.lastStreamToken=Ba.Si,o}function fl(t,e,n,r,i){var o=el.call(this,t,$u.Iu,$u._u,e,n,i)||this;return o.serializer=r,o}function ll(t,e,n,r,i,o){this.Da=t,this.il=n,this.connection=r,this.el=i,this.listener=o,this.state=Pf.$f,this.rl=0,this.ul=null,this.stream=null,this.sl=new zf(t,e)}var pl,dl,yl,vl,ml,gl,wl,bl=(Ml.delete=function(){return mi("FieldValue.delete",arguments),El.instance},Ml.serverTimestamp=function(){return mi("FieldValue.serverTimestamp",arguments),Il.instance},Ml.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wi("FieldValue.arrayUnion",arguments,1),new Tl(t)},Ml.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wi("FieldValue.arrayRemove",arguments,1),new Nl(t)},Ml.increment=function(t){return Ei("FieldValue.increment","number",1,t),gi("FieldValue.increment",arguments,1),new Al(t)},Ml.prototype.isEqual=function(t){return this===t},Ml),El=(t(Ul,wl=bl),Ul.instance=new Ul,Ul),Il=(t(Pl,gl=bl),Pl.instance=new Pl,Pl),Tl=(t(Ll,ml=bl),Ll),Nl=(t(xl,vl=bl),xl),Al=(t(Cl,yl=bl),Cl),Sl=Ku(bl,"Use FieldValue.<field>() instead."),kl=/^__.*__$/,Dl=(Ol.prototype.Bl=function(t,e){var n=[];return null!==this.on?n.push(new Vo(t,this.data,this.on,e)):n.push(new qo(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Go(t,this.fieldTransforms)),n},Ol),Rl=(_l.prototype.Bl=function(t,e){var n=[new Vo(t,this.data,this.on,e)];return 0<this.fieldTransforms.length&&n.push(new Go(t,this.fieldTransforms)),n},_l);function _l(t,e,n){this.data=t,this.on=e,this.fieldTransforms=n}function Ol(t,e,n){this.data=t,this.on=e,this.fieldTransforms=n}function Cl(t){var e=yl.call(this,"FieldValue.increment")||this;return e.Ll=t,e}function xl(t){var e=vl.call(this,"FieldValue.arrayRemove")||this;return e.Ul=t,e}function Ll(t){var e=ml.call(this,"FieldValue.arrayUnion")||this;return e.Ul=t,e}function Pl(){return gl.call(this,"FieldValue.serverTimestamp")||this}function Ul(){return wl.call(this,"FieldValue.delete")||this}function Ml(t){this.jl=t}function ql(t){switch(t){case pl.Set:case pl.Ml:case pl.ql:return!0;case pl.Ql:case pl.Gl:return!1;default:throw Gr("Unexpected case for UserDataSource: "+t)}}(dl=pl=pl||{})[dl.Set=0]="Set",dl[dl.ql=1]="__PRIVATE_Update",dl[dl.Ml=2]="__PRIVATE_MergeSet",dl[dl.Ql=3]="__PRIVATE_Argument",dl[dl.Gl=4]="__PRIVATE_ArrayArgument";var Vl=(Bl.prototype.Hl=function(t){var e=null==this.path?null:this.path.child(t),n=new Bl(this.Wl,this.methodName,e,!1,this.fieldTransforms,this.on);return n.Jl(t),n},Bl.prototype.Yl=function(t){var e=null==this.path?null:this.path.child(t),n=new Bl(this.Wl,this.methodName,e,!1,this.fieldTransforms,this.on);return n.Kl(),n},Bl.prototype.Xl=function(t){return new Bl(this.Wl,this.methodName,null,!0,this.fieldTransforms,this.on)},Bl.prototype.$l=function(t){var e=null===this.path||this.path.J()?"":" (found in field "+this.path.toString()+")";return new ti(Zr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},Bl.prototype.contains=function(e){return void 0!==this.on.find(function(t){return e.$(t)})||void 0!==this.fieldTransforms.find(function(t){return e.$(t.field)})},Bl.prototype.Kl=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.Jl(this.path.get(t))},Bl.prototype.Jl=function(t){if(0===t.length)throw this.$l("Document fields must not be empty");if(ql(this.Wl)&&kl.test(t))throw this.$l('Document fields cannot begin and end with "__"')},Bl),Gl=function(t,e){this.s=t,this.key=e},Fl=(jl.prototype.td=function(t,e){var n=new Vl(pl.Set,t,Bi.et);zl("Data must be an object, but it was:",n,e);var r=this.nd(e,n);return new Dl(r,null,n.fieldTransforms)},jl.prototype.ed=function(t,e,n){var r=new Vl(pl.Ml,t,Bi.et);zl("Data must be an object, but it was:",r,e);var i,o,s=this.nd(e,r);if(n){for(var a=new so(Bi.G),u=0,h=n;u<h.length;u++){var c=h[u],f=void 0;if(c instanceof sl)f=c.Fl;else{if("string"!=typeof c)throw Gr("Expected stringOrFieldPath to be a string or a FieldPath");f=Wl(t,c)}if(!r.contains(f))throw new ti(Zr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");a=a.add(f)}i=To.Jt(a),o=r.fieldTransforms.filter(function(t){return i.Xt(t.field)})}else i=To.Yt(r.on),o=r.fieldTransforms;return new Dl(s,i,o)},jl.prototype.rd=function(o,t){var s=this,a=new Vl(pl.ql,o,Bi.et);zl("Data must be an object, but it was:",a,t);var u=new so(Bi.G),h=Os.EMPTY;yi(t,function(t,e){var n=Wl(o,t),r=a.Yl(n);if((e=s.ud(e,r))instanceof El)u=u.add(n);else{var i=s.nd(e,r);null!=i&&(u=u.add(n),h=h.set(n,i))}});var e=To.Jt(u);return new Rl(h,e,a.fieldTransforms)},jl.prototype.sd=function(t,e,n,r){var i=new Vl(pl.ql,t,Bi.et),o=[Yl(t,e)],s=[n];if(r.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(Yl(t,r[a])),s.push(r[a+1]);var u=new so(Bi.G),h=Os.EMPTY;for(a=0;a<o.length;++a){var c=o[a],f=i.Yl(c),l=this.ud(s[a],f);if(l instanceof El)u=u.add(c);else{var p=this.nd(l,f);null!=p&&(u=u.add(c),h=h.set(c,p))}}var d=To.Jt(u);return new Rl(h,d,i.fieldTransforms)},jl.prototype.od=function(t,e,n){void 0===n&&(n=!1);var r=new Vl(n?pl.Gl:pl.Ql,t,Bi.et),i=this.nd(e,r);return Fr(null!=i,"Parsed data should not be null."),Fr(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},jl.prototype.ud=function(t,e){try{return this.Zl(t)}catch(t){var n=Kl(t);throw e.$l(n)}},jl.prototype.nd=function(t,e){if(Hl(t=this.ud(t,e)))return zl("Unsupported field value:",e,t),this.hd(t,e);if(t instanceof bl)return this.ad(t,e),null;if(e.path&&e.on.push(e.path),t instanceof Array){if(e.zl&&e.Wl!==pl.Gl)throw e.$l("Nested arrays are not supported");return this.fd(t,e)}return this.ld(t,e)},jl.prototype.hd=function(t,r){var i=this,o=new zi(Hr);return vi(t)?r.path&&0<r.path.length&&r.on.push(r.path):yi(t,function(t,e){var n=i.nd(e,r.Hl(t));null!=n&&(o=o.lt(t,n))}),new Os(o)},jl.prototype.fd=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.nd(s,e.Xl(r));null==a&&(a=es.Vn),n.push(a),r++}return new Cs(n)},jl.prototype.ad=function(t,e){if(!ql(e.Wl))throw e.$l(t.jl+"() can only be used with update() and set()");if(null===e.path)throw e.$l(t.jl+"() is not currently supported inside arrays");if(t instanceof El){if(e.Wl!==pl.Ml)throw e.Wl===pl.ql?(Fr(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.$l("FieldValue.delete() can only appear at the top level of your update data")):e.$l("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.on.push(e.path)}else if(t instanceof Il)e.fieldTransforms.push(new No(e.path,uo.instance));else if(t instanceof Tl){var n=this.dd(t.jl,t.Ul),r=new ho(n);e.fieldTransforms.push(new No(e.path,r))}else if(t instanceof Nl){n=this.dd(t.jl,t.Ul);var i=new co(n);e.fieldTransforms.push(new No(e.path,i))}else if(t instanceof Al){var o=this.od("FieldValue.increment",t.Ll),s=new fo(o);e.fieldTransforms.push(new No(e.path,s))}else Gr("Unknown FieldValue type: "+t)},jl.prototype.ld=function(t,e){if(null===t)return es.Vn;if("number"==typeof t)return na(t)?new Ts(t):new Ns(t);if("boolean"==typeof t)return ns.of(t);if("string"==typeof t)return new As(t);if(t instanceof Date)return new Ss(qi.fromDate(t));if(t instanceof qi)return new Ss(new qi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Mi)return new _s(t);if(t instanceof th)return new Ds(t);if(t instanceof Gl)return new Rs(t.s,t.key);throw e.$l("Unsupported field value: "+Di(t))},jl.prototype.dd=function(r,t){var i=this;return t.map(function(t,e){var n=new Vl(pl.Ql,r,Bi.et);return i.nd(t,n.Xl(e))})},jl);function jl(t){this.Zl=t}function Bl(t,e,n,r,i,o){this.Wl=t,this.methodName=e,this.path=n,this.zl=r,void 0===i&&this.Kl(),this.zl=void 0!==r&&r,this.fieldTransforms=i||[],this.on=o||[]}function Hl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof qi||t instanceof Mi||t instanceof th||t instanceof Gl||t instanceof bl)}function zl(t,e,n){if(!Hl(n)||!ki(n)){var r=Di(n);throw"an object"===r?e.$l(t+" a custom object"):e.$l(t+" "+r)}}function Yl(t,e){if(e instanceof sl)return e.Fl;if("string"==typeof e)return Wl(t,e);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Wl(e,t){try{return function(e){if(0<=e.search(al))throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(sl.bind.apply(sl,s([void 0],e.split("."))))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t).Fl}catch(t){var n=Kl(t);throw new ti(Zr.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function Kl(t){return t instanceof Error?t.message:t.toString()}var Ql=(np.prototype.lookup=function(r){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.bd(),0<this.mutations.length)throw new ti(Zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.vd.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof Ps||t instanceof Ls?n.yd(t):Gr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},np.prototype.set=function(t,e){this.write(e.Bl(t,this.rn(t))),this.gd.add(t)},np.prototype.update=function(t,e){try{this.write(e.Bl(t,this._d(t)))}catch(t){this.pd=t}this.gd.add(t)},np.prototype.delete=function(t){this.write([new Fo(t,this.rn(t))]),this.gd.add(t)},np.prototype.commit=function(){return p(this,void 0,void 0,function(){var e,n=this;return y(this,function(t){switch(t.label){case 0:if(this.bd(),this.pd)throw this.pd;return e=this.wd,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new jo(t,n.rn(t)))}),[4,this.vd.commit(this.mutations)];case 1:return t.sent(),this.md=!0,[2]}})})},np.prototype.yd=function(t){var e;if(t instanceof Ls)e=t.version;else{if(!(t instanceof Ps))throw Gr("Document in a transaction was a "+t.constructor.name);e=Vi.B()}var n=this.wd.get(t.key);if(null!==n){if(!e.isEqual(n))throw new ti(Zr.ABORTED,"Document version changed between two reads.")}else this.wd=this.wd.lt(t.key,e)},np.prototype.rn=function(t){var e=this.wd.get(t);return!this.gd.has(t)&&e?Uo.updateTime(e):Uo.NONE},np.prototype._d=function(t){var e=this.wd.get(t);if(this.gd.has(t)||!e)return Uo.exists(!0);if(e.isEqual(Vi.B()))throw new ti(Zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Uo.updateTime(e)},np.prototype.write=function(t){this.bd(),this.mutations=this.mutations.concat(t)},np.prototype.bd=function(){Fr(!this.md,"A transaction object cannot be used after its update callback has been invoked.")},np),Jl=(ep.prototype.Ad=function(){var t=this;0===this.Td&&(this.Dd(aa.Ti),Fr(null===this.Ed,"onlineStateTimer shouldn't be started yet"),this.Ed=this.Su.Xu($u.Ru,1e4,function(){return t.Ed=null,Fr(t.state===aa.Ti,"Timer should be canceled if we transitioned to a different state."),t.Pd("Backend didn't respond within 10 seconds."),t.Dd(aa.Ri),Promise.resolve()}))},ep.prototype.Sd=function(t){this.state===aa.Ei?(this.Dd(aa.Ti),Fr(0===this.Td,"watchStreamFailures must be 0"),Fr(null===this.Ed,"onlineStateTimer must be null")):(this.Td++,1<=this.Td&&(this.Cd(),this.Pd("Connection failed 1 times. Most recent error: "+t.toString()),this.Dd(aa.Ri)))},ep.prototype.set=function(t){this.Cd(),this.Td=0,t===aa.Ei&&(this.Rd=!1),this.Dd(t)},ep.prototype.Dd=function(t){t!==this.state&&(this.state=t,this.Id(t))},ep.prototype.Pd=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Rd?(qr(e),this.Rd=!1):Mr("OnlineStateTracker",e)},ep.prototype.Cd=function(){null!==this.Ed&&(this.Ed.cancel(),this.Ed=null)},ep),Xl="RemoteStore",$l=(tp.prototype.start=function(){return this.enableNetwork()},tp.prototype.enableNetwork=function(){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.xd()?(e=this.Qd,[4,this.Oc.Io()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.Kd()?this.Hd():this.Ud.set(aa.Ti),[4,this.Jd()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},tp.prototype.disableNetwork=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Yd()];case 1:return t.sent(),this.Ud.set(aa.Ri),[2]}})})},tp.prototype.Yd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.Qd.stop()];case 1:return t.sent(),[4,this.Ld.stop()];case 2:return t.sent(),0<this.Vd.length&&(Mr(Xl,"Stopping write stream with "+this.Vd.length+" pending writes"),this.Vd=[]),this.Xd(),[2]}})})},tp.prototype.shutdown=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return Mr(Xl,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.Yd()];case 1:return t.sent(),this.Od.shutdown(),this.Ud.set(aa.Ti),[2]}})})},tp.prototype.listen=function(t){li(this.Nd,t.targetId)||(this.Nd[t.targetId]=t,this.Kd()?this.Hd():this.Ld.hl()&&this.$d(t))},tp.prototype.Zd=function(t){Fr(li(this.Nd,t),"unlisten called on target no currently watched: "+t),delete this.Nd[t],this.Ld.hl()&&this.tv(t),vi(this.Nd)&&(this.Ld.hl()?this.Ld.fl():this.xd()&&this.Ud.set(aa.Ti))},tp.prototype.Xe=function(t){return this.Nd[t]||null},tp.prototype.Ye=function(t){return this.nv.Ye(t)},tp.prototype.$d=function(t){this.kd.Pe(t.targetId),this.Ld.watch(t)},tp.prototype.tv=function(t){this.kd.Pe(t),this.Ld.El(t)},tp.prototype.Hd=function(){Fr(this.Kd(),"startWatchStream() called when shouldStartWatchStream() is false."),this.kd=new Cu(this),this.Ld.start(),this.Ud.Ad()},tp.prototype.Kd=function(){return this.xd()&&!this.Ld.ol()&&!vi(this.Nd)},tp.prototype.xd=function(){return this.isPrimary&&this.networkEnabled},tp.prototype.Xd=function(){this.kd=null},tp.prototype.Bd=function(){return p(this,void 0,void 0,function(){var n=this;return y(this,function(t){return di(this.Nd,function(t,e){n.$d(e)}),[2]})})},tp.prototype.Md=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return void 0===e&&Fr(!this.Kd(),"Watch stream was stopped gracefully while still needed."),this.Xd(),this.Kd()?(this.Ud.Sd(e),this.Hd()):this.Ud.set(aa.Ti),[2]})})},tp.prototype.qd=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Ud.set(aa.Ei),n instanceof _u&&n.state===bu.qi&&n.cause?[2,this.iv(n)]:(n instanceof gu?this.kd.xe(n):n instanceof wu?this.kd.Ge(n):(Fr(n instanceof _u,"Expected watchChange to be an instance of WatchTargetChange"),this.kd.Le(n)),r.isEqual(Vi.MIN)?[3,3]:[4,this.Oc.Uh()]);case 1:return e=t.sent(),0<=r.h(e)?[4,this.ev(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},tp.prototype.ev=function(r){var i=this;Fr(!r.isEqual(Vi.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.kd.Ke(r);return di(t.te,function(t,e){if(0<e.resumeToken.Cn()){var n=i.Nd[t];n&&(i.Nd[t]=n.xi(e.resumeToken,r))}}),t.ne.forEach(function(t){var e=i.Nd[t];if(e){i.Nd[t]=e.xi(Ba.Si,e.Oi),i.tv(t);var n=new Qa(e.target,t,Fa.Vi,e.sequenceNumber);i.$d(n)}}),this.nv.Lh(t)},tp.prototype.iv=function(t){var n=this;Fr(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return p(n,void 0,void 0,function(){return y(this,function(t){return li(this.Nd,e)?(delete this.Nd[e],this.kd.removeTarget(e),[2,this.nv.rv(e,r)]):[2]})})})}),i},tp.prototype.Jd=function(){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.uv()?(e=0<this.Vd.length?this.Vd[this.Vd.length-1].batchId:-1,[4,this.Oc.Jh(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.Vd.length&&this.Qd.fl(),[3,4]);case 2:return this.sv(n),[4,this.Jd()];case 3:t.sent(),t.label=4;case 4:return this.ov()&&this.hv(),[2]}})})},tp.prototype.uv=function(){return this.xd()&&this.Vd.length<10},tp.prototype.cv=function(){return this.Vd.length},tp.prototype.sv=function(t){Fr(this.uv(),"addToWritePipeline called when pipeline is full"),this.Vd.push(t),this.Qd.hl()&&this.Qd.Al&&this.Qd.Dl(t.mutations)},tp.prototype.ov=function(){return this.xd()&&!this.Qd.ol()&&0<this.Vd.length},tp.prototype.hv=function(){Fr(this.ov(),"startWriteStream() called when shouldStartWriteStream() is false."),this.Qd.start()},tp.prototype.Gd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.Qd.Cl(),[2]})})},tp.prototype.zd=function(){var r=this;return this.Oc.To(this.Qd.lastStreamToken).then(function(){for(var t=0,e=r.Vd;t<e.length;t++){var n=e[t];r.Qd.Dl(n.mutations)}}).catch(hc)},tp.prototype.Pl=function(t,e){var n=this;Fr(0<this.Vd.length,"Got result for empty write pipeline");var r=this.Vd.shift(),i=gh.from(r,t,e,this.Qd.lastStreamToken);return this.nv.av(i).then(function(){return n.Jd()})},tp.prototype.Wd=function(n){return p(this,void 0,void 0,function(){var e=this;return y(this,function(t){return void 0===n&&Fr(!this.ov(),"Write stream was stopped gracefully while still needed."),n&&0<this.Vd.length?[2,(this.Qd.Al?this.fv(n):this.lv(n)).then(function(){e.ov()&&e.hv()})]:[2]})})},tp.prototype.lv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return Za(e.code)?(Mr(Xl,"RemoteStore error before completed handshake; resetting stream token: ",this.Qd.lastStreamToken),this.Qd.lastStreamToken=Ba.Si,[2,this.Oc.To(Ba.Si).catch(hc)]):[2]})})},tp.prototype.fv=function(i){return p(this,void 0,void 0,function(){var n,r=this;return y(this,function(t){return Za(e=i.code)&&e!==Zr.ABORTED?(n=this.Vd.shift(),this.Qd.al(),[2,this.nv.dv(n.batchId,i).then(function(){return r.Jd()})]):[2];var e})})},tp.prototype.vv=function(){return new Ql(this.vd)},tp.prototype.jd=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.Yd()];case 1:return t.sent(),this.Ud.set(aa.Ti),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},tp.prototype.wv=function(){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.xd()?(Mr(Xl,"RemoteStore restarting streams for new credential"),[4,this.jd()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},tp.prototype.mv=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.Yd()];case 3:t.sent(),this.Ud.set(aa.Ti),t.label=4;case 4:return[2]}})})},tp),Zl="firestore_clients";function tp(t,e,n,r,i){var o=this;this.Oc=t,this.vd=e,this.Vd=[],this.Nd={},this.kd=null,this.networkEnabled=!1,this.isPrimary=!1,this.Od=i,this.Od.Fd(function(t){n.Uu(function(){return p(o,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.xd()?(Mr(Xl,"Restarting streams for network reachability change."),[4,this.jd()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Ud=new Jl(n,r),this.Ld=this.vd.Nl({_l:this.Bd.bind(this),ml:this.Md.bind(this),Tl:this.qd.bind(this)}),this.Qd=this.vd.Vl({_l:this.Gd.bind(this),ml:this.Wd.bind(this),Sl:this.zd.bind(this),Pl:this.Pl.bind(this)})}function ep(t,e){this.Su=t,this.Id=e,this.state=aa.Ti,this.Td=0,this.Ed=null,this.Rd=!0}function np(t){this.vd=t,this.wd=au(),this.mutations=[],this.md=!1,this.pd=null,this.gd=new Set}function rp(t,e){return Fr(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),Zl+"_"+t+"_"+e}var ip="firestore_mutations";function op(t,e,n){var r=ip+"_"+t+"_"+n;return e.l()&&(r+="_"+e.uid),r}var sp="firestore_targets";function ap(t,e){return sp+"_"+t+"_"+e}var up="SharedClientState",hp=(bp.pv=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new ti(r.error.code,r.error.message)),i?new bp(t,e,r.state,o):(qr(up,"Failed to parse mutation state for ID '"+e+"': "+n),null)},bp.prototype.gv=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},bp),cp=(wp.pv=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new ti(n.error.code,n.error.message)),r?new wp(t,n.state,i):(qr(up,"Failed to parse target state for ID '"+t+"': "+e),null)},wp.prototype.gv=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},wp),fp=(gp.pv=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=fu(),o=0;r&&o<n.activeTargetIds.length;++o)r=na(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new gp(t,i):(qr(up,"Failed to parse client data for instance '"+t+"': "+e),null)},gp),lp=(mp.pv=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in aa&&"string"==typeof e.clientId?new mp(e.clientId,aa[e.onlineState]):(qr(up,"Failed to parse online state: "+t),null)},mp),pp=(vp.prototype.bv=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},vp.prototype.yv=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},vp.prototype.gv=function(){var t={activeTargetIds:this.activeTargetIds.tt(),updateTimeMs:Date.now()};return JSON.stringify(t)},vp),dp=(yp.Js=function(t){return!(!t.window||null==t.window.localStorage)},yp.prototype.start=function(){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l=this;return y(this,function(t){switch(t.label){case 0:return Fr(!this.ph,"WebStorageSharedClientState already started"),Fr(null!==this.nv,"syncEngine property must be set before calling start()"),Fr(null!==this.Id,"onlineStateHandler property must be set before calling start()"),[4,this.nv.sc()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this._v&&(o=this.getItem(rp(this.persistenceKey,i)))&&(s=fp.pv(i,o))&&(this.Iv[s.clientId]=s);for(this.Nv(),(a=this.storage.getItem(this.Vv))&&(u=this.kv(a))&&this.Ov(u),h=0,c=this.Rv;h<c.length;h++)f=c[h],this.Ev(f);return this.Rv=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.ph=!0,[2]}})})},yp.prototype.gu=function(t){this.setItem(this.Dv,JSON.stringify(t))},yp.prototype.Fv=function(){var n=fu();return yi(this.Iv,function(t,e){n=n.qt(e.activeTargetIds)}),n},yp.prototype.xv=function(t){for(var e in this.Iv)if(this.Iv.hasOwnProperty(e)&&this.Iv[e].activeTargetIds.has(t))return!0;return!1},yp.prototype.jv=function(t){this.Uv(t,"pending")},yp.prototype.Lv=function(t,e,n){this.Uv(t,e,n),this.Bv(t)},yp.prototype.Mv=function(t){var e="not-current";if(this.xv(t)){var n=this.storage.getItem(ap(this.persistenceKey,t));if(n){var r=cp.pv(t,n);r&&(e=r.state)}}return this.qv.bv(t),this.Nv(),e},yp.prototype.Qv=function(t){this.qv.yv(t),this.Nv()},yp.prototype.Gv=function(t){return this.qv.activeTargetIds.has(t)},yp.prototype.Wv=function(t){this.removeItem(ap(this.persistenceKey,t))},yp.prototype.zv=function(t,e,n){this.Kv(t,e,n)},yp.prototype.Ph=function(t,e,n){var r=this;e.forEach(function(t){r.Bv(t)}),this.currentUser=t,n.forEach(function(t){r.jv(t)})},yp.prototype.Hv=function(t){this.Jv(t)},yp.prototype.shutdown=function(){this.ph&&(this.platform.window.removeEventListener("storage",this.Tv),this.removeItem(this.Av),this.ph=!1)},yp.prototype.getItem=function(t){var e=this.storage.getItem(t);return Mr(up,"READ",t,e),e},yp.prototype.setItem=function(t,e){Mr(up,"SET",t,e),this.storage.setItem(t,e)},yp.prototype.removeItem=function(t){Mr(up,"REMOVE",t),this.storage.removeItem(t)},yp.prototype.Ev=function(a){var t=this;if(a.storageArea===this.storage){if(Mr(up,"EVENT",a.key,a.newValue),a.key===this.Av)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Da.Uu(function(){return p(t,void 0,void 0,function(){var e,n,r,i,o,s;return y(this,function(t){if(!this.ph)return this.Rv.push(a),[2];if(null===a.key)return[2];if(this.Pv.test(a.key)){if(null==a.newValue)return n=this.Yv(a.key),[2,this.Xv(n,null)];if(e=this.$v(a.key,a.newValue))return[2,this.Xv(e.clientId,e)]}else if(this.Sv.test(a.key)){if(null!==a.newValue&&(r=this.Zv(a.key,a.newValue)))return[2,this.tw(r)]}else if(this.Cv.test(a.key)){if(null!==a.newValue&&(i=this.nw(a.key,a.newValue)))return[2,this.iw(i)]}else if(a.key===this.Vv){if(null!==a.newValue&&(o=this.kv(a.newValue)))return[2,this.Ov(o)]}else a.key===this.Dv&&(Fr(!!this.wu,"Missing sequenceNumberHandler"),(s=function(t){var e=nh.bu;if(null!=t)try{var n=JSON.parse(t);Fr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){qr(up,"Failed to read sequence number from WebStorage",t)}return e}(a.newValue))!==nh.bu&&this.wu(s));return[2]})})})}},Object.defineProperty(yp.prototype,"qv",{get:function(){return this.Iv[this._v]},enumerable:!0,configurable:!0}),yp.prototype.Nv=function(){this.setItem(this.Av,this.qv.gv())},yp.prototype.Uv=function(t,e,n){var r=new hp(this.currentUser,t,e,n),i=op(this.persistenceKey,this.currentUser,t);this.setItem(i,r.gv())},yp.prototype.Bv=function(t){var e=op(this.persistenceKey,this.currentUser,t);this.removeItem(e)},yp.prototype.Jv=function(t){var e={clientId:this._v,onlineState:aa[t]};this.storage.setItem(this.Vv,JSON.stringify(e))},yp.prototype.Kv=function(t,e,n){var r=ap(this.persistenceKey,t),i=new cp(t,e,n);this.setItem(r,i.gv())},yp.prototype.Yv=function(t){var e=this.Pv.exec(t);return e?e[1]:null},yp.prototype.$v=function(t,e){var n=this.Yv(t);return Fr(null!==n,"Cannot parse client state key '"+t+"'"),fp.pv(n,e)},yp.prototype.Zv=function(t,e){var n=this.Sv.exec(t);Fr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return hp.pv(new $r(i),r,e)},yp.prototype.nw=function(t,e){var n=this.Cv.exec(t);Fr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return cp.pv(r,e)},yp.prototype.kv=function(t){return lp.pv(t)},yp.prototype.tw=function(e){return p(this,void 0,void 0,function(){return y(this,function(t){return e.user.uid!==this.currentUser.uid?(Mr(up,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.nv.ew(e.batchId,e.state,e.error)]})})},yp.prototype.iw=function(t){return this.nv.rw(t.targetId,t.state,t.error)},yp.prototype.Xv=function(t,e){var n=this,r=this.Fv();e?this.Iv[t]=e:delete this.Iv[t];var i=this.Fv(),o=[],s=[];return i.forEach(function(e){return p(n,void 0,void 0,function(){return y(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return p(n,void 0,void 0,function(){return y(this,function(t){return i.has(e)||s.push(e),[2]})})}),this.nv.uw(o,s)},yp.prototype.Ov=function(t){this.Iv[t.clientId]&&this.Id(t.onlineState)},yp);function yp(t,e,n,r,i){if(this.Da=t,this.platform=e,this.persistenceKey=n,this._v=r,this.nv=null,this.Id=null,this.wu=null,this.Iv={},this.Tv=this.Ev.bind(this),this.ph=!1,this.Rv=[],!yp.Js(this.platform))throw new ti(Zr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Av=rp(this.persistenceKey,this._v),this.Dv="firestore_sequence_number_"+this.persistenceKey,this.Iv[this._v]=new pp,this.Pv=new RegExp("^"+Zl+"_"+o+"_([^_]*)$"),this.Sv=new RegExp("^"+ip+"_"+o+"_(\\d+)(?:_(.*))?$"),this.Cv=new RegExp("^"+sp+"_"+o+"_(\\d+)$"),this.Vv="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Tv)}function vp(){this.activeTargetIds=fu()}function mp(t,e){this.clientId=t,this.onlineState=e}function gp(t,e){this.clientId=t,this.activeTargetIds=e}function wp(t,e,n){this.targetId=t,this.state=e,Fr(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}function bp(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Fr(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}function Ep(t){this.key=t}function Ip(t){this.key=t}var Tp=(Sp.prototype.jv=function(t){},Sp.prototype.Lv=function(t,e,n){},Sp.prototype.Mv=function(t){return this.sw.bv(t),this.ow[t]||"not-current"},Sp.prototype.zv=function(t,e,n){this.ow[t]=e},Sp.prototype.Qv=function(t){this.sw.yv(t)},Sp.prototype.Gv=function(t){return this.sw.activeTargetIds.has(t)},Sp.prototype.Wv=function(t){delete this.ow[t]},Sp.prototype.Fv=function(){return this.sw.activeTargetIds},Sp.prototype.xv=function(t){return this.sw.activeTargetIds.has(t)},Sp.prototype.start=function(){return this.sw=new pp,Promise.resolve()},Sp.prototype.Ph=function(t,e,n){},Sp.prototype.Hv=function(t){},Sp.prototype.shutdown=function(){},Sp.prototype.gu=function(t){},Sp),Np=(Object.defineProperty(Ap.prototype,"lw",{get:function(){return this.hw},enumerable:!0,configurable:!0}),Ap.prototype.dw=function(t,e){var a=this,u=e?e.vw:new Iu,h=e?e.fw:this.fw,c=e?e.Yi:this.Yi,f=h,l=!1,p=this.query.mi()&&h.size===this.query.limit?h.last():null,d=this.query.pi()&&h.size===this.query.limit?h.first():null;if(t.pt(function(t,e){var n=h.get(t),r=e instanceof Ls?e:null;r&&(Fr(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=a.query.matches(r)?r:null);var i=!!n&&a.Yi.has(n.key),o=!!r&&(r.un||a.Yi.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:lu.Gi,doc:r}),s=!0):a.ww(n,r)||(u.track({type:lu.Qi,doc:r}),s=!0,(p&&0<a.query.fi(r,p)||d&&a.query.fi(r,d)<0)&&(l=!0)):!n&&r?(u.track({type:lu.Mi,doc:r}),s=!0):n&&!r&&(u.track({type:lu.qi,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.mi()||this.query.pi())for(;f.size>this.query.limit;){var n=this.query.mi()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),u.track({type:lu.qi,doc:n})}return Fr(!l||!e,"View was refilled using docs that themselves needed refilling."),{fw:f,vw:u,bf:l,Yi:c}},Ap.prototype.ww=function(t,e){return t.un&&e.hasCommittedMutations&&!e.un},Ap.prototype.Qs=function(t,e,n){var o=this;Fr(!t.bf,"Cannot apply changes that need a refill");var r=this.fw;this.fw=t.fw,this.Yi=t.Yi;var i=t.vw.Hi();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.fi(t.doc,e.doc);function n(t){switch(t){case lu.Mi:return 1;case lu.Qi:case lu.Gi:return 2;case lu.qi:return 0;default:return Gr("Unknown ChangeType: "+t)}}var r,i}),this.mw(n);var s=e?this.pw():[],a=0===this.aw.size&&this.se?du.zi:du.Wi,u=a!==this.cw;return this.cw=a,0!==i.length||u?{snapshot:new Tu(this.query,t.fw,r,i,t.Yi,a===du.Wi,u,!1),gw:s}:{gw:s}},Ap.prototype.bw=function(t){return this.se&&t===aa.Ri?(this.se=!1,this.Qs({fw:this.fw,vw:new Iu,Yi:this.Yi,bf:!1},!1)):{gw:[]}},Ap.prototype.yw=function(t){return!this.hw.has(t)&&!!this.fw.has(t)&&!this.fw.get(t).un},Ap.prototype.mw=function(t){var e=this;t&&(t.oe.forEach(function(t){return e.hw=e.hw.add(t)}),t.he.forEach(function(t){return Fr(e.hw.has(t),"Modified document "+t+" not found in view.")}),t.ce.forEach(function(t){return e.hw=e.hw.delete(t)}),this.se=t.se)},Ap.prototype.pw=function(){var e=this;if(!this.se)return[];var n=this.aw;this.aw=hu(),this.fw.forEach(function(t){e.yw(t.key)&&(e.aw=e.aw.add(t.key))});var r=[];return n.forEach(function(t){e.aw.has(t)||r.push(new Ip(t))}),this.aw.forEach(function(t){n.has(t)||r.push(new Ep(t))}),r},Ap.prototype._w=function(t){this.hw=t.rc,this.aw=hu();var e=this.dw(t.documents);return this.Qs(e,!0)},Ap.prototype.Iw=function(){return Tu.Zi(this.query,this.fw,this.Yi,this.cw===du.Wi)},Ap);function Ap(t,e){this.query=t,this.hw=e,this.cw=null,this.se=!1,this.aw=hu(),this.Yi=hu(),this.fw=new vu(t.fi.bind(t))}function Sp(){this.sw=new pp,this.ow={},this.nv=null,this.Id=null,this.wu=null}function kp(t,e,n){this.query=t,this.targetId=e,this.view=n}function Dp(t){this.key=t,this.Sw=!1}function Rp(){this.sm=null,this.targetId=0,this.listeners=[]}function _p(){}var Op=(Hp.prototype.run=function(){this.Rw()},Hp.prototype.Rw=function(){var t=this;this.sl.Yf(function(){return p(t,void 0,void 0,function(){var e,n,r=this;return y(this,function(t){return e=this.Tw.vv(),(n=this.Aw(e))&&n.then(function(t){r.Su.Uu(function(){return e.commit().then(function(){r.ku.resolve(t)}).catch(function(t){r.Dw(t)})})}).catch(function(t){r.Dw(t)}),[2]})})})},Hp.prototype.Aw=function(t){try{var e=this.updateFunction(t);return!ea(e)&&e.catch&&e.then?e:(this.ku.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ku.reject(t),null}},Hp.prototype.Dw=function(t){var e=this;0<this.Ew&&this.Pw(t)?(this.Ew-=1,this.Su.Uu(function(){return e.Rw(),Promise.resolve()})):this.ku.reject(t)},Hp.prototype.Pw=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Za(e)},Hp),Cp=(Object.defineProperty(Bp.prototype,"Bw",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),Bp.prototype.subscribe=function(t){Fr(null!==t,"SyncEngine listener cannot be null"),Fr(null===this.Vw,"SyncEngine already has a subscriber."),this.Vw=t},Bp.prototype.listen=function(s){return p(this,void 0,void 0,function(){var e,n,r,i,o;return y(this,function(t){switch(t.label){case 0:return this.Mw("listen()"),(r=this.Nw.get(s))?(e=r.targetId,this.Cw.Mv(e),n=r.view.Iw(),[3,4]):[3,1];case 1:return[4,this.Oc.Xh(s.ai())];case 2:return i=t.sent(),o=this.Cw.Mv(i.targetId),e=i.targetId,[4,this.qw(s,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.Tw.listen(i),t.label=4;case 4:return this.Vw.Tl([n]),[2,e]}})})},Bp.prototype.qw=function(a,u,h){return p(this,void 0,void 0,function(){var e,n,r,i,o,s;return y(this,function(t){switch(t.label){case 0:return[4,this.Oc.ic(a,!0)];case 1:return e=t.sent(),n=new Np(a,e.rc),r=n.dw(e.documents),i=Au.ue(u,h&&this.onlineState!==aa.Ri),Fr(0===(o=n.Qs(r,!0===this.isPrimary,i)).gw.length,"View returned limbo docs before target ack from the server."),Fr(!!o.snapshot,"applyChanges for new view should always return a snapshot"),s=new kp(a,u,n),this.Nw.set(a,s),this.kw[u]||(this.kw[u]=[]),this.kw[u].push(a),[2,o.snapshot]}})})},Bp.prototype.Qw=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return[4,this.Oc.ic(r.query,!0)];case 1:return e=t.sent(),n=r.view._w(e),this.isPrimary&&this.Gw(r.targetId,n.gw),[2,n]}})})},Bp.prototype.Zd=function(i){return p(this,void 0,void 0,function(){var e,n,r=this;return y(this,function(t){switch(t.label){case 0:return this.Mw("unlisten()"),Fr(!!(e=this.Nw.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.kw[e.targetId]).length?(this.kw[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.Nw.delete(i),[2]):this.isPrimary?(this.Cw.Qv(e.targetId),this.Cw.xv(e.targetId)?[3,2]:[4,this.Oc.nc(e.targetId,!1).then(function(){r.Cw.Wv(e.targetId),r.Tw.Zd(e.targetId),r.Ww(e.targetId)}).catch(hc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.Ww(e.targetId),[4,this.Oc.nc(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Bp.prototype.write=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Mw("write()"),[4,this.Oc.Nh(n)];case 1:return e=t.sent(),this.Cw.jv(e.batchId),this.zw(e.batchId,r),[4,this.Kw(e.Os)];case 2:return t.sent(),[4,this.Tw.Jd()];case 3:return t.sent(),[2]}})})},Bp.prototype.runTransaction=function(t,e,n){new Op(t,this.Tw,e,n).run()},Bp.prototype.Lh=function(n){return p(this,void 0,void 0,function(){var e,r=this;return y(this,function(t){switch(t.label){case 0:this.Mw("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Oc.Lh(n)];case 2:return e=t.sent(),yi(n.te,function(t,e){var n=r.Fw[Number(t)];n&&(Fr(e.oe.size+e.he.size+e.ce.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.oe.size?n.Sw=!0:0<e.he.size?Fr(n.Sw,"Received change for limbo target document without add."):0<e.ce.size&&(Fr(n.Sw,"Received remove for limbo target document without add."),n.Sw=!1))}),[4,this.Kw(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,hc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Bp.prototype.bw=function(r,t){if(this.isPrimary&&t===ha.Ai||!this.isPrimary&&t===ha.Di){this.Mw("applyOnlineStateChange()");var i=[];this.Nw.forEach(function(t,e){var n=e.view.bw(r);Fr(0===n.gw.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.Vw.Hw(r),this.Vw.Tl(i),this.onlineState=r,this.isPrimary&&this.Cw.Hv(r)}},Bp.prototype.rv=function(a,u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return y(this,function(t){switch(t.label){case 0:return this.Mw("rejectListens()"),this.Cw.zv(a,"rejected",u),e=this.Fw[a],(n=e&&e.key)?(this.Ow=this.Ow.remove(n),delete this.Fw[a],r=(r=new zi(Hi.G)).lt(n,new Ps(n,Vi.B())),i=hu().add(n),o=new Nu(Vi.MIN,{},new so(Hr),r,i),[2,this.Lh(o)]):[3,1];case 1:return[4,this.Oc.nc(a,!1).then(function(){return s.Ww(a,u)}).catch(hc)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Bp.prototype.ew=function(n,r,i){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:return this.Mw("applyBatchState()"),[4,this.Oc.kh(n)];case 1:return null===(e=t.sent())?(Mr("SyncEngine","Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.Tw.Jd()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.Jw(n,i||null),this.Oc.oc(n)):Gr("Unknown batchState: "+r),t.label=4;case 4:return[4,this.Kw(e)];case 5:return t.sent(),[2]}})})},Bp.prototype.av=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:this.Mw("applySuccessfulWrite()"),e=r.batch.batchId,this.Jw(e,null),this.Yw(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Oc.yo(r)];case 2:return n=t.sent(),this.Cw.Lv(e,"acknowledged"),[4,this.Kw(n)];case 3:return t.sent(),[3,6];case 4:return[4,hc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Bp.prototype.dv=function(n,r){return p(this,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:this.Mw("rejectFailedWrite()"),this.Jw(n,r),this.Yw(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Oc.jh(n)];case 2:return e=t.sent(),this.Cw.Lv(n,"rejected",r),[4,this.Kw(e)];case 3:return t.sent(),[3,6];case 4:return[4,hc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Bp.prototype.Xw=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return this.Tw.xd()||Mr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.Oc.Vo()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.Uw.get(e)||[]).push(r),this.Uw.set(e,n)),[2]}})})},Bp.prototype.Yw=function(t){(this.Uw.get(t)||[]).forEach(function(t){t.resolve()}),this.Uw.delete(t)},Bp.prototype.$w=function(e){this.Uw.forEach(function(t){t.forEach(function(t){t.reject(new ti(Zr.CANCELLED,e))})}),this.Uw.clear()},Bp.prototype.zw=function(t,e){var n=this.jw[this.currentUser.v()];n=(n=n||new zi(Hr)).lt(t,e),this.jw[this.currentUser.v()]=n},Bp.prototype.Jw=function(t,e){var n=this.jw[this.currentUser.v()];if(n){var r=n.get(t);r&&(Fr(t===n.vt(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.jw[this.currentUser.v()]=n}},Bp.prototype.Ww=function(t,e){var n=this;void 0===e&&(e=null),this.Cw.Qv(t),Fr(this.kw[t]&&0!==this.kw[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.kw[t];r<i.length;r++){var o=i[r];this.Nw.delete(o),e&&this.Vw.Zw(o,e)}if(delete this.kw[t],this.isPrimary){var s=this.xw.bs(t);this.xw.ps(t),s.forEach(function(t){n.xw.ys(t)||n.tm(t)})}},Bp.prototype.tm=function(t){var e=this.Ow.get(t);null!==e&&(this.Tw.Zd(e),this.Ow=this.Ow.remove(t),delete this.Fw[e])},Bp.prototype.Gw=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Ep?(this.xw.ls(i.key,t),this.nm(i)):i instanceof Ip?(Mr("SyncEngine","Document no longer in limbo: "+i.key),this.xw.vs(i.key,t),this.xw.ys(i.key)||this.tm(i.key)):Gr("Unknown limbo change: "+JSON.stringify(i))}},Bp.prototype.nm=function(t){var e=t.key;if(!this.Ow.get(e)){Mr("SyncEngine","New document in limbo: "+e);var n=this.Lw.next(),r=ma.$n(e.path);this.Fw[n]=new Dp(e),this.Tw.listen(new Qa(r.ai(),n,Fa.Ni,nh.bu)),this.Ow=this.Ow.lt(e,n)}},Bp.prototype.im=function(){return this.Ow},Bp.prototype.Kw=function(r,u){return p(this,void 0,void 0,function(){var o,s,e,a=this;return y(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.Nw.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.dw(r);return n.bf?a.Oc.ic(i.query,!1).then(function(t){var e=t.documents;return i.view.dw(e,n)}):n}).then(function(t){var e=u&&u.te[i.targetId],n=i.view.Qs(t,!0===a.isPrimary,e);if(a.Gw(i.targetId,n.gw),n.snapshot){a.isPrimary&&a.Cw.zv(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=nc.fh(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Vw.Tl(o),[4,this.Oc.Hh(s)];case 2:return t.sent(),[2]}})})},Bp.prototype.Mw=function(t){Fr(null!==this.Vw,"Trying to call "+t+" before calling subscribe().")},Bp.prototype.wv=function(r){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.$w("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.Oc.Ph(r)]):[3,3];case 1:return n=t.sent(),this.Cw.Ph(r,n.Ch,n.Vh),[4,this.Kw(n.Sh)];case 2:t.sent(),t.label=3;case 3:return[4,this.Tw.wv()];case 4:return t.sent(),[2]}})})},Bp.prototype.mv=function(u){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return!0!==u||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Tw.mv(!0)]);case 1:return t.sent(),o=this.Cw.Fv(),[4,this.em(o.tt())];case 2:for(e=t.sent(),n=0,r=e;n<r.length;n++)i=r[n],this.Tw.listen(i);return[3,7];case 3:return!1!==u||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),di(this.kw,function(t,e){a.Cw.Gv(t)?o.push(t):s=s.then(function(){return a.Ww(t),a.Oc.nc(t,!0)}),a.Tw.Zd(t)}),[4,s]);case 4:return t.sent(),[4,this.em(o)];case 5:return t.sent(),this.rm(),[4,this.Tw.mv(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Bp.prototype.rm=function(){var e=this;di(this.Fw,function(t){e.Tw.Zd(t)}),this.xw.gs(),this.Fw=[],this.Ow=new zi(Hi.G)},Bp.prototype.em=function(d){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c,f,l,p;return y(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(a=this.kw[o])&&0!==a.length?[4,this.Oc.nc(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.Oc.Xh(a[0].ai())];case 3:s=t.sent(),u=0,h=a,t.label=4;case 4:return u<h.length?(c=h[u],Fr(!!(f=this.Nw.get(c)),"No query view found for "+c),[4,this.Qw(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Fr(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.Oc.fc(o)];case 9:return Fr(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.Oc.Xh(p)];case 10:return s=t.sent(),[4,this.qw(this.um(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return this.Vw.Tl(n),[2,e]}})})},Bp.prototype.um=function(t){return new ma(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,ra.Wn,t.startAt,t.endAt)},Bp.prototype.sc=function(){return this.Oc.sc()},Bp.prototype.rw=function(r,i,o){return p(this,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Mr("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.kw[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.Oc.lc()];case 2:return e=t.sent(),n=Nu.re(r,"current"===i),[4,this.Kw(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.Oc.nc(r,!0)];case 5:return t.sent(),this.Ww(r,o),[3,7];case 6:Gr("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},Bp.prototype.uw=function(f,l){return p(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,h,c=this;return y(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=f,t.label=1;case 1:return e<n.length?(h=n[e],Fr(!this.kw[h],"Trying to add an already active target"),[4,this.Oc.fc(h)]):[3,6];case 2:return Fr(!!(r=t.sent()),"Query data for active target "+h+" not found"),[4,this.Oc.Xh(r)];case 3:return i=t.sent(),[4,this.qw(this.um(r),i.targetId,!1)];case 4:t.sent(),this.Tw.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return y(this,function(t){switch(t.label){case 0:return s.kw[e]?[4,s.Oc.nc(e,!1).then(function(){c.Tw.Zd(e),c.Ww(e)}).catch(hc)]:[2,"continue"];case 1:return t.sent(),[2]}})},s=this,a=0,u=l,t.label=7;case 7:return a<u.length?(h=u[a],[5,o(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Bp.prototype.enableNetwork=function(){return this.Oc.hc(!0),this.Tw.enableNetwork()},Bp.prototype.disableNetwork=function(){return this.Oc.hc(!1),this.Tw.disableNetwork()},Bp.prototype.Ye=function(t){var e=this.Fw[t];if(e&&e.Sw)return hu().add(e.key);var n=hu(),r=this.kw[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.Nw.get(s);Fr(!!a,"No query view found for "+s),n=n.qt(a.view.lw)}return n},Bp),xp=(jp.prototype.listen=function(t){var e=t.query,n=!1,r=this.om.get(e);return r||(n=!0,r=new Rp,this.om.set(e,r)),r.listeners.push(t),Fr(!t.bw(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.sm&&t.cm(r.sm)&&this.am(),n?this.nv.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},jp.prototype.Zd=function(o){return p(this,void 0,void 0,function(){var e,n,r,i;return y(this,function(t){return e=o.query,n=!1,(r=this.om.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.om.delete(e),[2,this.nv.Zd(e)]):[2]})})},jp.prototype.Tl=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.om.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].cm(i)&&(e=!0);s.sm=i}}e&&this.am()},jp.prototype.Zw=function(t,e){var n=this.om.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.om.delete(t)},jp.prototype.Hw=function(i){this.onlineState=i;var o=!1;this.om.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].bw(i)&&(o=!0)}),o&&this.am()},jp.prototype.fm=function(t){this.hm.add(t),t.next()},jp.prototype.lm=function(t){this.hm.delete(t)},jp.prototype.am=function(){this.hm.forEach(function(t){t.next()})},jp),Lp=(Fp.prototype.cm=function(t){if(Fr(0<t.docChanges.length||t.Xi,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==lu.Gi&&e.push(i)}t=new Tu(t.query,t.docs,t.Ji,e,t.Yi,t.fromCache,t.Xi,!0)}var o=!1;return this.vm?this.mm(t)&&(this.dm.next(t),o=!0):this.pm(t,this.onlineState)&&(this.gm(t),o=!0),this.wm=t,o},Fp.prototype.onError=function(t){this.dm.error(t)},Fp.prototype.bw=function(t){this.onlineState=t;var e=!1;return this.wm&&!this.vm&&this.pm(this.wm,t)&&(this.gm(this.wm),e=!0),e},Fp.prototype.pm=function(t,e){if(Fr(!this.vm,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==aa.Ri;return this.options.bm&&n?(Fr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.J()||e===aa.Ri},Fp.prototype.mm=function(t){if(0<t.docChanges.length)return!0;var e=this.wm&&this.wm.hasPendingWrites!==t.hasPendingWrites;return!(!t.Xi&&!e)&&!0===this.options.includeMetadataChanges},Fp.prototype.gm=function(t){Fr(!this.vm,"Trying to raise initial events for second time"),t=Tu.Zi(t.query,t.docs,t.Yi,t.fromCache),this.vm=!0,this.dm.next(t)},Fp),Pp=(Gp.prototype.La=function(){return pc.Ac(this.cacheSizeBytes)},Gp),Up=(Vp.prototype.start=function(t){var n=this;this._m();var r=new Xu,i=new Xu,o=!1;return this.credentials.T(function(e){o?n.Su.Uu(function(){return n.wv(e)}):(o=!0,n.Im(t,i,e).then(function(t){return n.Tm(e,t)}).then(r.resolve,r.reject))}),this.Su.Uu(function(){return r.promise}),i.promise},Vp.prototype.enableNetwork=function(){var t=this;return this._m(),this.Su.enqueue(function(){return t.nv.enableNetwork()})},Vp.prototype.Im=function(t,e,n){var r=this;return t instanceof Pp?this.Em(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.Rm(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.Am()}):(e.resolve(),this.Am())},Vp.prototype.Rm=function(t){return t instanceof ti?t.code===Zr.FAILED_PRECONDITION||t.code===Zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Vp.prototype._m=function(){if(this.Su.Wu)throw new ti(Zr.FAILED_PRECONDITION,"The client has already been terminated.")},Vp.prototype.Em=function(r,i){var t=this,o=Tf.ff(this.ym),s=new Hu(this.ym.s,{tr:!0});return Promise.resolve().then(function(){return p(t,void 0,void 0,function(){var e,n;return y(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!dp.Js(this.platform))throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.La(),this.Cw=i.synchronizeTabs?new dp(this.Su,this.platform,o,this.clientId,r):new Tp,[4,Tf.Ua({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,Da:this.Su,serializer:s,La:e,Pa:this.Cw})];case 1:return n=t.sent(),[2,(this.persistence=n).wo.kc]}})})})},Vp.prototype.Am=function(){return this.persistence=Ff.Of(this.clientId),this.Cw=new Tp,Promise.resolve(null)},Vp.prototype.Tm=function(h,c){var t=this;return Mr("FirestoreClient","Initializing. user=",h.uid),this.platform.Dm(this.ym).then(function(u){return p(t,void 0,void 0,function(){var e,n,r,i,o,s,a=this;return y(this,function(t){switch(t.label){case 0:return e=new Of,this.Oc=new ic(this.persistence,e,h),[4,this.Oc.start()];case 1:return t.sent(),c&&(this.Pm=new dc(c,this.Su,this.Oc)),n=this.platform.Sm(),r=this.platform.Cm(this.ym.s),i=new ol(this.Su,u,this.credentials,r),o=function(t){return a.nv.bw(t,ha.Ai)},s=function(t){return a.nv.bw(t,ha.Di)},this.Tw=new $l(this.Oc,i,this.Su,o,n),this.nv=new Cp(this.Oc,this.Tw,this.Cw,h),this.Cw.Id=s,this.Tw.nv=this.nv,this.Cw.nv=this.nv,this.Vm=new xp(this.nv),[4,this.Cw.start()];case 2:return t.sent(),[4,this.Tw.start()];case 3:return t.sent(),[4,this.persistence.za(function(e){return p(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.nv.mv(e)];case 1:return t.sent(),this.Pm&&(e&&!this.Pm.ph?this.Pm.start():e||this.Pm.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.Ka(function(){return p(a,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},Vp.prototype.wv=function(t){return this.Su.Zu(),Mr("FirestoreClient","Credential Changed. Current user: "+t.uid),this.nv.wv(t)},Vp.prototype.disableNetwork=function(){var t=this;return this._m(),this.Su.enqueue(function(){return t.nv.disableNetwork()})},Vp.prototype.terminate=function(){var t=this;return this.Su.Yu(function(){return p(t,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Pm&&this.Pm.stop(),[4,this.Tw.shutdown()];case 1:return t.sent(),[4,this.Cw.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.R(),[2]}})})})},Vp.prototype.waitForPendingWrites=function(){var t=this;this._m();var e=new Xu;return this.Su.Uu(function(){return t.nv.Xw(e)}),e.promise},Vp.prototype.listen=function(t,e,n){var r=this;this._m();var i=new Lp(t,e,n);return this.Su.Uu(function(){return r.Vm.listen(i)}),i},Vp.prototype.Zd=function(t){var e=this;this.Nm||this.Su.Uu(function(){return e.Vm.Zd(t)})},Vp.prototype.km=function(t){var e=this;return this._m(),this.Su.enqueue(function(){return e.Oc.Yh(t)}).then(function(t){if(t instanceof Ls)return t;if(t instanceof Ps)return null;throw new ti(Zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},Vp.prototype.Om=function(i){var t=this;return this._m(),this.Su.enqueue(function(){return p(t,void 0,void 0,function(){var e,n,r;return y(this,function(t){switch(t.label){case 0:return[4,this.Oc.ic(i,!0)];case 1:return e=t.sent(),n=new Np(i,e.rc),r=n.dw(e.documents),[2,n.Qs(r,!1).snapshot]}})})})},Vp.prototype.write=function(t){var e=this;this._m();var n=new Xu;return this.Su.Uu(function(){return e.nv.write(t,n)}),n.promise},Vp.prototype.s=function(){return this.ym.s},Vp.prototype.fm=function(t){var e=this;this._m(),this.Su.Uu(function(){return e.Vm.fm(t),Promise.resolve()})},Vp.prototype.lm=function(t){this.Nm||this.Vm.lm(t)},Object.defineProperty(Vp.prototype,"Nm",{get:function(){return this.Su.Wu},enumerable:!0,configurable:!0}),Vp.prototype.transaction=function(t){var e=this;this._m();var n=new Xu;return this.Su.Uu(function(){return e.nv.runTransaction(e.Su,t,n),Promise.resolve()}),n.promise},Vp),Mp=(qp.prototype.next=function(t){this.Fm(this.observer.next,t)},qp.prototype.error=function(t){this.Fm(this.observer.error,t)},qp.prototype.xm=function(){this.muted=!0},qp.prototype.Fm=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},qp);function qp(t){this.observer=t,this.muted=!1}function Vp(t,e,n,r){this.platform=t,this.ym=e,this.credentials=n,this.Su=r,this.clientId=jr.u()}function Gp(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}function Fp(t,e,n){this.query=t,this.dm=e,this.vm=!1,this.wm=null,this.onlineState=aa.Ti,this.options=n||{}}function jp(t){this.nv=t,this.om=new Eh(function(t){return t.canonicalId()}),this.onlineState=aa.Ti,this.hm=new Set,this.nv.subscribe(this)}function Bp(t,e,n,r){this.Oc=t,this.Tw=e,this.Cw=n,this.currentUser=r,this.Vw=null,this.Nw=new Eh(function(t){return t.canonicalId()}),this.kw={},this.Ow=new zi(Hi.G),this.Fw={},this.xw=new wh,this.jw={},this.Uw=new Map,this.Lw=tc.Ho(),this.isPrimary=void 0,this.onlineState=aa.Ti}function Hp(t,e,n,r){this.Su=t,this.Tw=e,this.updateFunction=n,this.ku=r,this.Ew=5,this.sl=new zf(this.Su,$u.Pu)}function zp(i){return function(){if("object"!=typeof i||null===i)return!1;for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return!0}return!1}()}var Yp,Wp=pc.Sc,Kp=(pd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},pd),Qp=(ld.prototype.settings=function(t){if(gi("Firestore.settings",arguments,1),Ei("Firestore.settings","object",1,t),li(t,"persistence"))throw new ti(Zr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Kp(t);if(this.Bm&&!this.Wm.isEqual(e))throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Wm=e).credentials&&(this.Gm=function(t){if(!t)return new ei;switch(t.type){case"gapi":var e=t.k;return Fr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new ii(e,t.V||"0");case"provider":return t.k;default:throw new ti(Zr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},ld.prototype.enableNetwork=function(){return this.Lm(),this.Bm.enableNetwork()},ld.prototype.disableNetwork=function(){return this.Lm(),this.Bm.disableNetwork()},ld.prototype.enablePersistence=function(t){if(this.Bm)throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&qr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=pi(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.Hm(new Pp(this.Wm.cacheSizeBytes,e))},ld.prototype.clearPersistence=function(){var t=this,n=Tf.ff(this.Jm()),r=new Xu;return this.Um.zu(function(){return p(t,void 0,void 0,function(){var e;return y(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this.Bm&&!this.Bm.Nm)throw new ti(Zr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Tf.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},ld.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(ld.prototype,"Ym",{get:function(){return this.Lm(),this.Bm.Nm},enumerable:!0,configurable:!0}),ld.prototype.waitForPendingWrites=function(){return this.Lm(),this.Bm.waitForPendingWrites()},ld.prototype.onSnapshotsInSync=function(t){if(this.Lm(),zp(t))return this.Xm(t);Ei("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Xm(e)},ld.prototype.Xm=function(t){var e=this,n=new Mp({next:function(){t.next&&t.next()},error:function(t){throw Gr("Uncaught Error in onSnapshotsInSync")}});return this.Bm.fm(n),function(){n.xm(),e.Bm.lm(n)}},ld.prototype.Lm=function(){return this.Bm||this.Hm(new _p),this.Bm},ld.prototype.Jm=function(){return new Wr(this.Mm,this.Qm,this.Wm.host,this.Wm.ssl,this.Wm.forceLongPolling)},ld.prototype.Hm=function(t){Fr(!!this.Wm.host,"FirestoreSettings.host is not set"),Fr(!this.Bm,"configureClient() called multiple times");var e=this.Jm();return this.Bm=new Up(zu.t(),e,this.Gm,this.Um),this.Bm.start(t)},ld.prototype.Km=function(r){return new Fl(function(t){if(t instanceof $p){var e=r,n=t.firestore.Mm;if(!n.isEqual(e))throw new ti(Zr.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new Gl(r,t.$m)}return t})},ld.qm=function(t){var e=t.options;if(!li(e,"projectId"))throw new ti(Zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new ti(Zr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Xr(n)},Object.defineProperty(ld.prototype,"app",{get:function(){if(!this.jm)throw new ti(Zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.jm},enumerable:!0,configurable:!0}),ld.prototype.collection=function(t){return gi("Firestore.collection",arguments,1),Ei("Firestore.collection","non-empty string",1,t),this.Lm(),new yd(Fi.it(t),this)},ld.prototype.doc=function(t){return gi("Firestore.doc",arguments,1),Ei("Firestore.doc","non-empty string",1,t),this.Lm(),$p.Zm(Fi.it(t),this)},ld.prototype.collectionGroup=function(t){if(gi("Firestore.collectionGroup",arguments,1),Ei("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Lm(),new nd(new ma(Fi.et,t),this)},ld.prototype.runTransaction=function(e){var n=this;return gi("Firestore.runTransaction",arguments,1),Ei("Firestore.runTransaction","function",1,e),this.Lm().transaction(function(t){return e(new Jp(n,t))})},ld.prototype.batch=function(){return this.Lm(),new Xp(this)},Object.defineProperty(ld,"logLevel",{get:function(){switch(Pr()){case Ar.DEBUG:return"debug";case Ar.ERROR:return"error";case Ar.SILENT:return"silent";default:return Gr("Unknown log level: "+Pr())}},enumerable:!0,configurable:!0}),ld.setLogLevel=function(t){switch(gi("Firestore.setLogLevel",arguments,1),Ei("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Ur(Ar.DEBUG);break;case"error":Ur(Ar.ERROR);break;case"silent":Ur(Ar.SILENT);break;default:throw new ti(Zr.INVALID_ARGUMENT,"Invalid log level: "+t)}},ld.prototype.tp=function(){return this.Wm.timestampsInSnapshots},ld),Jp=(fd.prototype.get=function(t){var n=this;gi("Transaction.get",arguments,1);var r=bd("Transaction.get",t,this.np);return this.ip.lookup([r.$m]).then(function(t){if(!t||1!==t.length)return Gr("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Ps)return new td(n.np,r.$m,null,!1,!1,r.ep);if(e instanceof Ls)return new td(n.np,r.$m,e,!1,!1,r.ep);throw Gr("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},fd.prototype.set=function(t,e,n){bi("Transaction.set",arguments,2,3);var r=bd("Transaction.set",t,this.np);n=md("Transaction.set",n);var i=Ed(r.ep,e,"Transaction.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.np.zm.ed(s,o,n.mergeFields):this.np.zm.td(s,o);return this.ip.set(r.$m,a),this},fd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof sl?(wi("Transaction.update",arguments,3),r=bd("Transaction.update",t,this.np),this.np.zm.sd("Transaction.update",e,n,o)):(gi("Transaction.update",arguments,2),r=bd("Transaction.update",t,this.np),this.np.zm.rd("Transaction.update",e)),this.ip.update(r.$m,i),this},fd.prototype.delete=function(t){gi("Transaction.delete",arguments,1);var e=bd("Transaction.delete",t,this.np);return this.ip.delete(e.$m),this},fd),Xp=(cd.prototype.set=function(t,e,n){bi("WriteBatch.set",arguments,2,3),this.sp();var r=bd("WriteBatch.set",t,this.np);n=md("WriteBatch.set",n);var i=Ed(r.ep,e,"WriteBatch.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.np.zm.ed(s,o,n.mergeFields):this.np.zm.td(s,o);return this.rp=this.rp.concat(a.Bl(r.$m,Uo.NONE)),this},cd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.sp(),i="string"==typeof e||e instanceof sl?(wi("WriteBatch.update",arguments,3),r=bd("WriteBatch.update",t,this.np),this.np.zm.sd("WriteBatch.update",e,n,o)):(gi("WriteBatch.update",arguments,2),r=bd("WriteBatch.update",t,this.np),this.np.zm.rd("WriteBatch.update",e)),this.rp=this.rp.concat(i.Bl(r.$m,Uo.exists(!0))),this},cd.prototype.delete=function(t){gi("WriteBatch.delete",arguments,1),this.sp();var e=bd("WriteBatch.delete",t,this.np);return this.rp=this.rp.concat(new Fo(e.$m,Uo.NONE)),this},cd.prototype.commit=function(){return p(this,void 0,void 0,function(){return y(this,function(t){return this.sp(),this.up=!0,0<this.rp.length?[2,this.np.Lm().write(this.rp)]:[2]})})},cd.prototype.sp=function(){if(this.up)throw new ti(Zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},cd),$p=(hd.Zm=function(t,e,n){if(t.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.nt()+" has "+t.length);return new hd(new Hi(t),e,n)},Object.defineProperty(hd.prototype,"id",{get:function(){return this.$m.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"parent",{get:function(){return new yd(this.$m.path.H(),this.firestore,this.ep)},enumerable:!0,configurable:!0}),Object.defineProperty(hd.prototype,"path",{get:function(){return this.$m.path.nt()},enumerable:!0,configurable:!0}),hd.prototype.collection=function(t){if(gi("DocumentReference.collection",arguments,1),Ei("DocumentReference.collection","non-empty string",1,t),!t)throw new ti(Zr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Fi.it(t);return new yd(this.$m.path.child(e),this.firestore)},hd.prototype.isEqual=function(t){if(!(t instanceof hd))throw Oi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.$m.isEqual(t.$m)&&this.ep===t.ep},hd.prototype.set=function(t,e){bi("DocumentReference.set",arguments,1,2),e=md("DocumentReference.set",e);var n=Ed(this.ep,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.zm.ed(i,r,e.mergeFields):this.firestore.zm.td(i,r);return this.Bm.write(o.Bl(this.$m,Uo.NONE))},hd.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof sl?(wi("DocumentReference.update",arguments,2),this.firestore.zm.sd("DocumentReference.update",t,e,r)):(gi("DocumentReference.update",arguments,1),this.firestore.zm.rd("DocumentReference.update",t)),this.Bm.write(n.Bl(this.$m,Uo.exists(!0)))},hd.prototype.delete=function(){return gi("DocumentReference.delete",arguments,0),this.Bm.write([new Fo(this.$m,Uo.NONE)])},hd.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bi("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||zp(t[i])||(_i("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Ni("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=zp(t[i])?t[i]:(Ei("DocumentReference.onSnapshot","function",i,t[i]),Ii("DocumentReference.onSnapshot","function",i+1,t[i+1]),Ii("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.hp(o,n)},hd.prototype.hp=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Mp({next:function(t){if(n.next){Fr(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r.$m);n.next(new td(r.firestore,r.$m,e,t.fromCache,t.hasPendingWrites,r.ep))}},error:e}),o=this.Bm.listen(ma.$n(this.$m.path),i,t);return function(){i.xm(),r.Bm.Zd(o)}},hd.prototype.get=function(n){var r=this;return bi("DocumentReference.get",arguments,0,1),wd("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.Lm().km(r.$m).then(function(t){e(new td(r.firestore,r.$m,t,!0,t instanceof Ls&&t.un,r.ep))},t):r.cp(e,t,n)})},hd.prototype.cp=function(e,n,r){var i=this.hp({includeMetadataChanges:!0,bm:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new ti(Zr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new ti(Zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},hd.prototype.withConverter=function(t){return new hd(this.$m,this.firestore,t)},hd),Zp=(ud.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},ud),td=(ad.prototype.data=function(t){if(bi("DocumentSnapshot.data",arguments,0,1),t=gd("DocumentSnapshot.data",t),this.ap){if(this.ep){var e=new ed(this.np,this.$m,this.ap,this.fp,this.lp);return this.ep.fromFirestore(e,t)}return this.dp(this.ap.data(),Zo.Dn(t,this.np.tp()))}},ad.prototype.get=function(t,e){if(bi("DocumentSnapshot.get",arguments,1,2),e=gd("DocumentSnapshot.get",e),this.ap){var n=this.ap.data().field(Yl("DocumentSnapshot.get",t));if(null!==n)return this.vp(n,Zo.Dn(e,this.np.tp()))}},Object.defineProperty(ad.prototype,"id",{get:function(){return this.$m.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(ad.prototype,"ref",{get:function(){return new $p(this.$m,this.np,this.ep)},enumerable:!0,configurable:!0}),Object.defineProperty(ad.prototype,"exists",{get:function(){return null!==this.ap},enumerable:!0,configurable:!0}),Object.defineProperty(ad.prototype,"metadata",{get:function(){return new Zp(this.lp,this.fp)},enumerable:!0,configurable:!0}),ad.prototype.isEqual=function(t){if(!(t instanceof ad))throw Oi("isEqual","DocumentSnapshot",1,t);return this.np===t.np&&this.fp===t.fp&&this.$m.isEqual(t.$m)&&(null===this.ap?null===t.ap:this.ap.isEqual(t.ap))&&this.ep===t.ep},ad.prototype.dp=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.vp(e,n)}),i},ad.prototype.vp=function(t,e){if(t instanceof Os)return this.dp(t,e);if(t instanceof Cs)return this.wp(t,e);if(t instanceof Rs){var n=t.value(e),r=this.np.Lm().s();return t.s.isEqual(r)||qr("Document "+this.$m.path+" contains a document reference within a different database ("+t.s.projectId+"/"+t.s.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new $p(n,this.np,this.ep)}return t.value(e)},ad.prototype.wp=function(t,e){var n=this;return t.Ht.map(function(t){return n.vp(t,e)})},ad),ed=(t(sd,Yp=td),sd.prototype.data=function(t){var e=Yp.prototype.data.call(this,t);return Fr(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},sd),nd=(od.prototype.where=function(t,e,n){var r;gi("Query.where",arguments,3),Ri("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+Di(r)+" provided to function "+t+"() for its "+xi(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=Yl("Query.where",t),o=ga.it(e);if(i.ut()){if(o===ga.ARRAY_CONTAINS||o===ga.ARRAY_CONTAINS_ANY)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===ga.IN){this.pp(n,o);for(var s=[],a=0,u=n;a<u.length;a++){var h=u[a];s.push(this.gp(h))}r=new Cs(s)}else r=this.gp(n)}else o!==ga.IN&&o!==ga.ARRAY_CONTAINS_ANY||this.pp(n,o),r=this.firestore.zm.od("Query.where",n,o===ga.IN);var c=wa.create(i,o,r);return this.bp(c),new od(this.mp.ni(c),this.firestore,this.ep)},od.prototype.orderBy=function(t,e){var n;if(bi("Query.orderBy",arguments,1,2),Ii("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=Aa.ASCENDING;else{if("desc"!==e)throw new ti(Zr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=Aa.DESCENDING}if(null!==this.mp.startAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.mp.endAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Yl("Query.orderBy",t),i=new ka(r,n);return this.yp(i),new od(this.mp.ei(i),this.firestore,this.ep)},od.prototype.limit=function(t){return gi("Query.limit",arguments,1),Ei("Query.limit","number",1,t),Ci("Query.limit",1,t),new od(this.mp.ri(t),this.firestore,this.ep)},od.prototype.limitToLast=function(t){return gi("Query.limitToLast",arguments,1),Ei("Query.limitToLast","number",1,t),Ci("Query.limitToLast",1,t),new od(this.mp.ui(t),this.firestore,this.ep)},od.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.startAt",arguments,1);var r=this._p("Query.startAt",t,e,!0);return new od(this.mp.si(r),this.firestore,this.ep)},od.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.startAfter",arguments,1);var r=this._p("Query.startAfter",t,e,!1);return new od(this.mp.si(r),this.firestore,this.ep)},od.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.endBefore",arguments,1);var r=this._p("Query.endBefore",t,e,!0);return new od(this.mp.oi(r),this.firestore,this.ep)},od.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wi("Query.endAt",arguments,1);var r=this._p("Query.endAt",t,e,!1);return new od(this.mp.oi(r),this.firestore,this.ep)},od.prototype.isEqual=function(t){if(!(t instanceof od))throw Oi("isEqual","Query",1,t);return this.firestore===t.firestore&&this.mp.isEqual(t.mp)},od.prototype.withConverter=function(t){return new od(this.mp,this.firestore,t)},od.prototype._p=function(t,e,n,r){if(Ri(t,1,e),e instanceof td){if(0<n.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new ti(Zr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.Ip(t,i.ap,r)}var o=[e].concat(n);return this.Tp(t,o,r)},od.prototype.Ip=function(t,e,n){for(var r=[],i=0,o=this.mp.orderBy;i<o.length;i++){var s=o[i];if(s.field.ut())r.push(new Rs(this.firestore.Mm,e.key));else{var a=e.field(s.field);if(a instanceof ks)throw new ti(Zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var u=s.field.nt();throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new Sa(r,n)},od.prototype.Tp=function(t,e,n){var r=this.mp.Kn;if(e.length>r.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.ut()){if("string"!=typeof s)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.mp.bi()&&-1!==s.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var a=this.mp.path.child(Fi.it(s));if(!Hi.ht(a))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+a+"' is not because it contains an odd number of segments.");var u=new Hi(a);i.push(new Rs(this.firestore.Mm,u))}else{var h=this.firestore.zm.od(t,s);i.push(h)}}return new Sa(i,n)},od.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bi("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||zp(t[i])||(_i("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ni("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=zp(t[i])?t[i]:(Ei("Query.onSnapshot","function",i,t[i]),Ii("Query.onSnapshot","function",i+1,t[i+1]),Ii("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.Ep(this.mp),this.hp(r,n)},od.prototype.hp=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Mp({next:function(t){e.next&&e.next(new rd(n.firestore,n.mp,t,n.ep))},error:r}),o=this.firestore.Lm(),s=o.listen(this.mp,i,t);return function(){i.xm(),o.Zd(s)}},od.prototype.Ep=function(t){if(t.pi()&&0===t.Kn.length)throw new ti(Zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},od.prototype.get=function(n){var r=this;return bi("Query.get",arguments,0,1),wd("Query.get",n),this.Ep(this.mp),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.Lm().Om(r.mp).then(function(t){e(new rd(r.firestore,r.mp,t,r.ep))},t):r.cp(e,t,n)})},od.prototype.cp=function(e,n,r){var i=this.hp({includeMetadataChanges:!0,bm:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new ti(Zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},od.prototype.gp=function(t){if("string"==typeof t){if(""===t)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.mp.bi()&&-1!==t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.mp.path.child(Fi.it(t));if(!Hi.ht(e))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Rs(this.firestore.Mm,new Hi(e))}if(t instanceof $p){var n=t;return new Rs(this.firestore.Mm,n.$m)}throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Di(t)+".")},od.prototype.pp=function(t,e){if(!Array.isArray(t)||0===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},od.prototype.bp=function(t){if(t instanceof wa){var e=[ga.ARRAY_CONTAINS,ga.ARRAY_CONTAINS_ANY],n=[ga.IN,ga.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ii()){var o=this.mp.Zn();if(null!==o&&!o.isEqual(t.field))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.mp.ti();null!==s&&this.Rp(t.field,s)}else if(i||r){var a=null;if(i&&(a=this.mp.gi(n)),null===a&&r&&(a=this.mp.gi(e)),null!=a)throw a===t.op?new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+a.toString()+"' filters.")}}},od.prototype.yp=function(t){if(null===this.mp.ti()){var e=this.mp.Zn();null!==e&&this.Rp(e,t.field)}},od.prototype.Rp=function(t,e){if(!e.isEqual(t))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},od),rd=(Object.defineProperty(id.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(id.prototype,"empty",{get:function(){return this.Dp.docs.J()},enumerable:!0,configurable:!0}),Object.defineProperty(id.prototype,"size",{get:function(){return this.Dp.docs.size},enumerable:!0,configurable:!0}),id.prototype.forEach=function(e,n){var r=this;bi("QuerySnapshot.forEach",arguments,1,2),Ei("QuerySnapshot.forEach","function",1,e),this.Dp.docs.forEach(function(t){e.call(n,r.Cp(t))})},Object.defineProperty(id.prototype,"query",{get:function(){return new nd(this.Ap,this.np,this.ep)},enumerable:!0,configurable:!0}),id.prototype.docChanges=function(t){t&&(_i("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ni("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Dp.$i)throw new ti(Zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Pp&&this.Sp===e||(this.Pp=function(i,e,o,s){if(o.Ji.J()){var n,r=0;return o.docChanges.map(function(t){var e=new ed(i,t.doc.key,t.doc,o.fromCache,o.Yi.has(t.doc.key),s);return Fr(t.type===lu.Mi,"Invalid event type for first snapshot"),Fr(!n||o.query.fi(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.Ji;return o.docChanges.filter(function(t){return e||t.type!==lu.Gi}).map(function(t){var e=new ed(i,t.doc.key,t.doc,o.fromCache,o.Yi.has(t.doc.key),s),n=-1,r=-1;return t.type!==lu.Mi&&(Fr(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==lu.qi&&(r=(a=a.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case lu.Mi:return"added";case lu.Qi:case lu.Gi:return"modified";case lu.qi:return"removed";default:return Gr("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.np,e,this.Dp,this.ep),this.Sp=e),this.Pp},id.prototype.isEqual=function(t){if(!(t instanceof id))throw Oi("isEqual","QuerySnapshot",1,t);return this.np===t.np&&this.Ap.isEqual(t.Ap)&&this.Dp.isEqual(t.Dp)&&this.ep===t.ep},id.prototype.Cp=function(t){return new ed(this.np,t.key,t,this.metadata.fromCache,this.Dp.Yi.has(t.key),this.ep)},id);function id(t,e,n,r){this.np=t,this.Ap=e,this.Dp=n,this.ep=r,this.Pp=null,this.Sp=null,this.metadata=new Zp(n.hasPendingWrites,n.fromCache)}function od(t,e,n){this.mp=t,this.firestore=e,this.ep=n}function sd(){return null!==Yp&&Yp.apply(this,arguments)||this}function ad(t,e,n,r,i,o){this.np=t,this.$m=e,this.ap=n,this.fp=r,this.lp=i,this.ep=o}function ud(t,e){this.hasPendingWrites=t,this.fromCache=e}function hd(t,e,n){this.$m=t,this.firestore=e,this.ep=n,this.Bm=this.firestore.Lm()}function cd(t){this.np=t,this.rp=[],this.up=!1}function fd(t,e){this.np=t,this.ip=e}function ld(t,e){var n=this;if(this.jm=null,this.Um=new sh,this.INTERNAL={delete:function(){return p(n,void 0,void 0,function(){return y(this,function(t){switch(t.label){case 0:return this.Lm(),[4,this.Bm.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this.jm=r,this.Mm=ld.qm(r),this.Qm=r.name,this.Gm=new ni(e)}else{var i=t;if(!i.projectId)throw new ti(Zr.INVALID_ARGUMENT,"Must provide projectId");this.Mm=new Xr(i.projectId,i.database),this.Qm="[DEFAULT]",this.Gm=new ei}this.Wm=new Kp({}),this.zm=this.Km(this.Mm)}function pd(t){if(void 0===t.host){if(void 0!==t.ssl)throw new ti(Zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ti("settings","non-empty string","host",t.host),this.host=t.host,Ni("settings","boolean","ssl",t.ssl),this.ssl=pi(t.ssl,!0);if(_i("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ni("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ni("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?qr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&qr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=pi(t.timestampsInSnapshots,!0),Ni("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=pc.Vc;else{if(t.cacheSizeBytes!==Wp&&t.cacheSizeBytes<pc.Cc)throw new ti(Zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+pc.Cc);this.cacheSizeBytes=t.cacheSizeBytes}Ni("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}s(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(rd.prototype.docChanges,t,{get:function(){return function(){throw new ti(Zr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var dd,yd=(t(vd,dd=nd),Object.defineProperty(vd.prototype,"id",{get:function(){return this.mp.path.X()},enumerable:!0,configurable:!0}),Object.defineProperty(vd.prototype,"parent",{get:function(){var t=this.mp.path.H();return t.J()?null:new $p(new Hi(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(vd.prototype,"path",{get:function(){return this.mp.path.nt()},enumerable:!0,configurable:!0}),vd.prototype.doc=function(t){if(bi("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=jr.u()),Ei("CollectionReference.doc","non-empty string",1,t),""===t)throw new ti(Zr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Fi.it(t);return $p.Zm(this.mp.path.child(e),this.firestore,this.ep)},vd.prototype.add=function(t){gi("CollectionReference.add",arguments,1),Ei("CollectionReference.add","object",1,this.ep?this.ep.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},vd.prototype.withConverter=function(t){return new vd(this.Vp,this.firestore,t)},vd);function vd(t,e,n){var r=dd.call(this,ma.$n(t),e,n)||this;if((r.Vp=t).length%2!=1)throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.nt()+" has "+t.length);return r}function md(t,e){if(void 0===e)return{merge:!1};if(_i(t,e,["merge","mergeFields"]),Ni(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Di(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Di(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof sl}),void 0!==e.mergeFields&&void 0!==e.merge)throw new ti(Zr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function gd(t,e){return void 0===e?{}:(_i(t,e,["serverTimestamps"]),Ai(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function wd(t,e){Ii(t,"object",1,e),e&&(_i(t,e,["source"]),Ai(t,0,"source",e.source,["default","server","cache"]))}function bd(t,e,n){if(e instanceof $p){if(e.firestore!==n)throw new ti(Zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Oi(t,"DocumentReference",1,e)}function Ed(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Id=Ku(Qp,"Use firebase.firestore() instead."),Td=Ku(Jp,"Use firebase.firestore().runTransaction() instead."),Nd=Ku(Xp,"Use firebase.firestore().batch() instead."),Ad=Ku($p,"Use firebase.firestore().doc() instead."),Sd=Ku(td),kd=Ku(ed),Dd=Ku(nd),Rd=Ku(rd),_d=Ku(yd,"Use firebase.firestore().collection() instead."),Od={Firestore:Id,GeoPoint:Mi,Timestamp:qi,Blob:eh,Transaction:Td,WriteBatch:Nd,DocumentReference:Ad,DocumentSnapshot:Sd,Query:Dd,QueryDocumentSnapshot:kd,QuerySnapshot:Rd,CollectionReference:_d,FieldPath:sl,FieldValue:Sl,setLogLevel:Qp.setLogLevel,CACHE_SIZE_UNLIMITED:Wp};var Cd=(Bd.prototype.Fd=function(t){},Bd.prototype.shutdown=function(){},Bd),xd=(jd.prototype.Fd=function(t){this.xp.push(t)},jd.prototype.shutdown=function(){window.removeEventListener("online",this.Np),window.removeEventListener("offline",this.Op)},jd.prototype.jp=function(){window.addEventListener("online",this.Np),window.addEventListener("offline",this.Op)},jd.prototype.kp=function(){Mr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.xp;t<e.length;t++)(0,e[t])(0)},jd.prototype.Fp=function(){Mr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.xp;t<e.length;t++)(0,e[t])(1)},jd.Js=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},jd),Ld=(Fd.prototype._l=function(t){Fr(!this.Bp,"Called onOpen on stream twice!"),this.Bp=t},Fd.prototype.ml=function(t){Fr(!this.Mp,"Called onClose on stream twice!"),this.Mp=t},Fd.prototype.onMessage=function(t){Fr(!this.qp,"Called onMessage on stream twice!"),this.qp=t},Fd.prototype.close=function(){this.Lp()},Fd.prototype.send=function(t){this.Up(t)},Fd.prototype.Qp=function(){Fr(void 0!==this.Bp,"Cannot call onOpen because no callback was set"),this.Bp()},Fd.prototype.Gp=function(t){Fr(void 0!==this.Mp,"Cannot call onClose because no callback was set"),this.Mp(t)},Fd.prototype.Wp=function(t){Fr(void 0!==this.qp,"Cannot call onMessage because no callback was set"),this.qp(t)},Fd),Pd={BatchGetDocuments:"batchGet",Commit:"commit"},Ud="gl-js/ fire/"+xr,Md=(Gd.prototype.Kp=function(t,e){if(e)for(var n in e.g)e.g.hasOwnProperty(n)&&(t[n]=e.g[n]);t["X-Goog-Api-Client"]=Ud},Gd.prototype.kl=function(u,r,i){var h=this,c=this.Hp(u);return new Promise(function(o,s){var a=new Cr;a.listenOnce(_r.COMPLETE,function(){try{switch(a.getLastErrorCode()){case Rr.NO_ERROR:var t=a.getResponseJson();Mr("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Rr.TIMEOUT:Mr("Connection",'RPC "'+u+'" timed out'),s(new ti(Zr.DEADLINE_EXCEEDED,"Request time out"));break;case Rr.HTTP_ERROR:var e=a.getStatus();if(Mr("Connection",'RPC "'+u+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Zr).indexOf(i)?i:Zr.UNKNOWN);s(new ti(r,n.message))}else s(new ti(Zr.UNKNOWN,"Server responded with status "+a.getStatus()))}else Mr("Connection",'RPC "'+u+'" failed'),s(new ti(Zr.UNAVAILABLE,"Connection failed."));break;default:Gr('RPC "'+u+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{Mr("Connection",'RPC "'+u+'" completed.')}var i});var t=f({},r);delete t.database;var e=JSON.stringify(t);Mr("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.Kp(n,i),a.send(c,"POST",e,n,15)})},Gd.prototype.Ol=function(t,e,n){return this.kl(t,e,n)},Gd.prototype.Il=function(t,e){var n=[this.zp,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Dr(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Kp(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=l().indexOf("Electron/")||function(){var t=l();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=l().indexOf("MSAppHost/")||function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function s(t,e){u.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Mr("Connection","Creating WebChannel: "+o+" "+i);var u=r.createWebChannel(o,i),a=!1,h=!1,c=new Ld({Up:function(t){h?Mr("Connection","Not sending because WebChannel is closed:",t):(a||(Mr("Connection","Opening WebChannel transport."),u.open(),a=!0),Mr("Connection","WebChannel sending:",t),u.send(t))},Lp:function(){return u.close()}});return s(Or.EventType.OPEN,function(){h||Mr("Connection","WebChannel transport opened.")}),s(Or.EventType.CLOSE,function(){h||(h=!0,Mr("Connection","WebChannel transport closed"),c.Gp())}),s(Or.EventType.ERROR,function(t){h||(h=!0,Mr("Connection","WebChannel transport errored:",t),c.Gp(new ti(Zr.UNAVAILABLE,"The operation could not be completed")))}),s(Or.EventType.MESSAGE,function(t){var e;if(!h){var n=t.data[0];Fr(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Mr("Connection","WebChannel received error:",i);var o=i.status,s=function(){var t=Wa[o];if(void 0!==t)return tu(t)}(),a=i.message;void 0===s&&(s=Zr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,c.Gp(new ti(s,a)),u.close()}else Mr("Connection","WebChannel received:",n),c.Wp(n)}}),setTimeout(function(){c.Qp()},0),c},Gd.prototype.Hp=function(t){var e=Pd[t];return Fr(void 0!==e,"Unknown REST mapping for: "+t),this.zp+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},Gd),qd=(Object.defineProperty(Vd.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(Vd.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),Vd.prototype.Dm=function(t){return Promise.resolve(new Md(t))},Vd.prototype.Sm=function(){return xd.Js()?new xd:new Cd},Vd.prototype.Cm=function(t){return new Hu(t,{tr:!0})},Vd.prototype.i=function(t){return JSON.stringify(t)},Vd.prototype.atob=function(t){return atob(t)},Vd.prototype.btoa=function(t){return btoa(t)},Vd);function Vd(){this.vu="undefined"!=typeof atob}function Gd(t){this.s=t.s;var e=t.ssl?"https":"http";this.zp=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Fd(t){this.Up=t.Up,this.Lp=t.Lp}function jd(){var t=this;this.Np=function(){return t.kp()},this.Op=function(){return t.Fp()},this.xp=[],this.jp()}function Bd(){}zu.du(new qd);var Hd,zd;(zd=Yd).INTERNAL.registerComponent(new b("firestore",function(t){var e=t.getProvider("app").getImmediate();return new Qp(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps((Fr((Hd=Od)&&"object"==typeof Hd,"shallowCopy() expects object parameter."),f({},Hd)))),zd.registerVersion("@firebase/firestore","1.11.1")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
